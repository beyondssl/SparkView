var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(D,N,T){if(null==D)throw new TypeError("The 'this' value for String.prototype."+T+" must not be null or undefined");if(N instanceof RegExp)throw new TypeError("First argument to String.prototype."+T+" must not be a regular expression");return D+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(D,N,T){if(D==Array.prototype||D==Object.prototype)return D;D[N]=T.value;return D};
$jscomp.getGlobal=function(D){D=["object"==typeof globalThis&&globalThis,D,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var N=0;N<D.length;++N){var T=D[N];if(T&&T.Math==Math)return T}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(D,N){var T=$jscomp.propertyToPolyfillSymbol[N];if(null==T)return D[N];T=D[T];return void 0!==T?T:D[N]};$jscomp.polyfill=function(D,N,T,la){N&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(D,N,T,la):$jscomp.polyfillUnisolated(D,N,T,la))};
$jscomp.polyfillUnisolated=function(D,N,T,la){T=$jscomp.global;D=D.split(".");for(la=0;la<D.length-1;la++){var aa=D[la];if(!(aa in T))return;T=T[aa]}D=D[D.length-1];la=T[D];N=N(la);N!=la&&null!=N&&$jscomp.defineProperty(T,D,{configurable:!0,writable:!0,value:N})};
$jscomp.polyfillIsolated=function(D,N,T,la){var aa=D.split(".");D=1===aa.length;la=aa[0];la=!D&&la in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var za=0;za<aa.length-1;za++){var ia=aa[za];if(!(ia in la))return;la=la[ia]}aa=aa[aa.length-1];T=$jscomp.IS_SYMBOL_NATIVE&&"es6"===T?la[aa]:null;N=N(T);null!=N&&(D?$jscomp.defineProperty($jscomp.polyfills,aa,{configurable:!0,writable:!0,value:N}):N!==T&&($jscomp.propertyToPolyfillSymbol[aa]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(aa):$jscomp.POLYFILL_PREFIX+
aa,aa=$jscomp.propertyToPolyfillSymbol[aa],$jscomp.defineProperty(la,aa,{configurable:!0,writable:!0,value:N})))};$jscomp.polyfill("String.prototype.startsWith",function(D){return D?D:function(N,T){var la=$jscomp.checkStringArgs(this,N,"startsWith");N+="";var aa=la.length,za=N.length;T=Math.max(0,Math.min(T|0,la.length));for(var ia=0;ia<za&&T<aa;)if(la[T++]!=N[ia++])return!1;return ia>=za}},"es6","es3");var svManager={getInstance:function(){var D=window.$rdp;return D&&D.running&&D.running()?D:null}};
svGlobal.getInstance=svManager.getInstance;function connvertServer(D){var N={};N.id=D.id;N.server=D.id;N.displayName=D.displayName||D.id;if(D=D.rdp){for(var T in D)N[T]=D[T];N.user=D.username||"";N.pwd=D.password||"";N.useConsole=D.console||!1;N.legacyMode=D.leagacyMode||D.legacyMode||!1;N.server_bpp=D.color||16;N.exe=D.remoteProgram||"";N.args=D.remoteArgs||"";N.startProgram=0<N.exe.length?"app":N.command&&0<N.command.length?"shell":"noapp"}return N}
function Rdp2(D){D=svGlobal.util.getServerArgs(D);if(!D||!D.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var N=D.gateway||"",T=0,la=0,aa=16,za=1==D.useSSL||"true"==D.useSSL||"on"==D.useSSL||null;D.width&&(T=parseInt(D.width,10));D.height&&(la=parseInt(D.height,10));D.color&&(aa=parseInt(D.color,10));D.server_bpp&&(aa=parseInt(D.server_bpp,10));D=hi5.browser.obj2url(D);null===za&&(za="https:"==location.protocol);return new Rdp((za?"wss://":"ws://")+N+"/RDP?"+D,T,la,aa)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(D,N,T,la){var aa,za;function ia(a){return"on"==a||"true"==a||1==a}function Xa(){var a=n.gateway;n.ongetgatewayaddress&&(a=n.ongetgatewayaddress(a));return a}function pc(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function Nb(a,b){a=L[a]||b;a.startsWith("/")||a.toLowerCase().startsWith("http")||(a=hi5.libPath+a);return a}function db(){return C.displayName||C.server||C.symlink||C.id||"undefined"}function tb(a,b,d){n.ontitlechange&&
(a=n.ontitlechange(a,d));n.setTitle&&a&&(b=b||window,b.document.title=a)}function eb(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return C.invitation||n.showMessage("15 bit color is not supported anymore."),!1;default:return!1}ab=a;b&&(na?na.postMessage({type:0,cmd:1,data:a}):Z&&Z.setColor(a));return!0}function Ya(a,b,d,l){ja=a;ka=b;ub=vb=0;wb=ja-1;xb=ka-1;Fa&&(ja=(C.waWidth||hi5.browser.getScreenWidth())|0,ka=(C.waHeight||hi5.browser.getScreenHeight())|0);C.minWidth&&ja<C.minWidth&&
(ja=C.minWidth|0);C.minHeight&&ka<C.minHeight&&(ka=C.minHeight|0);ja&=-4;ka&=-4;svGlobal.logger.warn("resolution changed, w:"+ja+" h:"+ka);var c=ja,p=ka;P?P.resize(c,p):P=new Ob(c,p);J.setSize(ja,ka,Fa?"hidden":null);if(d||ja!=a||ka!=b)na?na.postMessage({type:0,cmd:2,data:{w:ja,h:ka}}):Z&&Z.setResolution(ja,ka);if(n.onresolutionchange&&!l)n.onresolutionchange(a,b)}function V(a){!Ka&&fa&&(na?(yb.data=a,"string"!=typeof a?na.postMessage(yb,[a]):na.postMessage(yb)):Z.writeRawInput(a))}function Pb(a){switch(a){case "\r":break;
case "\n":n.writeScancode(28);break;case "\t":n.writeScancode(15);break;default:V("86"+a)}}function zb(a){if(n){var b=__svi18n.errorCode[a];n.displayMsg&&b&&n.showMessage(b);0<svGlobal.log&&console.error&&console.error(b||"error code: "+a);if(n.onerror)n.onerror({name:a,message:b})}}function Ab(a){if(n){var b=__svi18n.info[a];b||(b="info "+a);n.displayMsg&&n.showMessage(b);svGlobal.logger.info(b)}}function Bb(){var a=fa;Za=fa=!1;na?na.postMessage({type:0,cmd:3}):Z&&Z.resetStatus();a&&(fa=a)}function qc(){var a=
J.getFocused();a=a?a.getWindow():window;return"&waWidth="+C.waWidth+"&waHeight="+C.waHeight+"&dpWidth="+a.innerWidth+"&dpHeight="+a.innerHeight}function Cb(a){oa||(oa=new hi5.file.UploadManager(new hi5.file.WsFileService(V)),oa.addEvent("beforeupload",function(b,d,l){if(n.beforeupload)return n.beforeupload(b,d,l)}),oa.addEvent("fileuploaded",function(b,d,l){if(n.onfileuploaded)n.onfileuploaded(b,d,l)}),oa.addEvent("uploaded",function(b,d){if(n.onuploaded)n.onuploaded(b,d)}),oa.addEvent("uploadingCancelled",
function(){if(n.onuploadingCancelled)n.onuploadingCancelled()}));a.setFileHandler(oa)}function Qb(a,b,d){var l=!1;this.exe=a;this.args=b||"";this._dir=d||"";var c=this;this.close=function(){!l&&fa&&(l=!0,V("8C5"+c.exe+"\t"+c.args+"\t"+n.sessionInfo.appInfo.session))}}function Db(a){var b=this;a||(a=143);this.send=function(d){var l=!!d.buffer,c=l?d:d.getData(),p=64==a;d=l?c.length:d.getEnd()||c.length;d<c.length&&(c=l?c.subarray(0,d):c.slice(0,d));l=p?5:9;d=new Uint8Array(l+d);d[0]=a;if(p)d[1]=b.id,
d[2]=b.id>>8,d[3]=b.id>>16,d[4]=b.id>>24;else{p=b.name;for(var g=Math.min(p.length,8),w=0;w<g;w++)d[1+w]=p.charCodeAt(w)}d.set(c,l);V(d.buffer)};this.name="";this.count=this.id=this.flags=0}function rc(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}function sc(){var a=0,b=0,d=new n.GatewayChannel;d.name="MESSGSTB";d.onopen=function(){svGlobal.logger.info("Message Channel open")};
d.process=function(l){if(0==l.getByte())l.getByte(),l.getByte(),l.getByte();else{var c=l.getByte(),p=l.getLittleEndian16(),g=l.getLittleEndian16();if(0!=c)svGlobal.logger.warn("Invalid AUTODETECT_REQUEST");else switch(g){case 1:case 4097:g=new RdpBuffer(new Uint8Array(6),0,6);g.setByte(6);g.setByte(1);g.setLittleEndian16(p);g.setLittleEndian16(0);g.markEnd();d.send(g);break;case 20:case 276:case 4116:a=6;b=Date.now();break;case 2:p=l.getLittleEndian16();a+=p;break;case 43:case 1065:case 1577:43==
g&&(c=l.getLittleEndian16(),a=a+c+8,l.skipPosition(c));l=l.has(4)?l.getLittleEndian32():0;a+=l;l=Date.now()-b;c=new RdpBuffer(new Uint8Array(14),0,14);c.setByte(14);c.setByte(1);c.setLittleEndian16(p);c.setLittleEndian16(43==g?3:11);c.setLittleEndian32(l);c.setLittleEndian32(a);c.markEnd();d.send(c);break;case 2112:case 2176:case 2240:p=l.getLittleEndian32();g=l.getLittleEndian32();l=l.getLittleEndian32();kb={baseRTT:p,bandwidth:g,averageRTT:l};if(n.onnetworkresult)n.onnetworkresult(kb);svGlobal.logger.warn("Network Characteristics Result:");
svGlobal.logger.warn(kb);break;default:svGlobal.logger.warn("Invalid network detect PDU",l)}}};d.onclose=function(){svGlobal.logger.info("MSG channel close")};n.addGatewayChannel(d)}function tc(a,b){var d=document.createElement("div"),l=document.createElement("input");l.type="radio";l.name="ds_name";l.value=a;0==a&&(l.defaultChecked=!0);d.appendChild(l);d.innerHTML+=b;d.innerHTML+="<br>";return d}function Rb(){var a="";C&&ia(C.connectif)&&C.symlink&&"sessionStorage"in window&&(a="SV_"+C.symlink,C.domain&&
(a+=C.domain),C.user&&(a+=C.user));return a}function uc(){var a=Rb(),b="";a&&(b=sessionStorage[a]||"")&&(b="&preSymJoin="+b);return b}function vc(a,b){var d=0,l=J.size(),c=Array(l),p=Array(l),g=0,w=0,E=0,H=0,Q=0,A=0,t="";if(a){p=P.parseMonitorDef(a);for(l=p.length;d<l;d++){var m=p[d];m[0]<E&&(E=m[0]);m[1]<H&&(H=m[1]);m[2]>Q&&(Q=m[2]);m[3]>A&&(A=m[3])}0>E&&(g=-E);0>H&&(w=-H);m=0>b?[E,H,Q,A]:p[b];C.width=m[2]-m[0]+1;C.height=m[3]-m[1]+1;d=J.getSurface(0);d.setMonitor(m[0],m[1],m[2],m[3]);if(g||w)for(m=
d.getMousePosition(),m.left+=g,m.right+=g,m.top+=w,m.bottom+=w,d=0;d<l;d++)m=p[d],m[0]+=g,m[1]+=w,m[2]+=g,m[3]+=w;P.setMonitorLayout(p);0>b&&P.setMonitorCount(0);n.reconnectOnResize=!1;return"&monitorDef="+a+"&width="+C.width+"&height="+C.height}if(1<l&&!Fa){for(J.verifyMonitors();d<l;d++)a=J.getSurface(d),m=a.getMousePosition(),m.left<E&&(E=m.left),m.top<H&&(H=m.top),m.right>Q&&(Q=m.right),m.bottom>A&&(A=m.bottom),c[d]=m,t&&(t+=","),t+=m.left+":"+m.top+":"+m.right+":"+m.bottom;0>E&&(g=-E);0>H&&(w=
-H);for(d=0;d<l;d++){m=J.getSurface(d).getMousePosition();if(g||w)m.left+=g,m.right+=g,m.top+=w,m.bottom+=w;p[d]=[m.left,m.top,m.right,m.bottom,m.left==g&&m.top==w?1:0]}P.setMonitorLayout(p);n.reconnectOnResize=!1}t&&(svGlobal.logger.warn("MonitorDef:"+t),C.width=Q-E+1,C.height=A-H+1,t="&monitorDef="+t+"&width="+C.width+"&height="+C.height);return t}function Sb(){if(!fa){Za=!1;var a="";if(Ka)ha.init(!1,!0,!1,0,!1);else{a=D+"&width="+ja+"&height="+ka+"&server_bpp="+ab+"&audio="+(pa.available||hi5.browser.isIE)+
uc()+vc(C.monitorDef,C.monitor);0>D.indexOf("waWidth")&&(a+=qc());var b=new Date;C.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());if(!C.timezone){var d=hi5.DateUtils.getGMT();d&&(a+="&timezone="+encodeURIComponent(d))}a+="&time="+b.getTime();void 0==C.soundPref&&(C.soundPref=0,a+="&soundPref=0");var l=d=b="";for(l in Ra){var c=Ra[l];"flags"in c&&(b&&(b+=",",d+=","),b+=c.name,d+=c.flags)}b&&(a=a+("&channelName="+b)+("&channelFlags="+d));b="";for(l in Sa)c=Sa[l],"flags"in c&&(b&&(b+=","),b+=c.name);
b&&(a+="&gwChannelName="+b);if(d=rc())b=d.account,d=d.session,b&&(a+="&account="+b),d&&(a+="&session="+d);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);C.audioRecord=ia(C.audioRecord)&&hi5.audio.recordable;ha.init(b,!!C.remotefx,C.audioRecord,C.soundPref,ia(C.mapCamera)&&!!navigator.mediaDevices);C.audioRecord&&(a+="&audioRecord=on");C.decompressingRDP61&&(a+="&decompressingRDP61=on");0<ha.count&&(a+="&dvcChannels="+ha.names.join(","));hi5.browser.binaryWS()&&(a+="&binary=on");
L.existingFile&&(a+="&existingFile="+L.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(Xa());a=n.modifyURL(a);L.copyTextOnly&&ia(C.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);ia(C.textPrinter)&&(a+="&printerDriver="+encodeURIComponent("Generic / Text Only"));D=a}void 0==L.wsPost&&(L.wsPost=!1);na?(Ka&&(Ka.onopen=Eb,Ka.onclose=fb,Ka.onmessage=
function(g){Fb.data=g.data;na.postMessage(Fb,[Fb.data])}),na.postMessage({type:0,cmd:0,data:{addr:a,width:ja,height:ka,server_bpp:ab,libPath:hi5.libPath,libMin:hi5.libMin,wsPost:L.wsPost}})):(Z=new RdpGeneral(Ka||a,ja,ka,ab,P,!1,L.wsPost),Z.run());na?na.addEventListener("message",Tb,!1):(Z.onopen=Eb,Z.onmessage=Ub,Z.onclose=fb,Z.onerror=zb,Z.oninfo=Ab,Z.onloggedin=Gb,Z.onresolutionchange=function(g,w){Ya(g,w,!1,C.monitorDef&&0<=C.monitor?!0:!1)},Z.onAltSecWindows=Vb,Z.onMoveCursor=Hb,Z.onCloseSurface=
Wb,Z.onColorChange=eb,Z.onHistoryReceived=function(){Ib()},Z.onLockKeyState=function(g){if(n.onLockKeyState)n.onLockKeyState(g)});if(a=J.getSurface(J.size()-1))Fa?a&&(a.remoteApp=new Qb(C.exe,C.args,"")):tb(db(),a.getWindow());if(C.invitation&&!ia(C.shadow)){var p=null;a&&(p=a.initChat(C.expert));gb=new n.GatewayChannel;gb.name="C_H_A_T";gb.process=function(g){g=g.getUnicodeString(g.getEnd()-g.getPosition(),!0);p&&p.add(g,C.novice)};p&&(p.onchat=function(g){if(fa){var w=Array(2*g.length);w=new hi5.DataBuffer(w,
0,w.length);w.setUnicodeString(g);w.markEnd();gb.send(w)}});n.addGatewayChannel(gb)}hi5.browser.isIE&&!hb&&(0==C.playSound||0<n.mode)&&(hb=hi5.browser.loadFlash(L.flash||hi5.libPath+"plugin.swf"))&&(Xb=!0)}}function Tb(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:Eb();break;case 1:fb(a.expected);break;case 2:zb(a.code);break;case 3:Ab(a.code);break;case 4:Gb();break;case 5:Ya(a.w,a.h,!1,C.monitorDef&&0<=C.monitor?!0:!1);break;case 6:Hb(a.x,a.y,!0);break;case 7:Wb();break;case 8:0==a.id&&
Ib();ra&&ra.check(1<a.id?15555:0);break;case 9:eb(a.color);break;case 10:if(n.onLockKeyState)n.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:P.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:P.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:P.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:P.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:P.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,a.srcy);
break;case 8:P.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:Yb(a);break;case 10:Ub(a);break;case 11:Aa.attach(a.data,0,a.data.length);Vb(Aa,a.size);break;case 12:P.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:P.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:P.saveDesktop(a.x,
a.y,a.cx,a.cy,a.offset);break;case 15:P.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:P.putFont(a.font,a.character,a.glyph);break;case 17:P.putCursor(a.idx,a.cursor);break;case 18:P.setCursor(a.idx);break;case 19:P.getHistory(V,function(){na.postMessage({type:0,cmd:7})});ra&&ra.check(15555);break;case 20:Aa.attach(a.data,a.off,a.data.length-a.off);P.setHistory(a.order,Aa);break;case 21:P.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function Zb(a){ra&&
ra.check(a)}function Eb(){fa=!0;var a="87"+navigator.userAgent+"\t";lb=hi5.tool.uuid();document.cookie=lb+"=sv";V(a+lb);if(n.onopen)n.onopen();L.joinCloseMode&&n.setJoinCloseMode(L.joinCloseMode)}function Wb(){J&&J.close()}function Ub(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Aa.attach(a,0,b.byteLength);var d=Aa.getLittleEndian16();switch(d){case 28:a=Aa;b=a.getAscllString(8);d=Sa[b];null!=d?d.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Aa;switch(a.getByte()){case 0:aa=
a.getLittleEndian16();za=a.getLittleEndian16();Na=a.getLittleEndian32();a.skipPosition(6);Ta=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+aa+" channels="+za+" bitsPerSample="+Ta+" samplePerSec="+Na);$b();break;case 1:wc(a)}ra&&ra.check();break;case 56:ac(Aa.getUnicodeString(Aa.getEnd()-Aa.getPosition(),!1));break;case 60:bc(Aa);break;case 62:cc(Aa.getUnicodeString(Aa.getEnd()-Aa.getPosition(),!1));break;case 63:dc(Aa);ra&&ra.check();break;case 64:b=Aa;d=b.getByte();a=b.getLittleEndian32();
switch(d){case 1:b=b.getAscllString();if(ha[b]&&(svGlobal.logger.info("DVC create, name:"+b+" id:"+a),ha[b].newInstance?(ha[a]=ha[b].newInstance(),ha[a].id=a):(ha[b].id=a,ha[a]=ha[b]),ha[a].onopen))ha[a].onopen();break;case 3:ha[a]&&ha[a].process(b);break;case 4:if(ha[a]&&ha[a].onclose)ha[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}ra&&ra.check();break;case 146:a:switch(a=Aa,b=a.getByte(),b){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;V(a.buffer);break;case 1:break;case 5:b=a.getByte();a=
a.getLittleEndian32();0!=b||a&4||(La^=65536,J.execute("setFeature",[La]));break;case 6:va.remoteLockFlags=a.getLittleEndian32();va.checkLockFlags=!0;if(n.onLockKeyState)n.onLockKeyState({capsLock:0!=(va.remoteLockFlags&4),numLock:0!=(va.remoteLockFlags&2),scrollLock:0!=(va.remoteLockFlags&1)},{capsLock:0!=(va.localLockFlags&4),numLock:0!=(va.localLockFlags&2),scrollLock:0!=(va.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+va.remoteLockFlags);break;case 7:b=a.getByte();n.sessionInfo.appInfo.twoFAEnabled=
0<b;switch(b){case 0:b=a.getLittleEndian32();a=a.getBytes(b);n.sessionInfo.appInfo.twoFAQR=a;if(n.ontwofaqr)n.ontwofaqr(a);break;case 1:P.pause(!0,!0);if(n.ontwofacode&&n.ontwofacode())break a;(a=J.getFocused())&&a.showTwoFACode();break;case 2:if(b=a.getByte(),a=1==a.getByte(),(!n.ontwofaresult||!n.ontwofaresult(b,a))&&va.onauthcoderesult)va.onauthcoderesult(b,a)}break;default:svGlobal.logger.warn("Invalid Client Control: "+b)}break;default:if(n.onunknownmessage)n.onunknownmessage(d,Aa);else svGlobal.logger.warn("@TODO:"+
d+"\n")}}else switch(d=parseInt(b.substring(0,2),16),a=b.substring(2),d){case 0:V("87"+navigator.userAgent);break;case 15:if(n){Jb=!1;bb=n.reconnectTimes;(n&&0==n.mode||ia(C.connectif))&&Ib();b="";for(b in Ra)if((d=Ra[b])&&d.onopen)d.onopen();for(b in Sa)if((d=Sa[b])&&d.onopen)d.onopen();a&&(a=JSON.parse(a),a.capability&&n&&(n.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){isNaN(b.name)||(b.name="S"+b.name);b.message||(b.message=b.msg);if(n.onnotify)n.onnotify(b);
svGlobal.logger.info("msg="+a);if(2==b.type&&n.onerror)n.onerror(b);if(a=__svi18n.errorCode[b.name])b.msg=a+" "+b.msg;n.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+a);break;case 27:J.drawLicense(a);break;case 50:if(fa)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:xc(a);break;case 2:ib?(ib.type==a?n.writeRawInput("881"+a+"\t"+ib.text):n.writeRawInput("881ERROR\t"),ib=null):!(b=J.getFocused())||b.processClipReq(a)||!L.clipWarnAlways&&ec||!C||C.leagacyMode||
(n.showMessage(__svi18n.info.menucopy,null,5E3),ec=!0);break;case 5:(b=J.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:J.setReadOnly("1"==a);break;case 54:b=a.split("\t");a=Xa()+b[0];a=n.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);n.onprintingready&&n.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=J.getFocused())&&b.showPDF(a);break;case 55:b=parseInt(a.substring(0,1),16);a=a.substring(1);switch(b){case 0:a=a.split("\t");aa=
parseInt(a[0],10);za=parseInt(a[1],10);Ta=parseInt(a[2],10);Na=parseInt(a[3],10);svGlobal.logger.debug("Audio Format, tag="+aa+" channels="+za+" bitsPerSample="+Ta+" samplePerSec="+Na);$b();break;case 1:yc(a)}break;case 56:ac(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=J.getWinById(parseInt(b[0]))){if(!J.hasApp(b[1])){(d=J.getOwnerSurface(a))&&d.railWin&&(d.railWin.appId=b[1],d.railWin.addApp(b[1]));if(n.onremoteappstart)n.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&
n.ontitlechange)n.ontitlechange(d.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:zc(a);break;case 59:a=hi5.Base64.dec(a,0);La=(new RdpBuffer(a,0,a.length)).getLittleEndian32();Ua||!(La&16||La&65536)?(mb=!1,oa=null):(La&16&&(mb=!0),oa||(a=J.getFocused())&&Cb(a));La&64&&n.showMessage(__svi18n.info.recording);oa&&(oa.setUpload(!(La&128)),oa.setDownload(!(La&131072)),oa.canCopyFile=0!=(La&65536));J.execute("setFeature",[La]);break;case 60:bc(b64ToBuffer(a));break;case 61:a=JSON.parse(a);
switch(a.type){case 0:Ya(a.width,a.height,!0,!1);eb(a.color);(b=a.server)&&n&&(n.server=a.server);fc=a.length;d=J.getFocused();Fa=1==a.isRail;d&&(d.setAutoScale(!Fa),b&&tb(db(),d.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&d.setUnicode(!0),b=a.mapDisk)&&(mb=!0,Cb(d));if(n.onopened)n.onopened(a);break;case 1:a=a.duration;if(n.onprogress)n.onprogress(a,fc);break;case 2:2==a.status?(Bb(),fa=!0):(b=0==a.status,b==P.isPaused()||n.onsessionpause&&n.onsessionpause(b,a)||(P.pause(b),b||J.repaint(0,
0,P.width-1,P.height-1),a.warn&&n.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:cc(a);break;case 63:dc(b64ToBuffer(a));break;default:if(n.onunknownmessage)n.onunknownmessage(d,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function Ib(){if(!Ua&&!Ga&&(Ga=!0,n&&(L.pingInterval&&n.startPing(L.pingInterval),n.onready)))n.onready()}function Ac(a,b){var d=0,l=!1;this.width=a;this.interval=b;var c=0;this.start=function(){l||(l=!0,d=setInterval(function(){var p=J.getFocused();
p&&fa&&(p=p.getThumbnail(a))&&p.length!=c&&(V("8E7"+p),c=p.length)},b))};this.stop=function(){clearInterval(d)}}function Bc(a,b){!Ia||Ia.width==a&&Ia.interval==b||(Ia.stop(),Ia=null);Ia||(Ia=new Ac(a,b));Ia.start()}function dc(a){var b=a.getAscllString(8);(b=Ra[b])&&b.process&&b.process(a)}function cc(a){var b=parseInt(a.substring(0,1),16),d=a.substring(1);a=!1;var l=n.sessionInfo.appInfo;switch(b){case 0:var c=JSON.parse(d);Bb();fa=!0;a=c.width;b=c.height;if(a==ja&&b==ka)break;Ya(a,b,!1,!1);break;
case 1:c=JSON.parse(d);n.sessionInfo.joinedSessions.push(c.numericId);l.sessions[c.numericId]=c.name||c.__ip;if(!l.joined||L.alertJoin)n.onsessionjoin&&(a=n.onsessionjoin(c)),!a&&__svi18n.info.joinsession&&n.showMessage(__svi18n.info.joinsession.applyArgs([c.numericId,c.__ip,c.name]));break;case 2:c=JSON.parse(d);n.sessionInfo.joinedSessions.removeElm(c.numericId);delete l.sessions[c.numericId];if(!l.joined||L.alertJoin)n.onsessionexit&&(a=n.onsessionexit(c)),!a&&__svi18n.info.exitsession&&n.showMessage(__svi18n.info.exitsession.applyArgs([c.numericId,
c.__ip,c.name]));break;case 3:c=JSON.parse(d);l.joinMode!=c.mode&&(l.joinMode=c.mode,b=hi5.$("joinSelect"))&&(b.value=c.mode);if(l.hasControl)break;l.hasControl=!0;J.setReadOnly(!1,2==c.mode);if(b=hi5.$("requestControl"))b.disabled=!0;n.ongivecontrol&&(a=n.ongivecontrol());if(a)break;n.showMessage(__svi18n.info.givecontrol,null,5E3);break;case 4:c=JSON.parse(d);J.setReadOnly(!0,2==c.mode);l.hasControl=!1;if(b=hi5.$("requestControl"))b.disabled=!1;n.ontakebackcontrol&&(a=n.ontakebackcontrol());if(a)break;
n.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:c=JSON.parse(d);n.onrequirecontrol&&(a=n.onrequirecontrol(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);b=__svi18n.info.recontrol;P.isPaused&&(b+="<br><br>"+(__svi18n.info.autoresume||""));n.showMessage({title:a,msg:b,cbYes:function(){n.giveControl(c.numericId);this.destroy();P.isPaused()&&n.pauseSession(n.sessionInfo.appInfo.numericId,!1)},cbNo:function(){n.refuseControl(c.numericId);this.destroy()}});break;
case 6:J.execute("setTouchRemoting",[!0]);break;case 7:c=JSON.parse(d);c.width&&c.height&&Ya(c.width,c.height,!0,C.monitorDef&&0<=C.monitor?!0:!1);c.color&&(eb(c.color,!0),svGlobal.logger.warn("Color depth changed to:"+c.color));c.version&&(n.sessionInfo.protocolVersion=c.version);break;case 8:c=JSON.parse(d);Jb=!0;if(n.onrequestcredential&&n.onrequestcredential(c,va.reconnect))break;if(n.onautherror&&n.onautherror(c,va.reconnect))break;J.getFocused().requestCredential(c,va.reconnect);break;case 9:c=
JSON.parse(d);0<c.interval&&0<c.width?Bc(c.width,c.interval):Ia&&(Ia.stop(),Ia=null);break;case 11:c=JSON.parse(d);n.onrequirejoin&&(a=n.onrequirejoin(c));if(a)break;a=__svi18n.info.title.applyArgs([c.name,c.numericId,c.__ip]);n.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){n.allowJoin(c.numericId,!0);this.destroy()},cbNo:function(){n.allowJoin(c.numericId,!1);this.destroy()}});break;case 13:c=JSON.parse(d),"login"==c.type&&Gb()}}function bc(a){switch(a.getByte()){case 32:if(!P.isPaused()){var b=
a.getLittleEndian16(),d=a.getLittleEndian16(),l=a.getLittleEndian16(),c=void 0,p=void 0;L.noCursorName||(c=a.getLittleEndian32(),n.sessionInfo.appInfo&&(p=n.sessionInfo.appInfo.sessions[c]));Hb(d,l,!0,p,c,b)}}}function Hb(a,b,d,l,c,p){P.isPaused()||J.getFocused().moveCursor(a,b,d,l,c,p)}function Yb(a){J.setCursor(a)}function Cc(a){var b=L.page&&L.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var d=location.href,l=d.lastIndexOf("/");
if(b)return d.substring(0,l+1)+b;b=Xa();d.toLowerCase().startsWith(b.toLowerCase())&&(b=d.substring(0,l));return b+"/"+a}function ac(a){a=JSON.parse(a);gc=a.session;a.server||(a.server=db());var b=hi5.$("joinSelect");b&&(b.value=a.joinMode);if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?J.execute("setAutoScale",[!0]):(n.mode=0,ia(C.connectif)&&J.setSize(ja,ka),L.disableJoinedAppResize&&(n.windowState=0));var d=Xa();b=Cc("join.html")+"?id="+(a.joined||a.numericId);var l=a.webAddress;
l&&0<l.length&&l.toLowerCase()!=d.toLowerCase()&&(d=l.indexOf("://"),n.protocol="http"==l.substring(0,d)?"ws":"wss",n.gateway=l,b+="&gateway="+encodeURIComponent(l));b=n.modifyURL(b);a.joinLink=b;n.sessionInfo.appInfo=a;"isApp"in a&&Fa!==a.isApp&&(Fa=a.isApp,Ya(ja,ka,!0,!0),Za||J.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);L.cursorNameOnly=a.isAssistance;if(n.onsessionstart)n.onsessionstart(n.sessionInfo)}function zc(a){if(oa){var b=
parseInt(a.charAt(0),10);a=a.substring(1);if(5==b)oa.notifyFiles(JSON.parse(a));else{var d=a.split("\t");switch(b){case 1:oa.confirmId(d[0],d[1],d[2]);break;case 2:oa.read(d[0],parseInt(d[1],10),parseInt(d[2],10));break;case 4:oa.close(d[0]);break;case 9:a='<a href="'+n.modifyURL(Xa()+d[0])+'" download="'+d[1]+'" target="_blank">'+__svi18n.info.fileReady+": "+d[1]+"</a>",__svi18n.info.download&&J.getFocused().showMessage({msg:a,title:__svi18n.info.download,cbNo:function(){oa.removeFile(d[0],!0);this.destroy()},
onclick:function(l){"A"==l.target.tagName&&this.destroy()}})}}}}function yc(a){function b(I){var G=0;I*=p;for(g=0;g<p;g++)G|=(c[I+g]&255)<<8*g;G>w?(G-=H,G/=-E):G/=w;return G}if(pa.available&&!P.isPaused()){var d=a.indexOf("\t"),l=a.substring(0,d),c=hi5.Base64.dec(a,d+1);1!=aa&&(cb||(cb=new MSGSM),c=cb.decode(c,0,c.length));a=Ta;var p=a>>3,g=0,w=Math.pow(2,a-1)-1,E=-w-1,H=Math.pow(2,a);a=0;d=za;var Q=Math.floor(Math.floor(c.length/p)/d),A=pa.getBuffer(Q),t=A.getChannelData(0),m=A.getChannelData(1);
for(a=0;a<Q;){var z=2*a,r=b(z);1==d?(t[a]=r,m[a]=r):(t[a]=r,m[a]=b(z+1));a++}a=pa.playBuffer(A);setTimeout(function(I){return function(){V("8A"+I)}}(l),1E3*(a-pa.delay))}}function wc(a){function b(p){return function(){V("8A"+p)}}var d=a.getByte(),l=a.getLittleEndian16(),c=Date.now();a.skipPosition(8);a=Kb(a,d,l,0);a=1E3*(a-pa.delay);Ua||(l+=Date.now()-c+a,setTimeout(b(d+","+l),a))}function Kb(a,b,d,l){if(!Xb||P.isPaused())return 0;var c=d=0,p=a.getPosition();b=a.getData();l||(l=a.getEnd()-p);var g=
l;if(41222==aa)return(d=pa.getContext())&&d.decodeAudioData(b.buffer.slice(p),function(t){t=pa.playBuffer(t);Ua||setTimeout(sendLater(Ab),1E3*(t-pa.delay))},function(t){svGlobal.logger.warn(t)}),0;if(c=1!=aa)cb||(cb=new MSGSM),b=cb.decode(b,p,g),p=0,g=b.length;var w=Ta,E=w>>3,H=Math.floor(g/E),Q=a=0,A=0;c||(a=Math.pow(2,w-1)-1,Q=-a-1,A=Math.pow(2,w));w=za;if(hb){p="";if(c){for(;d<g;d++)0<d&&(p+=","),p+=b[d]+","+b[d]+","+b[d]+","+b[d];hb.write(p);return l/65*.025}for(;d<g;)0<d&&(p+=","),c=b[d++]|b[d++]<<
8,9>c?c=0:c>a?(c-=A,c/=-Q):c/=a,p+=c,1==w&&(p+=","+c);hb.write(p);return l/E/Na*.6}l=p;p=Math.floor(H/w);g=pa.getBuffer(p);E=g.getChannelData(0);H=g.getChannelData(1);d=0;if(c)for(;d<p;)1==w?H[d]=E[d]=b[l++]:(E[d]=b[l++],H[d]=b[l++]),d++;else for(;d<p;)c=b[l++]|b[l++]<<8,c>a?(c-=A,c/=-Q):c/=a,1==w?E[d]=c:(E[d]=c,c=b[l++]|b[l++]<<8,c>a?(c-=A,c/=-Q):c/=a),H[d]=c,d++;return pa.playBuffer(g)}function $b(){na&&na.postMessage({type:0,cmd:5,data:{tag:aa,channels:za,samplePerSec:Na,bitsPerSample:Ta}})}function hc(a){if(!n.openLink||
2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var d=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");d||(0==a.indexOf("www.")?(d=!0,a="http://"+a):0==a.indexOf("ftp.")&&(d=!0,a="ftp://"+a));if(d){if(0<a.indexOf("\r")||0<a.indexOf("\n"))return!1;if(n.onurlredirection&&n.onurlredirection(b))return!0;a=J.getFocused();if(!a)return!1;a.processLink(b);return!0}return!1}
function Dc(a){if(a.startsWith("text/html;<img data-sv-img")){var b=a.indexOf('src="');if(0<b){b+=5;var d=a.indexOf('"',b),l=a.substring(b,d);l=n.modifyURL(l);a=a.substring(0,b)+l+a.substring(d)}}return a}function xc(a){if("text/plain;"!=a){if(1666<Date.now()-va.reqCopyTime&&!(n.onservercopy&&n.onservercopy(a)||hc(a))){var b=J.getFocused();b&&b.copyToClip(Dc(a))}setTimeout(function(){V("883")},999)}}function Gb(){if(!Za&&(setTimeout(function(){fa&&V("884")},333),n.onloggedin))n.onloggedin();Lb=Za=
!0;Fa&&J.execute("setAutoScale",[!1]);oa&&(oa.enabled=!0);nb&&!Fa&&(P.setContext(J.getFocused().context),J.repaint(0,0,P.width-1,P.height-1))}function fb(a){if(n){hi5.browser.cookie.delete(lb);svGlobal.logger.warn("closed "+(n.sessionInfo.appInfo?n.sessionInfo.appInfo.numericId:0));var b=Rb();b&&n.sessionInfo.appInfo&&0==n.mode&&(sessionStorage[b]=n.sessionInfo.appInfo.session);if(n&&(b=0==n.mode,!fa&&b&&zb("connection"),b=b&&(fa||bb<n.reconnectTimes)&&0<bb&&!a,Ga=fa=!1,b)){bb--;__svi18n.info.reconnecting&&
n.showMessage(__svi18n.info.reconnecting+" "+(n.reconnectTimes-bb)+"/"+n.reconnectTimes,null,3E3);setTimeout(Sb,5);svGlobal.logger.info("Reconnecting..."+bb);return}if(Jb)svGlobal.logger.info("Req credential");else{ra&&(n.stopPing(),ra=null);na&&(na.removeEventListener("message",Tb,!1),na.postMessage({type:0,cmd:4}),na.terminate(),na=null);oa&&(oa.release(),oa=null);sa=D=null;ha&&(ha.close(),ha=null);Ra&&hi5.Arrays.release(Ra);Sa&&hi5.Arrays.release(Sa);Ia&&(Ia.stop(),Ia=null);pa&&(pa.close(),pa=
null);jb=null;try{if(n.onclose)n.onclose(a);else svGlobal.logger.info("onclose: null");J&&(J.close(),J=null)}catch(d){svGlobal.logger.warn(d)}Aa=null;Z&&(Z.onopen=null,Z.onmessage=null,Z.onclose=null,Z.onerror=null,Z.close(),Z=null);J=va=null;P&&(P.release(),P=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(n.close):window.removeEventListener("unload",n.close,!1);window&&window.$rdp==n&&(window.$rdp=null);n=null}}}function ic(){Z&&fa?Z.close():fb(!0)}function Vb(a,b){var d=a.getLittleEndian32();
if(0!=(d&16777216))if(b=a.getLittleEndian32(),0!=(d&1073741824)){a.getLittleEndian16();a.getByte();d=a.getByte();var l=a.getLittleEndian16(),c=a.getLittleEndian16(),p=0;16>d&&(p=a.getLittleEndian16());var g=a.getLittleEndian16(),w=a.getLittleEndian16();a.getBytes(g);p&&a.getBytes(p);if(8<=d&&(p=J.getFocused())&&p.onremoteappicon){g=new hi5.graphic.Bitmap(l,c,32);a.getPosition();l=new Uint8Array(l*c*4);c=a.getPosition();w=c+w;var E;a=a.getData();for(var H=0,Q,A;c<w;)switch(d){case 16:(E=a[c++]|a[c++]<<
8)?(A=E>>7&248,Q=E>>2&248,E=E<<3&248,A|=A>>5,Q|=Q>>5,E|=E>>5,l[H++]=E,l[H++]=Q,l[H++]=A,l[H++]=255):H+=4;break;case 32:l[H++]=a[c++],l[H++]=a[c++],l[H++]=a[c++],l[H++]=a[c++]}g.putPixels(l,0,l.length);a=J.getWinById(b);p.onremoteappicon(a,g)}}else 0!=(d&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+b):0!=(d&536870912)?(svGlobal.logger.info("***** delete winId="+b),J.delWin(b)):Ec(a,d,b);else if(0!=(d&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+d);else if(0!=(d&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop, flags:"+
d),0!=(d&1))svGlobal.logger.info("Desktop non monitored flags="+d);else{if(0!=(d&32)&&(b=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+d+" winId="+b),(p=J.getOwnerSurfaceById(b))&&p.railWin&&p.railWin.setActiveWinId(b),J.setTitle(b),P.getContext()||(b=J.getFocused())&&P.setContext(b.context),0!=(d&16)&&(b=a.getByte(),0<b)))for(d=J.zOrders,d.length=b,p=0;p<b;p++)d[p]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+d[p])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+
d)}function jc(a){var b=J.getFocused();if(b&&b.railWin){var d=a||b.railWin.mainWin;if(d&&2<d.showState&&n.windowState){var l=b.getFreeSpace();a=Math.max(Math.abs(d.winHeight-l.height),Math.abs(d.winWidth-l.width));svGlobal.logger.info("--- fitMainWin offset:"+a+" _hOffset:"+d._hOffset+" appId:"+d.appId+" spaceH:"+l.height);0<a?(b=a==d._hOffset,d._hOffset&&b||(d._hOffset=a,setTimeout(function(){d.resize(0,0,l.width,l.height)},333))):d._hOffset=0}}}function Ec(a,b,d){Fa||(Fa=!0);var l=0==(b&268435456),
c=J.getWinById(d);c?l=!0:c=new J.LocalWin(d);svGlobal.logger.info("\n\n=========== winId="+d+" existed="+l);if(c){0!=(b&2)&&(c.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+c.ownerWinid));0!=(b&8)&&(c.style=a.getLittleEndian32(),c.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" style="+c.style+" extStyle="+c.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(c.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(c.style&4194304))),
svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=(c.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(c.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(c.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(c.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(c.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(c.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(c.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+
(0!=(c.style&2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(c.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(c.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(c.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(c.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(c.extStyle&524288))));0!=(b&16)&&(c.setShowState(a.getByte()),svGlobal.logger.info("***** winId="+d+" showState="+c.showState),2==c.showState&&0!=L.noMinimize&&
setTimeout(function(){c.exeCommand(61728)},50));var p=0!=(b&4);if(p){var g=a.getLittleEndian16();c.titleInfo=a.getUnicodeString(g,!1);svGlobal.logger.info("***** winId="+d+" title="+c.titleInfo)}0!=(b&16384)&&(c.clientOffsetX=a.getLittleEndian32(),c.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" coffX"+c.clientOffsetX+" coffY="+c.clientOffsetY));0!=(b&65536)&&(c.clientAreaWidth=a.getLittleEndian32(),c.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+
d+" cw"+c.clientAreaWidth+" ch="+c.clientAreaHeight));0!=(b&131072)&&(c.rpContent=a.getLittleEndian32());0!=(b&262144)&&(c.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){g=a.getLittleEndian32();var w=a.getLittleEndian32();c.winOffsetX=g;c.winOffsetY=w;svGlobal.logger.info("***** winId="+d+" offX"+c.winOffsetX+" offY="+c.winOffsetY)}0!=(b&32768)&&(c.winClientDeltaX=a.getLittleEndian32(),c.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" dX"+c.winClientDeltaX+" dY="+
c.winClientDeltaY));0!=(b&1024)&&(c.winWidth=a.getLittleEndian32(),c.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+d+" w"+c.winWidth+" h="+c.winHeight));if(!l)if(c.isMainWin()||3==c.showState)jc(c);else if(2<c.showState&&(g=J.getFocused())){g=g.getFreeSpace();var E=c.winWidth,H=c.winHeight;if(c.winOffsetX>g.width||c.winOffsetY>g.height||0>E+c.winOffsetX||0>H+c.winOffsetY){var Q=(g.width-c.winWidth)/2|0,A=(g.height-c.winHeight)/2|0;0>Q&&(Q=0);0>A&&(A=0);setTimeout(function(){c.resize(Q,
A,E,H)},50)}}0!=(b&256)&&(g=a.getLittleEndian16(),0<g&&a.skipPosition(8*g));0!=(b&4096)&&(c.visibleOffsetX=a.getLittleEndian32(),c.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),c.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(l)J.onWinChange(c);else J.addWin(c);p&&J.setTitle(d)}else svGlobal.logger.warn("XXX, No win with id:"+d)}function Ob(a,b){function d(f,h,e,k,q){0<q.width?q.union(f,h,e,k):(q.x=f,q.y=h,q.width=e,q.height=k)}function l(f,h,e,k){for(ta=0;ta<Ba;ta++){var q=
Y[ta];if(f>=q[0]&&h>=q[1]&&e<=q[2]&&k<=q[3])return Ca[ta]}return null}function c(f,h,e,k){if(Ba){var q=l(f,h,f+e-1,h+k-1);q&&d(f,h,e,k,q)}else d(f,h,e,k,r)}function p(f,h,e,k,q,u,x){for(var v=q*e+k,y=f.setRGB,F=f.getRGB,B=0;B<x;B++){for(var K=0;K<u;K++){if(f){var da=F(k+K,q+B);y(k+K,q+B,~da&16777215)}else h[v]=~h[v]&16777215;v++}v+=e-u}}function g(f,h,e,k,q,u,x,v,y,F){h=F*v+y;null==x&&(x=f);for(f=0;f<u;f++){for(y=0;y<q;y++)m[k+f][e+y]=m[k+f][e+y]&x[h]&16777215|4278190080,h++;h+=v-q}}function w(f,
h,e,k,q,u,x,v,y,F){h=F*v+y;y=f.setRGB;F=f.getRGB;null==x&&(x=f);for(f=0;f<u;f++){for(var B=0;B<q;B++){var K=F(e+B,k+f);y(e+B,k+f,K|x[h]&16777215);h++}h+=v-q}}function E(f,h,e,k){var q=wa;if(q){var u=q.getRGB(h,e);switch(f){case 0:q.setRGB(h,e,0);break;case 1:q.setRGB(h,e,~(u|k)&16777215);break;case 2:q.setRGB(h,e,u&~k&16777215);break;case 3:q.setRGB(h,e,~k&16777215);break;case 4:q.setRGB(h,e,16777215*(~u&k));break;case 5:q.setRGB(h,e,~u&16777215);break;case 6:q.setRGB(h,e,u^k&16777215);break;case 7:q.setRGB(h,
e,~u&k&16777215);break;case 8:q.setRGB(h,e,u&k&16777215);break;case 9:q.setRGB(h,e,u^~k&16777215);break;case 10:break;case 11:q.setRGB(h,e,u|~k&16777215);break;case 12:q.setRGB(h,e,k);break;case 13:q.setRGB(h,e,(~u|k)&16777215);break;case 14:q.setRGB(h,e,u|k&16777215);break;case 15:q.setRGB(h,e,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+f),q.setRGB(h,e,k)}}}function H(f,h,e,k,q,u,x,v,y){f>v||h>y||(e=f+e-1,e>v&&(e=v),f<u&&(f=u),e=e-f+1,k=h+k-1,k>y&&(k=y),h<x&&(h=x),k=
k-h+1,1>e||1>k||wa.fillRect(f,h,e,k,q))}function Q(f,h,e,k,q,u,x,v,y,F,B,K){if(!(h>B||e>K)){var da=h+k-1;da>B&&(da=B);y=h<y?y:h;da=da-h+1;B=e+q-1;B>K&&(B=K);F=e<F?F:e;K=B-e+1;if(!(1>da||1>K)){B=128;var W=0;x|=4278190080;v|=4278190080;if(y==h&&F==e&&da==k&&K==q)if(0==f)for(var U=0;U<q;U++){f=e+U;for(var ca=0;ca<k;ca++)0==B&&(W++,B=128),0!=(u[W]&B)&&(m[f][h+ca]=v),B>>=1;W++;B=128;W==u.length&&(W=0)}else for(U=0;U<q;U++){f=e+U;for(ca=0;ca<k;ca++)0==B&&(W++,B=128),m[f][h+ca]=0!=(u[W]&B)?v:x,B>>=1;W++;
B=128;W==u.length&&(W=0)}else if(0==f)for(U=0;U<K;U++){f=e+U;for(ca=0;ca<da;ca++)0==B&&(W++,B=128),h+ca>=y&&f>=F&&0!=(u[W]&B)&&(m[f][h+ca]=v),B>>=1;W++;B=128;W==u.length&&(W=0)}else for(U=0;U<K;U++){f=e+U;for(ca=0;ca<da;ca++)0==B&&(W++,B=128),h+ca>=y&&e+U>=F&&(m[f][h+ca]=0!=(u[W]&B)?v:x),B>>=1;W++;B=128;W==u.length&&(W=0)}}}}function A(f,h,e,k,q){this.offset=f;this.baseLine=h;this.width=e;this.height=k;this.fontData=q}function t(f,h,e,k,q,u,x,v,y){this.cache_idx=f;this.rawData=h;this.none=!h;this.hotX=
e;this.hotY=k;this.width=q;this.height=u;this.xorSize=v;this.andSize=y;this.result="";this.distance=0;this.bpp=x;this.system="";if(h){if(!this.distance){f=0;if(h){x=0;for(var F=h.length;x<F;x++)0!=h[x]&&(f+=x%q+(x/q|0))}this.distance=f}if(!this.system){a:switch(this.distance){case 507:f="text";break a;case 2046:case 4359:f="default";break a;default:f=""}this.system=f}}f="";if(!this.system&&h){x=q*u*4;f=62+x+v+y;F=new Uint8Array(f);f=new hi5.DataBuffer(F,0,f);f.setLittleEndian16(0);f.setLittleEndian16(2);
f.setLittleEndian16(1);f.setByte(q);f.setByte(u);f.setByte(0);f.setByte(0);f.setLittleEndian16(e);f.setLittleEndian16(k);f.setLittleEndian32(40+x+v+y);f.setLittleEndian32(22);f.setLittleEndian32(40);f.setLittleEndian32(q);f.setLittleEndian32(2*u);f.setLittleEndian16(1);f.setLittleEndian16(32);f.setLittleEndian32(0);f.setLittleEndian32(v+y);f.setLittleEndian32(0);f.setLittleEndian32(0);f.setLittleEndian32(0);f.setLittleEndian32(0);for(e=u-1;0<=e;e--)for(k=0;k<q;k++)u=h[q*e+k],f.setByte(u&255),f.setByte(u>>
8&255),f.setByte(u>>16&255),f.setByte(u>>24&255);f="data:image/x-icon;base64,"+hi5.Base64.enc(f.getData())}this.url=f}var m=[],z=null,r=new hi5.graphic.Rectangle(0,0,0,0),I="Uint8ClampedArray"in window,G=null,M=0,O=0,ba=0,ea=0,S=null,Y,Ca,ta=0,Ba=0;this.width=a;this.height=b;var Oa=!1,wa=this,xa={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(f){G=f};this.getDirtyArea=function(){return r};this.setImgRect=function(f,h,e,k){M=f;O=h;ba=e;ea=k};this.parseMonitorDef=function(f){var h=
f.split(","),e=h.length,k=[];if(1<e){for(var q=!1,u=0;u<e;u++){var x=h[u].split(":");if(4==x.length)k[u]=Array(5),k[u][0]=parseInt(x[0]),k[u][1]=parseInt(x[1]),k[u][2]=parseInt(x[2]),k[u][3]=parseInt(x[3]),k[u][4]=0==k[u][0]&&0==k[u][1]?1:0;else{q=!0;break}}q&&(svGlobal.logger.warn("invaiid monitorDef:"+f),k.length=0)}return k};this.setMonitorLayout=function(f){var h=f.length,e=0;Y=f;for(Ca=Array(h);e<h;e++)Ca[e]=new hi5.graphic.Rectangle(0,0,0,0);Ba=h};this.setMonitorCount=function(f){Ba=f};this.addImg=
function(f){ba&&(S&&URL.revokeObjectURL(S.src),S=f)};this.flushImgs=function(){S&&(URL.revokeObjectURL(S.src),S=null,ba=0)};this.getData=function(){return m};this.pause=function(f,h){Oa=f;h&&z&&z.fillRect(0,0,a,b)};this.release=function(){r=null;hi5.Arrays.release(Ca);wa.flushImgs();m=z=wa=null;xa=xa.imgData=null};this.isPaused=function(){return Oa};this.setContext=function(f){f!=z&&(z||!f||f.createImageData(1,1).data.buffer||(I=!1),z=f,null!=z&&(xa.imgData=z.createImageData(a,b)))};this.getContext=
function(){return z};this.resize=function(f,h){if(m.length!=h||m[0].length!=f){for(var e=0;e<h;e++)m[e]=new Uint32Array(f);m.length=h;wa.width=a=f;wa.height=b=h;null!=z&&(xa.imgData=z.createImageData(a,b))}};wa.resize(a,b);this.getBuffer=function(){return m};this.setRGB=function(f,h,e){m[h][f]=e|4278190080};this.getRGB=function(f,h){return m[h][f]};this.setRGBs=function(f,h,e,k,q,u,x){var v=f+e,y=h+k;y>b&&(y=b);if(!(f>=a)){v>a&&(e-=v-a);for(v=h;v<y;v++,u+=x)m[v].set(q.subarray(u,u+e),f);c(f,h,e,k)}};
this.moveArea=function(f,h,e,k,q,u){if(0<u){var x=f+q,v=h+u,y;for(y=k-1;0<=y;y--)m[v+y].set(m[h+y].subarray(f,f+e),x)}else if(0>u)for(x=f+q,v=h+u,y=0;y<k;y++)m[v+y].set(m[h+y].subarray(f,f+e),x);else if(0<q){x=f+q;v=h+u;var F;for(y=e-1;0<=y;y--){var B=x+y;var K=f+y;for(F=0;F<k;F++)m[v+F][B]=m[h+F][K]}}else for(x=f+q,v=h+u,y=0;y<e;y++)for(B=x+y,K=f+y,F=0;F<k;F++)m[v+F][B]=m[h+F][K];c(f+q,h+u,e,k)};this.getRGBs=function(f,h,e,k,q){var u=new Uint32Array(e*k),x=f+e;k=h+k;for(var v=0;h<k;h++)u.set(m[h].subarray(f,
x),v),v+=e;q(u)};this.repaint=function(f,h,e,k){var q=xa.imgData.data,u=0,x,v;G&&G.begin("paint");0>f&&(e+=f,f=0);0>h&&(k+=h,h=0);f+e>a&&(e=a-f);h+k>b&&(k=b-h);var y=f+e;var F=h+k;if(I)for(q=new Uint32Array(q.buffer),v=h;v<F;v++)q.set(m[v].subarray(f,y),u),u+=a;else{var B=4*(a-e)|0;for(v=h;v<F;v++){for(x=f;x<y;x++){var K=m[v][x];q[u++]=K&255;q[u++]=K>>8&255;q[u++]=K>>16&255;q[u++]=255}u+=B}}xa.left=f;xa.top=h;xa.width=e;xa.height=k;G&&G.end("paint");return xa};this.postPaint=c;this.draw=function(f,
h,e,k){if(z&&!Oa)if(S&&S.complete&&(z.drawImage(S,M,O,ba,ea),URL.revokeObjectURL(S.src),S=null),Ba){if(f=l(f,h,e,k),f.width)return wa.repaint(f.x,f.y,f.width,f.height),f.width=0,xa}else if(r.width)return wa.repaint(r.x,r.y,r.width,r.height),r.width=0,xa;return null};this.fillRect=function(f,h,e,k,q){var u=f+e,x=h+k;if(m[0].fill)for(var v,y=h;y<x;y++)m[y].fill(q,f,u);else for(y=h;y<x;y++)for(v=f;v<u;v++)m[y][v]=q;c(f,h,e,k)};this.drawLine=function(f,h,e,k,q){if(h==k){if(f>e){var u=f;f=e;e=u}var x=
m[h];e++;if(x.fill)x.fill(q,f,e);else for(u=f;u<e;u++)x[u]=q}else if(f==e)for(h>k&&(u=h,h=k,k=u),k++,u=h;u<k;u++)m[u][f]=q;else{var v=Math.abs(e-f),y=Math.abs(k-h);u=f;x=h;e=e>=f?f=1:f=-1;h=k>=h?k=1:k=-1;if(v>=y){h=f=0;var F=v;var B=v/2|0;var K=y}else k=e=0,F=y,B=y/2|0,K=v,v=y;if(!(1>v))for(v++,y=0;y<v;y++)m[x][u]=q,B+=K,B>=F&&(B-=F,u+=f,x+=k),u+=e,x+=h}};this.bitBlt=function(f,h,e,k,q,u,x,v,y,F){var B=wa;switch(f){case 0:v=B.setRGB;for(B=e;B<e+q;B++)for(y=k;y<k+u;y++)v(B,y,0);break;case 1:f=x;y=
F*v+y;F=B.setRGB;h=B.getRGB;null==f&&(f=B);for(B=0;B<u;B++){for(x=0;x<q;x++)F(e+q,k+u,~(h(e+q,k+u)|f[y])&16777215);y+=v-q}break;case 2:f=x;y=F*v+y;F=B.setRGB;h=B.getRGB;null==f&&(f=B);for(B=0;B<u;B++){for(x=0;x<q;x++){var K=h(e+q,k+u);F(e+q,k+u,K&~f[y]&16777215);y++}y+=v-q}break;case 3:p(B,x,v,y,F,q,u);x?B.setRGBs(e,k,q,u,x,F*v+y,v):B.moveArea(y,F,q,u,e-y,k-F);break;case 4:p(B,null,h,e,k,q,u);g(B,h,e,k,q,u,x,v,y,F);break;case 5:p(B,null,h,e,k,q,u);break;case 6:f=x;y=F*v+y;null==f&&(f=B);for(B=0;B<
u;B++){for(F=0;F<q;F++)m[k+B][e+F]=m[k+B][e+F]^f[y]&16777215|4278190080,y++;y+=v-q}break;case 7:f=x;y=F*v+y;F=B.setRGB;h=B.getRGB;null==f&&(f=B);for(B=0;B<u;B++){for(x=0;x<q;x++)K=h(e+x,k+B),F(e+x,k+B,~(K&f[y])&16777215),y++;y+=v-q}break;case 8:g(B,h,e,k,q,u,x,v,y,F);break;case 9:f=x;y=F*v+y;F=B.setRGB;h=B.getRGB;null==f&&(f=B);for(B=0;B<u;B++){for(x=0;x<q;x++)K=h(e+x,k+B),F(e+x,k+B,K^~f[y]&16777215),y++;y+=v-q}break;case 10:break;case 11:f=x;y=F*v+y;F=B.setRGB;h=B.getRGB;null==f&&(f=B);for(B=0;B<
u;B++){for(x=0;x<q;x++)K=h(e+x,k+B),F(e+x,k+B,K|~f[y]&16777215),y++;y+=v-q}break;case 12:x?B.setRGBs(e,k,q,u,x,F*v+y,v):B.moveArea(y,F,q,u,e-y,k-F);break;case 13:p(B,null,h,e,k,q,u);w(B,h,e,k,q,u,x,v,y,F);break;case 14:w(B,h,e,k,q,u,x,v,y,F);break;case 15:v=B.setRGB;for(B=e;B<e+q;B++)for(y=k;y<k+u;y++)v(B,y,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+f)}c(e,k,q,u)};this.drawLineExt=function(f,h,e,k,q,u){if(f==e||h==k){var x;if(h==k)if(e>f){var v=e-f;if(!(1>v))for(x=0;x<v;x++)E(u,
f+x,h,q)}else{if(v=f-e,!(1>v))for(x=0;x<v;x++)E(u,e+x,h,q)}else if(k>h){if(v=k-h,!(1>v))for(x=0;x<v;x++)E(u,f,h+x,q)}else if(v=h-k,!(1>v))for(x=0;x<v;x++)E(u,f,k+x,q)}else{var y=Math.abs(e-f),F=Math.abs(k-h);x=f;v=h;var B,K;var da=e>=f?B=1:B=-1;var W=k>=h?K=1:K=-1;if(y>=F){W=B=0;var U=y;var ca=y/2>>0;var ya=F}else K=da=0,U=F,ca=F/2>>0,ya=y,y=F;if(1>y)return;for(F=0;F<=y;F++)E(u,x,v,q),ca+=ya,ca>=U&&(ca-=U,x+=B,v+=K),x+=da,v+=W}q=Math.min(f,e);f=Math.max(f,e);e=Math.min(h,k);h=Math.max(h,k);0>f-q||
0>h-e||c(q,e,f-q+1,h-e+1)};this.drawText=function(f,h,e,k,q,u,x,v,y,F,B,K,da,W,U,ca,ya,ob,pb,qb,rb){var Da=0;1<K?H(F,B,K,da,q,ob,pb,qb,rb):1==e&&H(u,x,v,y,q,ob,pb,qb,rb);for(var Fc=ca,qa=0;qa<ca;)switch(ya[Da+qa]){case 255:var ua=ya[Da+qa+2];if(ua>Fc-Da){qa=ca=0;break}ua=ya.slice?ya.slice(Da,Da+ua):ya.subarray(Da,Da+ua);Ja[ya[Da+qa+1]]=ua;qa+=3;ca-=qa;Da=qa;qa=0;break;case 254:var Ma=(ua=Ja[ya[Da+qa+1]])?ua:null;Ma&&0==Ma[1]&&0==(h&32)&&(0!=(h&4)?U+=ya[Da+qa+2]:W+=ya[Da+qa+2]);qa=qa+2<ca?qa+3:qa+
2;ca-=qa;Da=qa;qa=0;if(!Ma)break;for(var Gc=Ma.length,Pa=0;Pa<Gc;Pa++){ua=Ea.getFont(f,Ma[Pa]);if(0==(h&32)){var $a=Ma[++Pa];0!=($a&128)?(0!=(h&4)?U+=Ma[Pa+1]|Ma[Pa+2]<<8:W+=Ma[Pa+1]|Ma[Pa+2]<<8,Pa+=2):0!=(h&4)?U+=$a:W+=$a}ua&&(Q(e,W+ua.offset&65535,U+ua.baseLine&65535,ua.width,ua.height,ua.fontData,q,k,ob,pb,qb,rb),0!=(h&32)&&(W+=ua.width))}break;default:ua=Ea.getFont(f,ya[Da+qa]),0==(h&32)&&($a=ya[Da+ ++qa],0!=($a&128)?(0!=(h&4)?U+=ya[Da+qa+1]|ya[Da+qa+2]<<8:W+=ya[Da+qa+1]|ya[Da+qa+2]<<8,qa+=2):
0!=(h&4)?U+=$a:W+=$a),ua&&(Q(e,W+ua.offset&65535,U+ua.baseLine&65535,ua.width,ua.height,ua.fontData,q,k,ob,pb,qb,rb),0!=(h&32)&&(W+=ua.width)),qa++}1<K?0<da&&c(F,B,K,da):0<v&&0<y&&c(u,x,v,y)};this.drawBitmap=function(f,h,e,k,q,u,x,v,y){var F=Ha.getBitmap(f,h);F?(f=F.width,h=F.height,q>f&&(q=f),u>h&&(u=h),12==y?wa.setRGBs(e,k,q,u,F.data,v*f+x,f):wa.bitBlt(y,a,e,k,q,u,F.data,f,x,v)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+f+" idx="+h)};this.saveDesktop=function(f,h,e,k,q){wa.getRGBs(f,
h,e,k,function(u){ma.save(f,h,e,k,q,u)})};this.restoreDesktop=function(f,h,e,k,q){(q=ma.restore(f,h,e,k,q))?wa.setRGBs(f,h,e,k,q,0,e):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(f,h,e){Ea.putFont(f,h,e)};this.putBitmap=function(f,h,e){Ha.putBitmap(f,h,e)};this.putCursor=function(f,h){X.set(f,h)};this.setCursor=function(f){if(!Oa&&-1!=f){var h=X.get(f);if(h)wa.onSetCursor(h);else svGlobal.logger.warn("invalid cursor"+f)}};var R=0;this.isSendingHistory=function(){return 2E3>
Date.now()-R};this.getHistory=function(f,h){var e=null;G&&G.begin("his_bitmap");Ha.forEach(function(v,y,F){if(v){var B=0,K=0;F=0;for(var da=v.length;F<da;F++)v[F]&&v[F].data&&(B++,K+=v[F].raw?v[F].raw.length:4*v[F].data.length);if(B&&K){e=new Uint8Array(K+20*B+8);e[0]=29;e[2]=1;e[3]=4;K=new hi5.DataBuffer(e,4,e.length);K.setLittleEndian32(B);for(F=0;F<da;F++)(B=v[F])&&B.data&&(K.setLittleEndian16(y),K.setLittleEndian16(F),K.setLittleEndian16(B.left),K.setLittleEndian16(B.top),K.setLittleEndian16(B.width),
K.setLittleEndian16(B.height),K.setLittleEndian16(B.bitsperpixel),K.setLittleEndian16(B.codec),K.setLittleEndian32(B.raw?B.raw.length:4*B.data.length),K.setBytes(B.raw||new Uint8Array(B.data.buffer)));f(e.buffer)}}});G&&G.end("his_bitmap");G&&G.begin("his_font");(e=Ea.toPDU())&&f(e.buffer);G&&G.end("his_font");(e=X.toPDU())&&f(e.buffer);for(var k=4,q=0,u=Ja.length;q<u;q++)Ja[q]&&(k+=Ja[q].length+6);if(4<k){e=new Uint8Array(k);e[0]=29;e[2]=1;e[3]=7;var x=4;q=0;for(u=Ja.length;q<u;q++)Ja[q]&&Ja[q].length&&
(e[x++]=q,e[x++]=q>>8,k=Ja[q].length,e[x++]=k,e[x++]=k>>8,e[x++]=k>>16,e[x++]=k>>24,e.set(Ja[q],x),x+=k);f(e.buffer)}(e=ma.toPDU())&&f(e.buffer);h();R=Date.now()};this.setHistory=function(f,h){switch(f){case 4:G&&G.begin("his_bitmap_dec");var e=h.getLittleEndian32();for(f=0;f<e;f++){var k=h.getLittleEndian16(),q=h.getLittleEndian16(),u=h.getLittleEndian16(),x=h.getLittleEndian16(),v=h.getLittleEndian16(),y=h.getLittleEndian16(),F=h.getLittleEndian16(),B=h.getLittleEndian16(),K=h.getLittleEndian32(),
da=new Uint8Array(h.getData().buffer,h.getPosition(),K),W=new Uint8Array(K);W.set(da);da=rdpcodecs.bitmap;switch(B){case 0:var U=new Uint32Array(W.buffer);h.skipPosition(K);break;case 1:switch(F){case 16:U=da.decompressInt16(v,y,K,W,0);break;case 24:U=da.decompressInt24(v,y,K,W,0);break;case 32:U=da.decompressInt32(v,y,K,W,0)}h.skipPosition(K);break;case 2:U=new rdpcodecs.NSCodec,U.process(h,F,v,y),K=U.getData(),U=U.getDataSize(),U=new Uint32Array(U),rdpcodecs.flipimage(K,0,U,v,y,1)}Ha.putBitmap(k,
q,new rdpcodecs.Bitmap(U,v,y,u,x,F,0==B?null:W,B))}G&&G.end("his_bitmap_dec");break;case 5:Ea.fromStream(h);break;case 6:X.fromStream(h);break;case 7:for(;h.has(6);)if(f=h.getLittleEndian16(),K=h.getLittleEndian32())e=h.getData().subarray(h.getPosition(),h.getPosition()+K),Ja[f]=e,h.skipPosition(K);break;case 9:ma.fromStream(h)}};var X=new function(){var f=[],h=!1;this.useRemoteCursor=function(e){h=e};this.set=function(e,k){h&&(k.system="");f[e]=k};this.get=function(e){return f[e]};this.total=function(){return f.length};
this.toPDU=function(){for(var e=2,k=2,q=0,u=0,x=f.length,v;u<x;u++)if(v=f[u])q++,k=k+7+(v.rawData?v.rawData.length:0);if(!q)return null;k=new Uint32Array(k);k[0]=100728861;k[1]=q;for(u=0;u<x;u++)if(v=f[u])if(q=v.rawData?v.rawData.length:0,k[e++]=v.cache_idx|v.bpp<<16,k[e++]=v.hotX|v.hotY<<16,k[e++]=v.width|v.height<<16,k[e++]=v.xorSize,k[e++]=v.andSize,k[e++]=v.distance,k[e++]=q)k.set(v.rawData,e),e+=q;return k};this.fromStream=function(e){var k=e.getPosition();e=new Uint32Array(e.getData().buffer,
k);var q=e[0],u=0;for(k=1;u<q;u++){var x=e[k]&65535;var v=e[k++]>>16;var y=e[k]&65535;var F=e[k++]>>16;var B=e[k]&65535;var K=e[k++]>>16;var da=e[k++];var W=e[k++];var U=e[k++];var ca=e[k++];var ya=null;ca&&(ya=new Uint32Array(ca),ya.set(e.subarray(k,k+ca)),k+=ca);v=new t(x,ya,y,F,B,K,v,da,W);U&&(v.distance=U);h&&(v.system="");f[x]=v}}};X.useRemoteCursor(!!L.remoteCursor);var ma=new function(){function f(e,k,q,u,x,v){this.x=e;this.y=k;this.cx=q;this.cy=u;this.offset=x;this.data=v}var h=[];this.save=
function(e,k,q,u,x,v){e=new f(e,k,q,u,x,v);k=0;for(q=h.length;k<q;k++)if(!h[k]){h[k]=e;return}h.push(e)};this.restore=function(e,k,q,u,x){for(var v,y=0,F=h.length;y<F;y++)if((v=h[y])&&v.x==e&&v.y==k&&v.cx==q&&v.cy==u){if(v.offset==x)return e=v.data,h[y]=null,e;svGlobal.logger.warn("TODO: offset")}return null};this.toPDU=function(){for(var e=0,k=2,q=0,u=h.length;q<u;q++)h[q]&&(e++,k+=h[q].data.length+6);if(!e||!k)return null;k=new Uint32Array(k);var x=2;k[0]=151060509;k[1]=e;for(q=0;q<u;q++)if(e=h[q])k[x++]=
e.x,k[x++]=e.y,k[x++]=e.cx,k[x++]=e.cy,k[x++]=e.offset,k[x++]=e.data.length,k.set(e.data,x),x+=e.data.length;return k};this.fromStream=function(e){e=new Uint32Array(e.getData().buffer,e.getPosition());for(var k=1,q=e[0],u,x,v,y,F,B,K,da=0;da<q;da++)u=e[k++],x=e[k++],v=e[k++],y=e[k++],F=e[k++],B=e[k++],K=new Uint32Array(B),B=k+B,K.set(e.subarray(k,B)),k=B,this.save(u,x,v,y,F,K)}},Ja=[],Ea=new function(){var f=[];this.putFont=function(h,e,k){f[h]||(f[h]=[]);f[h][e]=k};this.getFont=function(h,e){return f[h]?
f[h][e]:null};this.toPDU=function(){var h=0,e,k,q;var u=4;for(var x,v=f.length;h<v;h++)if((q=f[h])&&q.length)for(x=q.length,e=0;e<x;e++)(k=q[e])&&(u+=15+k.fontData.length);if(5>u)return null;var y=new Uint8Array(u);u=new hi5.DataBuffer(y,0,u);y[0]=29;y[2]=1;y[3]=5;u.skipPosition(4);h=0;for(v=f.length;h<v;h++)if((q=f[h])&&q.length)for(x=q.length,e=0;e<x;e++)if(k=q[e])u.setByte(h),u.setLittleEndian16(e),u.setLittleEndian16(k.offset),u.setLittleEndian16(k.baseLine),u.setLittleEndian16(k.width),u.setLittleEndian16(k.height),
u.setLittleEndian32(k.fontData.length),u.setBytes(k.fontData);return y};this.fromStream=function(h){for(;h.has(15);){var e=h.getByte(),k=h.getLittleEndian16(),q=h.getLittleEndian16(),u=h.getLittleEndian16(),x=h.getLittleEndian16(),v=h.getLittleEndian16(),y=h.getLittleEndian32();y=h.getBytes(y);this.putFont(e,k,new A(q,u,x,v,y))}}},Ha=new function(){var f=[],h=[];this.putBitmap=function(e,k,q){if(32767==k)h[e]&&(h[e].data=null,h[e]=null),h[e]=q;else{var u=f[e];u?u[k]&&(u[k].data=null,u[k]=null):f[e]=
u=[];u[k]=q}};this.getBitmap=function(e,k){return 32767==k?h[e]:f[e]?f[e][k]:null};this.forEach=function(e){for(var k=f.length,q=0;q<k;q++)e(f[q],q,f)}}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=!0;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null};this.mode=0;this.remoteAppLogin=!0;var nb=!1,Ra={},Sa={},gb=null,n=this,Jb=!1,Ga=!1,La=0,hb=
null,ib=null;hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var L=hi5.appcfg,lb="";this.setConfig=function(a){L=a};var Ka="object"==typeof D?D:null,C=Ka?{}:hi5.tool.queryToObj(D.substring(D.indexOf("?")+1)),ja=0,ka=0,ab=(la||C.color||C.server_bpp||16)|0,cb=null,kc=null,ra=null,kb=null,lc="/DOWNLOAD?",mc="/CLIP?";this.setLinks=function(a){a.download&&(lc=a.download);a.clipboard&&(mc=a.clipboard)};this.protocol=Ka?"":D.substring(0,D.indexOf("://")).toLowerCase();this.hasSmartCard=
function(){return ia(C.smartCard)};this.hasScanner=function(){return ia(C.scanner)};this.setProfiler=function(a){kc=a};this.getProfiler=function(){return kc};this.gateway=function(){if(Ka)return"";var a=D.lastIndexOf("/RDP?");-1==a&&(a=D.lastIndexOf("/JOIN?"));-1==a&&(a=D.lastIndexOf("/PLAY?"));return D.substring(0,a).replace(/wss:\/\//ig,"https://").replace(/ws:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=Xa;var Ua="object"==typeof D||
0<D.indexOf("/PLAY?"),nc=!Ua&&0<D.indexOf("invitation=");if(nc){var Mb=decodeURIComponent(D),sb=Mb.indexOf(' USERNAME="');if(0<sb){sb+=11;var oc=Mb.substring(sb,Mb.indexOf('"',sb));D+="&novice="+oc+"&server="+oc}D+="&mapClipboard=on";C.mapClipboard="on"}if(Ua)this.mode=1,Ka?D="":(ja=640,ka=480),D+="&touchpad=on",C.touchpad="on",this.reconnectOnResize=!1;else if(0<D.indexOf("/JOIN?")||nc)this.mode=2,this.reconnectOnResize=!1;N?ja=parseInt(N):C.width&&(ja=parseInt(C.width));T?ka=parseInt(T):C.height&&
(ka=parseInt(C.height));-1==ja&&(ja=hi5.browser.getScreenWidth());-1==ka&&(ka=hi5.browser.getScreenHeight());C.symlink&&C.parameters&&hi5.tool.queryToObj(C.parameters,C);C.gateway||(D+="&gateway="+encodeURIComponent(n.gateway));!C.minWidth&&L.minWidth&&(C.minWidth=L.minWidth);!C.minHeight&&L.minHeight&&(C.minHeight=L.minHeight);C.minWidth&&(C.minWidth=parseInt(C.minWidth));C.minHeight&&(C.minHeight=parseInt(C.minHeight));C.waWidth=C.waWidth?parseInt(C.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?
Math.max(screen.width,screen.height):screen.width;C.waWidth&=-4;C.waHeight=C.waHeight?parseInt(C.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;C.waHeight&=-4;"useSSL"in C||(D+="&useSSL="+("wss"==n.protocol));hi5.storage.isAvailable&&(ia(C.shareClipboard)||C.shareClipboardId)&&(D+="&shareClipboardId="+(C.shareClipboardId||pc()));L&&(void 0!=L.displayMsg?this.displayMsg=L.displayMsg:L.displayMsg=this.displayMsg,L.appTimeout&&(this.appTimeout=L.appTimeout),
void 0!=L.reconnectOnResize&&(this.reconnectOnResize=L.reconnectOnResize),L.reconnectTimes&&(this.reconnectTimes=L.reconnectTimes),void 0!=L.windowState&&(this.windowState=L.windowState),void 0!=L.openLink&&(this.openLink=L.openLink),void 0!=L.setTitle&&(this.setTitle=L.setTitle),L.audioBuffer&&(this.audioBuffer=L.audioBuffer),"boolean"==typeof L.useWSS&&(D=(L.useWSS?"wss":"ws")+D.substring(D.indexOf("://"))),"boolean"==typeof L.remoteAppLogin&&(this.remoteAppLogin=L.remoteAppLogin,nb=!L.remoteAppLogin,
svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),"boolean"==typeof L.hideLogin&&(nb=L.hideLogin));ia(C.nocurosr);var Fa="app"==C.startProgram,mb=ia(C.mapDisk),Va=0,oa=null;Fa&&(this.reconnectOnResize=!1);void 0==L.useWorker&&(L.useWorker=!1);L.useWorker&&(!window.Worker||hi5.browser.isFirefox||Fa&&!hi5.browser.isIE||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(L.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var na=L.useWorker?new Worker(Nb("rdpworker",
hi5.libMin?"rdpworker_min.js":"rdpworker.js")):null,bb=this.reconnectTimes,yb=na?{type:5,data:null}:null;this.getDisplayName=db;this.server=db();this.port=parseInt(C.port,10);this.loadbalanceToken=L.loadbalanceTokenName?L.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.modifyURL=function(a){n.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+n.loadbalanceToken:"&"+n.loadbalanceToken);return a};this.getURL=function(){return D};this.getColor=function(){return ab};this.changeTitle=tb;hi5.browser.isTouch&&
Math.max(ja,ka)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=!1);this.isRemoteApp=function(){return Fa};var Z=null,fa=!1,Za=!1,Lb=!1,pa=new function(a){var b=null;this.available=!1;this.delay=a;this.supportWebAudio=!1;(0==C.playSound||0<n.mode)&&(b=hi5.audio.getAudioContext())&&hi5.audio.playable&&(this.supportWebAudio=this.available=!0);this.getContext=function(){return b};this.getBuffer=function(p){return b.createBuffer(2,p,Na)};var d=0,l=null,c=null;this.setVolume=function(p){1==
p?l=null:(l||(l=b.createGain()),l.gain.value=p)};this.playBuffer=function(p){c=b.createBufferSource();c.buffer=p;l?(c.connect(l),l.connect(b.destination)):c.connect(b.destination);var g=b.currentTime,w=0<d?d:g+a;w<g&&(w=g);d=w+p.duration;c.start?c.start(w):c.noteOn(w);return d-g};this.iOSFix=function(){if(b&&hi5.browser.isSafari){var p=this.getBuffer(1024),g=b.createBufferSource();g.buffer=p;g.connect(b.destination);g.start?g.start(0):g.noteOn(0)}};this.close=function(){b&&(l&&l.disconnect(),c&&c.disconnect(),
hi5.audio.releaseAudioContext())}}(n.audioBuffer),Xb=pa.available,P=new Ob(200,200);P.onSetCursor=Yb;this.setVolume=function(a){pa&&pa.setVolume(a)};this.setAudioBuffer=function(a){n.audioBuffer=a;pa.delay=a};var vb=0,ub=0,wb=ja-1,xb=ka-1,gc="";window.$rdp||(window.$rdp=this);eb(ab);this.running=function(){return fa};this.setJoinMode=function(a){fa&&V("8E1"+a)};this.setJoinCloseMode=function(a){fa&&V("8EB3\t"+a)};this.refuseControl=function(a){fa&&V("8E3"+a)};this.giveControl=function(a){fa&&V("8E4"+
a)};this.pauseSession=function(a,b){fa&&V("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){fa&&V("8EB2\t"+a)};this.requestControl=function(){fa&&V("8E2")};this.saveSession=function(a){fa&&V("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){fa&&V("8EA"+a+"\t"+(b?1:0))};var jb=new function(){function a(){if(d&&0<d.length){var p=d.shift();p.key?jb.sendSingleKey(p.down,p.key):p.char&&Pb(p.char);0<d.length?setTimeout(a,l):(d=null,c&&c())}}var b={" ":57,space:57,pgup:201,
pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(p,g){var w=b[g.toLowerCase()];w?n.writeScancode(p,w):(w=g.length,0!=w&&(1==w?n.writeKeyCode(p,
g.toUpperCase().charCodeAt(0)):p&&n.writeText(g)))};var d=null,l=0,c=null;this.sendKeyComb=function(p,g,w){if(Ga){p=p.split("+");var E=p.length,H;if(0!=E){var Q=null,A=[];for(H=0;H<E;H++){var t=p[H];""==t&&""==Q&&(t="Add");""!=t&&A.push({key:t,down:!0});Q=t}E=A.length;for(H=E-1;0<=H;H--)A.push({key:A[H].key,down:!1});if(g)d=A,l=g,c=w,a();else for(H=0,E=A.length;H<E;H++)jb.sendSingleKey(A[H].down,A[H].key)}}};this.sendText=function(p,g,w){for(var E=[],H=0,Q=p.length;H<Q;H++)E.push({"char":p.charAt(H)});
d=E;l=g;c=w;a()}};this.writeKeyComb=function(a,b,d){Ga&&jb.sendKeyComb(a,b,d)};this.writeText=function(a,b,d){if(Ga)if(b)jb.sendText(a,b,d);else for(b=0,d=a.length;b<d;b++)Pb(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),n.writeRawInput("880"+b+"\t"+a.hashCode()),ib={type:b,text:a})};var J=new function(a,b){function d(){function c(A){for(;0<A.ownerWinid;){var t=H.getWinById(A.ownerWinid);if(t&&t.isVisible())A=t;else break}return A}function p(A){for(var t="";A;)A.titleInfo&&
(t=A.titleInfo),A=H.getWinById(A.ownerWinid);return t}var g=[],w=[],E=0,H=this;this.mainWin=null;this.appId="";var Q=0;this.getActiveWinId=function(){return Q};this.setActiveWinId=function(A){svGlobal.logger.info("setActiveWinId: "+A+" old: "+Q);if(Q!=A){var t=0==Q;Q=A;(A=H.getMainByWinId(A))&&A.isMainWin()&&H.mainWin!=A&&(H.mainWin=A);t&&(t=J.getFocused())&&(t=t.getFreeSpace(),A=t.width,n.resetSize(A,t.height))}};this.onchange=function(A){A.isVisible()||A!=H.mainWin?A.isVisible()&&!H.mainWin&&A.isMainWin()&&
(H.mainWin=A,a.windowState&&A.exeCommand(61488)):H.mainWin=null};this.addWin=function(A){for(var t=g.length,m=!1,z=0;z<t;z++)if(A.id==g[z].id){g[z]=A;m=!0;break}m||g.push(A);1==g.length&&(E=Date.now());t=A.isMainWin();svGlobal.logger.info("is main win:"+t+" id:"+A.id);t&&!H.mainWin&&(H.mainWin=A)};this.popWins=function(A){A=H.getWinById(A);var t=[];if(A){A=0<A.ownerWinid?A.ownerWinid:A.id;for(var m=g.length-1;0<=m;m--)if(g[m].ownerWinid==A||g[m].id==A)t.push(g[m]),g.splice(m,1)}return t};this.hasApp=
function(A){return-1!=w.indexOf(A)};this.addApp=function(A){return-1==w.indexOf(A)?(w.push(A),!0):!1};this.isNew=function(){return 3E4>Date.now()-E};this.getAll=function(){return g};this.hasWin=function(A){return 0<=g.indexOf(A)};this.close=function(){for(var A=0,t=g.length;A<t;A++)g[A].close()};this.clear=function(){g.length=0};this.delWin=function(A){for(var t=0,m=g.length;t<m;t++)if(g[t].id==A)return g.splice(t,1),t;return-1};this.isRunning=function(){var A=g.length;if(1>A)return!1;var t=0;for(A=
g.length;t<A;t++){var m=g[t];if(m.showState)return!0}return!1};this.getWinById=function(A){var t=g.length;if(1>t)return null;for(var m=0;m<t;m++){var z=g[m];if(z.id==A)return z}return null};this.getMainWinByAppId=function(A){var t=null,m=0;for(len=g.length;m<len;){t=g[m];if(t.appId==A&&t.isVisible()&&1>t.ownerWinid)break;m++}return t};this.getTopWin=function(A){var t=null,m,z=A.length;for(m=0;m<z&&(!(t=H.getWinById(A[m]))||!t.isVisible());m++)t=null;if(!t)for(svGlobal.logger.warn("No win found"),
z=g.length,m=z-1;0<=m&&(t=g[m],!t.isVisible());m--)t=null;return t};this.getMain=function(A){return(A=H.getTopWin(A))?c(A):null};this.getMainByWinId=function(A){return(A=H.getWinById(A))?c(A):null};this.getOtherApps=function(A,t,m){var z=g.length;if(0!=z&&g[z-1])if(z=g[z-1].appId,m||!z)setTimeout(function(){H.getOtherApps(A,t)},m||3E3);else{m=[];if(z=H.getTopWin(A)){var r=0<z.ownerWinid?z.ownerWinid:z.id,I=[],G=0;for(z=g.length;G<z;G++)g[G].ownerWinid!=r&&g[G].id!=r&&g[G].isVisible()&&I.push(g[G]);
G=0;for(z=I.length;G<z;G++)I[G].ownerWinid!=r&&I[G].id!=r&&(m.push({title:p(I[G]),win:c(I[G])}),r=0<I[G].ownerWinid?I[G].ownerWinid:I[G].id)}t(m)}};this.getFullTitle=function(A){for(var t,m="";;){t=H.getWinById(A);if(!t)break;t.titleInfo&&t.isVisible()&&(m&&(m=" > "+m),m=t.titleInfo+m);if(1>A)break;A=t.ownerWinid}return m}}var l=[];this.tryCloseRemoteApps=function(){if(a&&a.isRemoteApp())for(var c=l.length,p=0;p<c;p++)l[p].railWin&&l[p].railWin.close()};this.verifyMonitors=function(){var c=l[0].getMousePosition(),
p,g=l.length;l[0].configMonitor();for(p=1;p<g;p++){l[p].configMonitor();var w=l[p].getMousePosition();Math.abs(w.left)+Math.abs(w.top)<Math.abs(c.left)+Math.abs(c.top)&&(c=w)}0!=c.left&&(c.right-=c.left,c.left=0);0!=c.top&&(c.bottom-=c.top,c.top=0);for(p=0;p<g;p++)if(w=l[p].getMousePosition(),w!=c){if(0>w.right){var E=-w.right-1;0<E&&(w.left+=E,w.right+=E)}w.left>c.right&&(E=w.left-c.right-1,0<E&&(w.left-=E,w.right-=E));0>w.bottom&&(E=-w.bottom-1,0<E&&(w.top+=E,w.bottom+=E));w.top>c.bottom&&(E=w.top-
c.bottom-1,0<E&&(w.top-=E,w.bottom-=E))}};this.repaint=function(c,p,g,w){for(var E=0,H=l.length;E<H;E++)l[E].repaint(c,p,g,w)};this.size=function(){return l.length};this.getSurface=function(c){return l[c]};this.addSurface=function(c){l.push(c)};this.hasSurface=function(c){for(var p=l.length,g=0;g<p;g++)if(l[g].equals(c))return!0;return!1};this.fromSyncedSurface=function(c){var p=l.length;Date.now();for(var g=0;g<p;g++)if(l[g].isClipSynced(c))return!0;return!1};this.setSize=function(c,p,g){for(var w=
0,E=l.length;w<E;w++)l[w].setSize(c,p,g)};this.zOrders=[];this.drawLicense=function(c){for(var p=0,g=l.length;p<g;p++)l[p].drawLicense(c)};this.setReadOnly=function(c,p){for(var g=0,w=l.length;g<w;g++)l[g].setReadOnly(c,p)};this.setVisible=function(c,p){svGlobal.logger.info("TODO: setVisible")};this.setCursor=function(c){for(var p=0,g=l.length;p<g;p++)l[p]&&l[p].setCursor(c)};this.hide=function(c){c=0;for(var p=l.length;c<p;c++)l[c]&&l[c].hide()};this.execute=function(c,p){for(var g=0,w=l.length;g<
w;g++)l[g][c].apply(l[g],p)};this.addWin=function(c){var p=this.getFocused();p||(svGlobal.logger.warn("Focused surface not found!"),p=l[l.length-1]);p?(Fa=!0,p.railWin||(p.railWin=new d,p.onunload=function(){hi5.appcfg.closeRemoteApp&&p.railWin&&p.railWin.close();p.remoteApp&&p.remoteApp.close();p.railWin&&(p.railWin.clear(),p.railWin=null);l.removeElm(p)}),p.context&&b.setContext(p.context),p.railWin.addWin(c),p.railWin.mainWin==c&&setTimeout(function(){var g=p.getFreeSpace();a.writeRawInput("8C661441\t"+
g.width+"\t"+g.height);svGlobal.logger.info("-- main win dp change:"+g.height);a.windowState&&c.resizable()&&setTimeout(function(){c.exeCommand(61488);svGlobal.logger.info("-- max")},50)},111),hi5.browser.isIE&&p.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(c){for(var p,g=l.length-1;0<=g;g--){var w=l[g];p=w.railWin;var E=p.getWinById(c),H=E&&E.appId&&-1!=E.appId.toLowerCase().indexOf("runonce");if(0<=p.delWin(c)){E==p.mainWin&&(p.mainWin=null);if(w.toolbar){c="win"+
c;var Q=w.toolbar.querySelector("#"+c);Q&&w.toolbar.removeChild(Q)}if(!p.isRunning()){if(E.isMainWin()&&w.onremoteappclose)w.onremoteappclose(E);E=a.appTimeout;if(H||p.isNew())E*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(A){return function(){svGlobal.logger.info("Start del:"+Date.now());A.railWin&&A.railWin.isRunning()||(A.remoteApp&&A.remoteApp.close(),J&&J.delSurface(A))}}(w),E)}}}};this.popWins=function(c){return l[0]&&l[0].railWin?l[0].railWin.popWins(c):[]};this.getWinById=
function(c){for(var p,g=0,w=l.length;g<w;g++)if(l[g].railWin&&(p=l[g].railWin.getWinById(c)))return p;return null};this.getMainWinByAppId=function(c){for(var p,g=0,w=l.length;g<w;g++)if(l[g].railWin&&(p=l[g].railWin.getMainWinByAppId(c)))return p;return null};this.onWinChange=function(c){for(var p,g=0,w=l.length;g<w;g++)if(l[g].railWin&&(p=l[g].railWin.getWinById(c.id)))l[g].railWin.onchange(c)};this.setTitle=function(c){for(var p,g=0,w=l.length;g<w;g++)if(l[g].railWin){p=l[g].railWin.getWinById(c);
var E=l[g].railWin.getFullTitle(c);if(E){a.changeTitle(E,l[g].getWindow(),p.appId);break}}};this.hasApp=function(c){for(var p=0,g=l.length;p<g;p++)if(l[p].railWin.hasApp(c))return!0;return!1};this.delSurface=function(c){!c||c.railWin&&c.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),l.removeElm(c),c.close(),0==l.length&&a._unload())};this.getOwnerSurface=function(c){for(var p=0,g=l.length;p<g;p++)if(l[p].railWin&&l[p].railWin.hasWin(c))return l[p];return null};this.getOwnerSurfaceById=
function(c){for(var p,g=0,w=l.length;g<w;g++)if(l[g].railWin&&(p=l[g].railWin.getWinById(c)))return l[g];return null};this.getFocused=function(){for(var c=l.length,p=0;p<c;p++)if(l[p].focused)return l[p];return l[c-1]};this.close=function(){for(var c=0,p=l.length;c<p;c++)l[c]&&(l[c].remoteApp&&l[c].remoteApp.close(),l[c].close(),l[c]=null)};this.LocalWin=function(c){function p(){a.writeRawInput("8C0"+c)}this.id=c;this.appId="";var g=this;this.resizable=function(){return g.isVisible?0!=(g.style&262144)||
0!=(g.style&65536)||0!=(g.style&16777216)||3==g.showState:!1};this.setShowState=function(w){g.showState=w};this.parent=function(){return J.getWinById(g.ownerWinid)};this.resize=function(w,E,H,Q){hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+g.id+"\t"+w+"\t"+E+"\t"+H+"\t"+Q)};this.exeCommand=function(w){a.writeRawInput("8C4"+c+"\t"+w)};this.activate=function(w){2==g.showState?(g.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+c+"\t"+w)},50)):a.writeRawInput("8C3"+
c+"\t"+w)};this.close=function(){g.exeCommand(61536)};this.getAppId=p;this.isVisible=function(){return g.winWidth&&g.winHeight&&g.showState&&45<g.winHeight&&45<g.winWidth};this.isMainWin=function(){if(!(g.isVisible()&&g.winWidth&&g.winHeight&&45<g.winHeight&&45<g.winWidth))return!1;var w=1>g.ownerWinid;if(!w)return w;var E=g.style;if(0!=(E&4194304))return!0;if(0!=(E&2147483648)&&(0==(E&8388608)||0==(E&12582912)))return!1;var H=0!=(g.extStyle&128);(w=w&&!H)&&0!=(E&2147483648)&&0==(E&2156396544)&&(w=
!1);return w};p()}}(n,P);this.getSurfaces=function(){return J};this.hide=function(){J&&J.hide()};this.getFileUrl=function(a){var b=Xa(),d=lc,l=d.indexOf("://");b=(0<l&&11>l?d:b+d)+"s="+gc+"&f="+a;return n.modifyURL(b)};this.listFiles=function(a,b){oa&&Ga&&oa.list(a,b)};this.writeRawInput=function(a){if(Ga){V(a);if(n.onactivity)n.onactivity(a);return!0}return!1};this.authWithCode=function(a,b){var d=a.length,l=new Uint8Array(5+d);l[0]=146;l[1]=7;l[2]=b;l[3]=d&255;l[4]=d>>8&255;for(b=0;b<d;b++)l[5+
b]=a.charCodeAt(b);V(l.buffer)};var va=new function(a,b,d,l){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.localLockFlags=l||0;this.remoteLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;this.draw=d.draw;var c=a.isRemoteApp(),p=void 0;this.saveResize=function(g){p=a.reconnectOnResize;a.reconnectOnResize=g};this.restoreResize=function(){void 0!=p&&(a.reconnectOnResize=p)};this.refresh=function(g,w,E,H){return d.repaint(g,
w,E-g+1,H-w+1)};this.getAppMode=function(){return a.mode};this.send=a.writeRawInput;this.saveSession=function(g){a.saveSession(g)};this.sendInput=a.writeRawInput;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.resumeAudio=function(){pa.supportWebAudio&&pa.iOSFix()};this.onresize=function(g){if(g=g.target.svSurface){var w=g.getFreeSpace(),E=w.width;w=w.height;va.checkLockFlags=!0;L.scale&&!c?g.scaleTo(E,w,!1):a.resetSize(E,w)}};this.onorientationchange=function(g){a.resetSize(g.innerWidth,
g.innerHeight)};this.getClipData=function(g,w){this.reqCopyTime=Date.now();var E=a.getGatewayAddr(),H=mc,Q=H.indexOf("://");E=(0<Q&&11>Q?H:E+H)+"s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+g;g=hi5.httpGet(a.modifyURL(E),w);this.reqCopyTime=Date.now();hc(g);return g};this.onfocus=function(g){var w=J.getFocused();c&&w&&w.railWin&&(g=w.railWin.mainWin)&&a.running()&&(w=w.context)&&w!=d.getContext()&&(d.setContext(null),g.activate(1),svGlobal.logger.info("Activate win:"+g.id))};this.getShareFiles=
a.listFiles;this.getFile=function(g){a.reconnectOnResize=!1;var w=a.getFileUrl(g);n.ondownload&&n.ondownload({fileName:g,url:w})||window.open(w)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return D};this.reconnect=function(g,w,E){C.symlink?(g="user="+g+"&pwd="+w,E&&(g+="&domain="+E),D=hi5.tool.replaceQuery(D,"parameters",g)):(D=hi5.tool.replaceQuery(D,"user",g),D=hi5.tool.replaceQuery(D,"pwd",w),D=hi5.tool.replaceQuery(D,"domain",E));a.run()};this.sendKeyboardSyncFlags=function(g){return Ga?
(this.remoteLockFlags=this.localLockFlags=g,setTimeout(function(){a.writeRawInput("8E5"+g)},300),!0):!1};this.sendKeyboardSynchronize=function(g,w,E){var H=0;E&&(H|=4);w&&(H|=2);g&&(H|=1);this.sendKeyboardSyncFlags(H)};this.fromSyncedSurface=function(g){return b.fromSyncedSurface(g)};this.setWorkDir=function(g){a.writeKeyComb("Windows+R",20,function(){setTimeout(function(){a.writeText(g,10,function(){a.writeScancode(!0,28);a.writeScancode(!1,28)})},666)})};this.authWithCode=function(g,w){a.authWithCode(g,
w)}}(n,J,P,0);this.sendKeyboardSynchronize=function(a,b,d){va.sendKeyboardSynchronize(a,b,d)};var sa=null,ha={count:0,names:[],close:function(){for(var a=ha.names,b=0,d=a.length;b<d;b++)ha[a[b]].onclose&&(ha[a[b]].onclose(),ha[a[b]]=null);a.length=0},init:function(a,b,d,l,c,p){function g(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.cbSize=this.bitsPerSample=
this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.extenstion=null;var t=this;this.fromBuffer=function(m,z){t.formatTag=m.getLittleEndian16();t.nChannels=m.getLittleEndian16();t.nSamplesPerSec=m.getLittleEndian32();t.nAvgBytesPerSec=m.getLittleEndian32();t.nBlockAlign=m.getLittleEndian16();t.bitsPerSample=m.getLittleEndian16();var r=m.getLittleEndian16();t.cbSize=r;0<r&&!0!==z&&(t.extenstion=Array(r),m.copyToByteArray(t.extenstion,0,m.getPosition(),r),m.skipPosition(r))};
this.toBuffer=function(m){m.setLittleEndian16(t.formatTag);m.setLittleEndian16(t.nChannels);m.setLittleEndian32(t.nSamplesPerSec);m.setLittleEndian32(t.nAvgBytesPerSec);m.setLittleEndian16(t.nBlockAlign);m.setLittleEndian16(t.bitsPerSample);m.setLittleEndian16(t.cbSize);0<t.cbSize&&m.setBytes(t.extenstion)};this.getSize=function(){return 18+t.cbSize};this.toString=function(){return"Audio Format, tag="+t.formatTag+" nChannels="+t.nChannels+" nSamplesPerSec="+t.nSamplesPerSec+" nAvgBytesPerSec="+t.nAvgBytesPerSec+
" nBlockAlign="+t.nBlockAlign+" bitsPerSample="+t.bitsPerSample+" cbSize="+t.cbSize}}function w(){sa=new n.DynamicChannel;sa.name="Microsoft::Windows::RDS::DisplayControl";sa.enabled=!1;sa.process=function(t){var m=t.getLittleEndian32();t.getLittleEndian32();switch(m){case 5:m=t.getLittleEndian32(),sa.maxMonitorAreaFactorA=t.getLittleEndian32(),sa.maxMonitorAreaFactorB=t.getLittleEndian32(),sa.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+m+" factorA:"+sa.maxMonitorAreaFactorA+
" factorB:"+sa.maxMonitorAreaFactorB),t=new Uint8Array(2),t[0]=146,t[1]=4,V(t.buffer),ra&&setTimeout(function(){ra&&ra.check(5E3)},1900)}};sa.applyResolution=function(t,m){if(sa.enabled){var z=new Uint8Array(56),r=new RdpBuffer(z,0,56);t=t>sa.maxMonitorAreaFactorA?sa.maxMonitorAreaFactorA:t&-4;m=m>sa.maxMonitorAreaFactorB?sa.maxMonitorAreaFactorB:m&-4;r.setLittleEndian32(2);r.setLittleEndian32(56);r.setLittleEndian32(40);r.setLittleEndian32(1);r.setLittleEndian32(1);r.setLittleEndian32(0);r.setLittleEndian32(0);
r.setLittleEndian32(t);r.setLittleEndian32(m);r.setLittleEndian32(.26458*t|0);r.setLittleEndian32(.26458*m|0);r.setLittleEndian32(t>m?0:90);r.setLittleEndian32(100);r.setLittleEndian32(100);sa.send(z);svGlobal.logger.warn("Display control: "+t+"x"+m)}else svGlobal.logger.warn("Display control disabled.")};return sa}if(!L.disableDVC){if(L.enableEcho){var E=new n.DynamicChannel;E.name="ECHO";E.process=function(t){var m=t.getPosition(),z=t.getEnd(),r=new Uint8Array(z-m);r.set(t.getData().subarray(m,
z));E.send(r)};n.addDynamicChannel(E)}if(a){var H=new n.DynamicChannel;H.name="Microsoft::Windows::RDS::Input";H.process=function(t){var m=t.getLittleEndian16();t.getLittleEndian32();switch(m){case 1:t.skipPosition(4),t=new RdpBuffer(new Uint8Array(16),0,16),t.setLittleEndian16(2),t.setLittleEndian32(16),t.setLittleEndian32(3),t.setLittleEndian32(65536),t.setLittleEndian16(256),t.markEnd(),H.send(t);case 5:J.execute("setTouchRemoting",[!0]);ha.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");
break;case 4:J.execute("setTouchRemoting",[!1]),ha.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};n.addDynamicChannel(H)}if(d){svGlobal.logger.warn("Audio input on");var Q=new n.DynamicChannel;(function(){function t(S){var Y=new RdpBuffer(new Uint8Array(5),0,5);Y.setByte(7);Y.setLittleEndian32(S);Y.markEnd();Q.send(Y)}function m(S){var Y=S.getLittleEndian32(),Ca=S.getLittleEndian32(),ta=new g;ta.fromBuffer(S,!0);var Ba=0,Oa=0;0<ta.cbSize&&(22==ta.cbSize?(Ba=S.getLittleEndian16(),
Oa=S.getLittleEndian32(),S.skipPosition(16)):(svGlobal.logger.warn("Wrong cbsize: "+ta.cbSize),S.skipPosition(ta.cbSize)));S=r[Ca];svGlobal.logger.info("Selceted rec fmt, framesPerPacket: "+Y+" initial: "+Ca+", "+S.toString());svGlobal.logger.info("Open fmt: "+ta.toString()+" validBits:"+Ba+" mask:"+Oa);G=!0;M=n.reconnectOnResize;n.reconnectOnResize=!1;ea.onopen||(ea.onopen=function(wa){if(fa){z=wa;n.reconnectOnResize=M;t(Ca);var xa=new RdpBuffer(new Uint8Array(5),0,5);xa.setByte(4);xa.setLittleEndian32(wa?
0:1);xa.markEnd();Q.send(xa)}});ea.ondata||(ea.ondata=function(wa,xa){z&&(O.length!=xa+1&&(O=new Uint8Array(xa+1),O[0]=6),Q.send(I),O.set(wa,1),Q.send(O))});ea.start(S,Y)}Q.name="AUDIO_INPUT";Q.process=function(S){var Y=S.getByte();switch(Y){case 1:S=S.getLittleEndian32();Y=new RdpBuffer(new Uint8Array(5),0,5);Y.setByte(1);Y.setLittleEndian32(S);Y.markEnd();Q.send(Y);break;case 2:var Ca=S.getLittleEndian32();S.getLittleEndian32();var ta=pa.getContext().sampleRate;for(Y=r.length=0;Y<Ca;Y++){var Ba=
new g;Ba.fromBuffer(S);svGlobal.logger.info("Server rec fmt "+Y+":"+Ba.toString());0==l&&49==Ba.formatTag&&22050==Ba.nSamplesPerSec?r.push(Ba):1==Ba.formatTag&&Ba.nSamplesPerSec<=ta&&r.push(Ba)}Q.send(I);Ca=0;S=r.length;for(Y=0;Y<S;Y++)Ca+=r[Y].getSize();ta=new RdpBuffer(new Uint8Array(1024),0,1024);ta.setByte(2);ta.setLittleEndian32(S);ta.setLittleEndian32(Ca+9);for(Y=0;Y<S;Y++)r[Y].toBuffer(ta),svGlobal.logger.info("Client rec fmt: "+r[Y].toString());ta.skipPosition(1024-Ca-9);ta.markEnd();Q.send(ta);
break;case 3:m(S);break;case 7:Y=S.getLittleEndian32();svGlobal.logger.info("Rec fmt change, "+r[Y].toString()+" by client:"+G);G||(t(Y),G=!1);break;default:svGlobal.logger.warn("audioInput: invalid tag:"+Y)}};var z=!1,r=[];Q.onclose=function(){z=!1;ea&&ea.close()};var I=new Uint8Array(1);I[0]=5;var G=!1,M=n.reconnectOnResize,O=new Uint8Array(0),ba=Nb("audiorecorder",hi5.libMin?"audiorecorder_min.js?v=0":"audiorecorder.js?v=0"),ea=window.AudioWorkletNode?new hi5.audio.WorkletRecorder(pa.getContext(),
ba):new hi5.audio.Recorder(pa.getContext())})();n.addDynamicChannel(Q)}n.addDynamicChannel(function(){var t=new n.DynamicChannel;t.name="TSMF";var m={type:"image/jpeg"},z=Array(1);t.process=function(r){r.getPosition();var I=r.getLittleEndian32()&1073741823;var G=r.getLittleEndian32();var M=r.getLittleEndian32();switch(I){case 2:if(256==M){r.getLittleEndian32();M=new Uint8Array(16);var O=new RdpBuffer(M,0,16);O.setLittleEndian32(2);O.setLittleEndian32(G);O.setLittleEndian32(1);O.setLittleEndian32(0);
t.send(M)}break;case 0:switch(M){case 257:r.getBytes(16);r.getLittleEndian32();break;case 256:I=r.getPosition();O=r.getLittleEndian32();for(M=0;M<O;M++){r.getLittleEndian32();var ba=r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(ba-4)}M=r.getPosition()-I;O=M+8+4;M=new Uint8Array(O);O=new RdpBuffer(M,0,O);O.setLittleEndian32(-2147483648);O.setLittleEndian32(G);M.set(r.getData().subarray(I,r.getPosition()),8);t.send(M);break;case 261:r.getBytes(16);r.getLittleEndian32();break;case 264:I=
r.getLittleEndian32();r.skipPosition(4);r.getLittleEndian32();ba=r.getBytes(16);var ea=r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.getLittleEndian32();var S=r.getBytes(16);M=r.getLittleEndian32();r.skipPosition(M);M=new Uint8Array(20);O=new RdpBuffer(M,0,20);O.setLittleEndian32(-2147483648);O.setLittleEndian32(G);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],ba)&&hi5.Arrays.equals([77,74,80,71,0,0,16,0,128,0,0,170,0,56,155,113],ea)&&hi5.Arrays.equals([128,
159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],S)?O.setLittleEndian32(1):(O.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(ba),svGlobal.logger.warn(ea),svGlobal.logger.warn(S));O.setLittleEndian32(I);t.send(M);break;case 258:r.getBytes(16);r.getLittleEndian32();I=r.getLittleEndian32();r.skipPosition(I);break;case 263:r.getBytes(16),M=new Uint8Array(16),O=new RdpBuffer(M,0,16),O.setLittleEndian32(-2147483648),O.setLittleEndian32(G),O.setLittleEndian32(1),
t.send(M);case 277:r.getBytes(16);r.getLittleEndian32();break;case 262:r.getBytes(16);P.flushImgs();P.setImgRect(0,0,0,0);M=new Uint8Array(12);O=new RdpBuffer(M,0,12);O.setLittleEndian32(-2147483648);O.setLittleEndian32(G);t.send(M);break;case 278:r.getBytes(16);G=r.getLittleEndian32();M=r.getLittleEndian32();I=r.getLittleEndian32();r=r.getLittleEndian32();P.setImgRect(G,M,I-G,r-M);break;case 265:r.getBytes(16);r.getLittleEndian64();r.getLittleEndian32();break;case 266:r.getBytes(16);break;case 268:r.getBytes(16);
break;case 267:r.getBytes(16);break;case 269:r.getBytes(16);r.getLittleEndian32();break;case 274:break;case 275:break;case 259:r.getBytes(16);r.getLittleEndian32();r.getLittleEndian32();r.skipPosition(32);M=r.getLittleEndian32();G=new Image;I=r.getPosition();z[0]=r.getData().subarray(I,I+M);r=new Blob(z,m);G.src=URL.createObjectURL(r);P.addImg(G);break;case 270:P.flushImgs();break;case 273:break;case 260:break;case 276:r.getBytes(16);M=r.getLittleEndian32();I=r.getPosition()+M;r.skipPosition(8);G=
r.getLittleEndian32();svGlobal.logger.info("window state:"+G);O=r.getLittleEndian32();ba=r.getLittleEndian32();G=r.getLittleEndian32();M=r.getLittleEndian32();r.skipPosition(8);ea=r.getLittleEndian32();S=r.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+G+" top:"+M+" w:"+O+" h:"+ba+" cl:"+ea+" ct:"+S);r.setPosition(I);I=r.getLittleEndian32();for(I=r.getPosition()+I;r.getPosition()<I;){ea=r.getLittleEndian32();S=r.getLittleEndian32();var Y=r.getLittleEndian32(),Ca=r.getLittleEndian32();
svGlobal.logger.info("visible region, l:"+S+" t:"+ea+" r:"+Ca+" b:"+Y)}P.setImgRect(G,M,O,ba);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+M)}break;default:svGlobal.logger.warn("unkown interface:"+I)}};return t}());Ua||n.addDynamicChannel(w());L.enableDVCAudio&&n.addDynamicChannel(function(t){var m=!1,z=0,r=0,I=0,G=0,M=[],O=new Uint8Array(4),ba=new n.DynamicChannel;ba.name="AUDIO_PLAYBACK_DVC";ba.onclose=function(){};ba.process=function(ea){function S(R){R.skipPosition(14);
var X=R.getLittleEndian16();R.getByte();var ma=R.getLittleEndian16();R.skipPosition(1);for(var Ja,Ea=M.length=0;Ea<X;Ea++){var Ha=new g;Ha.fromBuffer(R);(Ja=22050<=Ha.nSamplesPerSec&&(1==Ha.formatTag||49==Ha.formatTag&&22050==Ha.nSamplesPerSec&&0==t))&&M.push(Ha)}Ha=20;R=M.length;for(Ea=0;Ea<R;Ea++)Ha+=M[Ea].getSize();Ea=Ha+4;X=new RdpBuffer(new Uint8Array(Ea),0,Ea);X.setByte(7);X.setByte(2);X.setLittleEndian16(Ha);X.setLittleEndian32(3);X.setLittleEndian32(4294967295);X.setLittleEndian32(0);X.setLittleEndian16(0);
X.setLittleEndian16(R);X.skipPosition(1);X.setLittleEndian16(ma);X.setByte(124);for(Ea=0;Ea<R;Ea++)Ha=M[Ea],Ha.toBuffer(X);X.markEnd();ba.send(X);5<ma&&(X=new RdpBuffer(new Uint8Array(8),0,8),X.setByte(12),X.skipPosition(1),X.setLittleEndian16(4),X.setLittleEndian16(0),X.setLittleEndian16(0),X.markEnd(),ba.send(X))}function Y(R){var X=R.getLittleEndian16();R=R.getLittleEndian16();var ma=new RdpBuffer(new Uint8Array(8),0,8);ma.setByte(6);ma.setByte(35);ma.setLittleEndian16(4);ma.setLittleEndian16(X);
ma.setLittleEndian16(R);ma.markEnd();ba.send(ma)}function Ca(){var R=M[I];if(R.formatTag!=aa||R.nSamplesPerSec!=Na||za!=R.nChannels)aa=R.formatTag,za=R.nChannels,Na=R.nSamplesPerSec,Ta=49==R.formatTag?8:R.bitsPerSample}function ta(R){r=R.getLittleEndian16();I=R.getLittleEndian16();G=R.getByte();R.skipPosition(3);O[0]=R.getByte();O[1]=R.getByte();O[2]=R.getByte();O[3]=R.getByte();m=!0;Ca()}function Ba(R,X){var ma=new RdpBuffer(new Uint8Array(8),0,8);ma.setByte(5);ma.skipPosition(1);ma.setLittleEndian16(4);
ma.setLittleEndian16(R);ma.setByte(X);ma.skipPosition(1);ma.markEnd();ba.send(ma)}function Oa(R){m=!1;var X=z-8,ma=Date.now();R.copyFromByteArray(O,0,R.getPosition(),4);R=Kb(R,G,r,X);R=1E3*(R-pa.delay);ma=r+(Date.now()-ma)+R;Ba(ma,G)}function wa(R){var X=Date.now();r=R.getLittleEndian16();I=R.getLittleEndian16();G=R.getByte();R.skipPosition(7);Ca();R=Kb(R,G,r,0);R=1E3*(R-pa.delay);X=r+(Date.now()-X)+R;Ba(X,G)}if(m)Oa(ea);else{var xa=ea.getByte();ea.skipPosition(1);z=ea.getLittleEndian16();switch(xa){case 7:S(ea);
break;case 6:Y(ea);break;case 2:ta(ea);break;case 1:closed=!0;break;case 3:ea.getLittleEndian16();ea.getLittleEndian16();break;case 13:wa(ea)}}};return ba}(l));var A={videoMedia:{video:null,track:null,canvas:null,ctx:null,resolutions:null,minFrameRate:16,type:2,activate:function(t,m){svGlobal.logger.info("activate webcam");A.videoMedia.resolutions?t():hi5.video.resolutions(function(z){z.length?(A.videoMedia.resolutions=z,t()):m()})},deactivate:function(){var t=A.videoMedia;t.track&&(t.track.stop(),
t.track=null);t.ctx=null;t.canvas=null;t.video=null;svGlobal.logger.info("deactivate cam")},startStream:function(t,m,z,r,I){svGlobal.logger.info("startStream, width:"+t+" height:"+m+" frameRate:"+z);var G=A.videoMedia,M=G.track;if(M){var O=M.getSettings();if("live"==M.readyState)if(t!=O.width||m!=O.height||z!=O.frameRate&&2!=G.type)M.stop();else return}navigator.mediaDevices.getUserMedia({video:{frameRate:2==G.type?G.minFrameRate:z,width:{exact:t},height:{exact:m}}}).then(function(ba){var ea=document.createElement("video");
ea.srcObject=ba;ea.play();if(window.OffscreenCanvas)var S=new OffscreenCanvas(100,100);else S=document.createElement("canvas"),S.style.position="absolute",S.style.left=0,S.style.top=0;G.track=ba.getVideoTracks()[0];G.canvas=S;G.ctx=S.getContext("2d");G.video=ea;ba=G.track.getSettings();G.canvas.width=ba.width;G.canvas.height=ba.height;r()}).catch(function(ba){svGlobal.logger.warn(ba);I()})},stopStream:function(){svGlobal.logger.info("stopStream");var t=A.videoMedia;t.track&&"live"==t.track.readyState&&
t.track.stop()},grabFrame:function(t){function m(r){r.arrayBuffer().then(t)}var z=A.videoMedia;z.ctx.drawImage(z.video,0,0);z=z.canvas;z.convertToBlob?z.convertToBlob({type:"image/jpeg",quality:.6}).then(m):z.toBlob(m,"image/jpeg",.6)},propertyList:[[{propertyId:1,capabilities:3,min:4294967286,max:4294967294,step:1,default:4294967291},null,{propertyId:3,capabilities:101,min:4294967280,max:16,step:1,default:0},{propertyId:4,capabilities:1,min:0,max:3,step:1,default:0},{propertyId:5,capabilities:1,
min:4294967280,max:16,step:1,default:0},{propertyId:6,capabilities:1,min:100,max:400,step:10,default:100}],[{propertyId:1,capabilities:1,min:0,max:2,step:1,default:1},{propertyId:2,capabilities:199,min:4294967232,max:64,step:1,default:0},{propertyId:3,capabilities:1,min:0,max:95,step:1,default:0},{propertyId:4,capabilities:1,min:4294965296,max:2E3,step:1,default:0},{propertyId:5,capabilities:67,min:2800,max:6500,step:1,default:4600}]]},WEBCAM:function(t){var m=new t;m.name="RDCamera_Device_0";m.version=
2;m.newInstance=function(){return A.WEBCAM(t)};m.onopen=function(){svGlobal.logger.info("cam open")};m.onclose=function(){svGlobal.logger.info("cam close")};m.sendSucess=function(){var z=new hi5.DataBuffer(new Uint8Array(2));z.setByte(m.version);z.setByte(1);z.markEnd();m.send(z)};m.sendError=function(z){var r=new hi5.DataBuffer(new Uint8Array(6));r.setByte(m.version);r.setByte(2);r.setLittleEndian32(z||1);r.markEnd();m.send(r)};m.sendSteamListResp=function(){var z=new hi5.DataBuffer(new Uint8Array(7));
z.setByte(m.version);z.setByte(10);z.setLittleEndian16(1);z.setByte(1);z.setByte(1);z.setByte(0);z.markEnd();m.send(z)};m.sendMediaTypeListResp=function(z){var r=A.videoMedia.resolutions,I=r.length,G=new hi5.DataBuffer(new Uint8Array(2+26*I));G.setByte(m.version);G.setByte(12);for(var M=1==z,O=0;O<I;O++){G.setByte(z);var ba=r[O];G.setLittleEndian32(ba.width);G.setLittleEndian32(ba.height);G.setLittleEndian32(M?ba.frameRate:A.videoMedia.minFrameRate);G.setLittleEndian32(1);G.setLittleEndian32(1);G.setLittleEndian32(1);
G.setByte(1)}G.markEnd();m.send(G)};m.sendCurrentMediaType=function(z,r){var I=new hi5.DataBuffer(new Uint8Array(28));I.setByte(m.version);I.setByte(14);r=A.videoMedia.resolutions[r];I.setByte(z);I.setLittleEndian32(r.width);I.setLittleEndian32(r.height);I.setLittleEndian32(1==z?r.frameRate:A.videoMedia.minFrameRate);I.setLittleEndian32(1);I.setLittleEndian32(1);I.setLittleEndian32(1);I.setByte(1);I.markEnd();m.send(I)};m.sendSampleResp=function(z){A.videoMedia.grabFrame(function(r){var I=new hi5.DataBuffer(new Uint8Array(r.byteLength+
3));I.setByte(m.version);I.setByte(18);I.setByte(z);I.setBytes(new Uint8Array(r));I.markEnd();m.send(I)})};m.sendPropertyListResp=function(){for(var z=0,r,I,G=A.videoMedia.propertyList,M=0;2>M;M++){I=G[M];r=I.length;for(var O=0;O<r;O++)null!=I[O]&&z++}z=new hi5.DataBuffer(new Uint8Array(2+19*z));z.setByte(m.version);z.setByte(21);for(M=0;2>M;M++)for(I=G[M],r=I.length,O=0;O<r;O++)null!=I[O]&&(z.setByte(M),z.setByte(I.propertyId),z.setByte(I.capabilities),z.setLittleEndian32(I.min),z.setLittleEndian32(I.max),
z.setLittleEndian32(I.step),z.setLittleEndian32(I.default));z.markEnd();m.send(z)};m.sendPropertyValueResp=function(z,r){(z=A.videoMedia.propertyList[z][r-1])?(r=new hi5.DataBuffer(new Uint8Array(7)),r.setByte(m.version),r.setByte(23),r.setByte(1),r.setLittleEndian32(z.value||z.default),r.markEnd(),m.send(r)):m.sendError(8)};m.process=function(z){z.getByte();var r=z.getByte();switch(r){case 7:A.videoMedia.activate(m.sendSucess,m.sendError);break;case 8:A.videoMedia.deactivate();m.sendSucess();break;
case 9:m.sendSteamListResp();break;case 11:z=z.getByte();0!=z&&svGlobal.logger.warn("Invalid stream index: "+z);m.sendMediaTypeListResp(A.videoMedia.type);break;case 13:z=z.getByte();m.sendCurrentMediaType(A.videoMedia.type,z);break;case 15:z.getByte();r=z.getByte();if(r!=A.videoMedia.type){svGlobal.warn("Invalid video format req:"+r);m.sendError(6);break}r=z.getLittleEndian32();var I=z.getLittleEndian32();z=z.getLittleEndian32()/z.getLittleEndian32();A.videoMedia.startStream(r,I,z,m.sendSucess,m.sendError);
break;case 16:A.videoMedia.stopStream();m.sendSucess();break;case 17:z=z.getByte();0!=z&&svGlobal.log("Invalid stream index for SampleRequest: "+z);m.sendSampleResp(z);break;case 20:m.sendPropertyListResp();break;case 22:r=z.getByte();z=z.getByte();m.sendPropertyValueResp(r,z);break;case 24:m.sendError(10);break;default:m.sendError(10),svGlobal.logger.warn("Invalid cam msg: "+r)}};return m},WEBCAM_ENUM:function(t,m){var z=new t;z.name="RDCamera_Device_Enumerator";z.onopen=function(){var r=new hi5.DataBuffer(new Uint8Array(2));
r.setByte(m.version);r.setByte(3);r.markEnd();z.send(r);svGlobal.logger.info("camEnum open")};z.onclose=function(){svGlobal.logger.info("camEnum closed");A.videoMedia.deactivate()};z.addDevice=function(r){r+="\x00";var I=m.name+"\x00",G=new hi5.DataBuffer(new Uint8Array(2+2*r.length+I.length));G.setByte(m.version);G.setByte(5);G.setUnicodeString(r);G.setAscllString(I);G.markEnd();z.send(G)};z.process=function(r){var I=r.getByte();r=r.getByte();switch(r){case 4:svGlobal.logger.info("camEnum ver resp: "+
I);m.version=I;z.addDevice(hi5.video.webcam&&hi5.video.webcam.label||"Web Camera");break;default:svGlobal.logger.warn("invalid messageId on camEnum: "+r)}};return z}};c&&(a=A.WEBCAM(n.DynamicChannel),b=A.WEBCAM_ENUM(n.DynamicChannel,a),n.addDynamicChannel(b),n.addDynamicChannel(a));p&&(A.WebUSB=function(t){t=new t;t.name="URBDRC";t.process=function(m){var z=m.getLittleEndian32();m.getLittleEndian32();switch(m.getLittleEndian32()){case 256:z&=1073741823,0!=z&&svGlobal.logger.warn("InterfaceId must be 0 for RIM_EXCHANGE_CAPABILITY_REQUEST"),
m=m.getLittleEndian32(),1!=m&&svGlobal.logger.warn("Unexprected usb capability value:"+m),(new hi5.DataBuffer(new Uint8Array(24))).setLittleEndian32(z)}}},n.addDynamicChannel(A.WebUSB(n.DynamicChannel)))}}};this.resetStatus=Bb;this.exeAppCmd=function(a){var b=J.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?J.getWinById(a):J.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,d){void 0==d&&(d=L.forceReconnect||
!1);if(!fa&&!d)return!1;C.minWidth&&a<C.minWidth&&(a<C.minWidth&&svGlobal.logger.warn("Width "+a+" is samller than minWidth "+C.minWidth),a=C.minWidth);C.minHeight&&b<C.minHeight&&(b<C.minHeight&&svGlobal.logger.warn("Height "+b+" is samller than minHeight "+C.minHeight),b=C.minHeight);a&=-4;b&=-4;if(!d&&4>Math.abs(a-ja)&&4>Math.abs(b-ka))return!1;if(sa&&sa.enabled&&!1!==L.displayVC)sa.applyResolution(a,b);else if(Lb&&Za||d||Ga&&!Lb)Za=!1,svGlobal.logger.info("reconnecting..."),V("8E0"+a+"\t"+b),
va&&(va.remoteLockFlags=0,va.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));V(a)};this.getUploadManager=function(){return oa};this.addSurface=function(a){if(!J.hasSurface(a)&&(nb||P.setContext(a.context),!J.hasSurface(a)||!a.railWin)){Ua&&a.setPlayerMode();C.mouseMoveEmu&&(a.mouseMoveEmu=ia(C.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==ja&&(ja=b.width);0==ka&&(ka=b.height);a.setConfig(L);J.addSurface(a);Ya(ja,ka,!0,C.monitorDef?!0:
!1);a.setController(va);a.setTouchpad(ia(C.touchpad));var d=b=ia(C.mapClipboard),l=b;void 0!=C.copyToLocal?d=ia(C.copyToLocal):void 0!=L.copyToLocal&&(d=L.copyToLocal);void 0!=C.copyToRemote?l=ia(C.copyToRemote):void 0!=L.copyToRemote&&(l=L.copyToRemote);a.setClipboard(b,d,l);mb&&Cb(a);C.invitation&&!ia(C.control)&&(J.setReadOnly(!0),b=hi5.$("requestControl"))&&(b.disabled=!1);b=void 0!=C.ctrlToWin?ia(C.ctrlToWin):void 0!=L.ctrlToWin?L.ctrlToWin:!0;d=void 0!=C.cmdToCtrl?ia(C.cmdToCtrl):void 0!=L.cmdToCtrl?
L.cmdToCtrl:!0;a.run(parseInt(C.keyboard||1033,10),b,!!L.noKeyStuck,d)}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,d=J.size();b<d;b++)J.getSurface(b).railWin.getMain(J.zOrders)&&a.push(J.getSurface(b).railWin.getMain(J.zOrders).titleInfo);return a};this.startApp=function(a,b,d){b=b||"";d=d||"";V("8C2"+a+"\t"+b+"\t"+d);var l=J.getSurface(J.size()-1);l&&(l.remoteApp=new Qb(a,b,d))};this.startExitingApp=function(a){a=J.popWins(a);for(var b=a.length-1;0<=b;b--)J.addWin(a[b])};
this.VirtualChannel=function(){return new Db(143)};this.GatewayChannel=function(){return new Db(28)};this.DynamicChannel=function(){return new Db(64)};this.addChannel=function(a){Ra[a.name]=a};this.addGatewayChannel=function(a){Sa[a.name]=a};this.addDynamicChannel=function(a){ha.names.push(a.name);ha[a.name]=a;ha.count++};var Qa=null;ia(C.scanner)&&(Qa=new n.DynamicChannel,Qa.name="SCANNERDVC",Qa.onopen=function(){console.log("==== scanner DVC onopen().")},Qa.process=function(a){var b=a.getByte();
console.log("==== scanner DVC process(), type="+b);switch(b){case 0:var d=a.getByte(),l=a.getByte();b=new Uint8Array(10);b[0]=4;b[1]=7;b[2]=d;b[3]=l;b.set(a.getBytes(2),4);b.set(a.getBytes(2),6);b.set(a.getBytes(2),8);if(n.onagentmessage)n.onagentmessage(b);break;case 1:break;case 2:d=a.getEnd()-a.getPosition();b=new Uint8Array(d+2);b[0]=4;b[1]=3;b.set(a.getBytes(d),2);if(n.onagentmessage)n.onagentmessage(b);break;case 3:d=a.getEnd()-a.getPosition();b=new Uint8Array(d+3);b[0]=4;b[1]=9;b[2]=0;b.set(a.getBytes(d),
3);if(n.onagentmessage)n.onagentmessage(b);break;default:console.log('Warning: Unknown type "'+b+'" received from DVC, ignored.')}},Qa.onclose=function(){var a=new Uint8Array(2);a[0]=4;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},n.addDynamicChannel(Qa));var Wa=null;ia(C.smartCard)&&(Wa=new n.GatewayChannel,Wa.name="SCARDSTB",Wa.onopen=function(){var a=new Uint8Array(2);a[0]=3;a[1]=1;if(n.onagentmessage)n.onagentmessage(a)},Wa.process=function(a){var b=a.getEnd()-a.getPosition(),d=new Uint8Array(b+
2);d[0]=3;d[1]=3;d.set(a.getBytes(b),2);if(n.onagentmessage)n.onagentmessage(d)},Wa.onclose=function(){var a=new Uint8Array(2);a[0]=3;a[1]=4;if(n.onagentmessage)n.onagentmessage(a)},n.addGatewayChannel(Wa));L.detectNetwork&&(D+="&connectType=7",sc());this.getNetworkResult=function(){return kb};this.writeAgent=function(a){a.byteLength&&(a=new Uint8Array(a));switch(a[0]){case 3:if(Wa&&3==a[1]){var b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));Wa.send(b)}break;
case 4:if(Qa)switch(a[1]){case 2:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));var d=document.getElementById("dsSelection");d||(d=document.createElement("div"),d.id="dsSelection",d.className="appdlg",document.body.appendChild(d));if(0!=b.getLittleEndian16())d&&(d.innerHTML="<p>Error on local: failed to get the list of connected scanners. Close to continue without scanning.</p>",b=new hi5.ui.Lightbox(d),b.onclose=function(){n.run()},b.show());else if(a=
(a.byteLength-4)/41,0==a)d&&(d.innerHTML="<p>Error: Could not find any connected scanner. Please:<ul><li>Power on or connect the scanner and then refresh the page; or</li><li>Close this dialog to connect to the machine without using scanner.</li></ul></p>",b=new hi5.ui.Lightbox(d),b.onclose=function(){n.run()},b.show());else if(1==a){if(b=new Uint8Array(3),b[0]=4,b[1]=5,b[2]=0,n.onagentmessage)n.onagentmessage(b)}else if(d){d.innerHTML='<p> Please choose a scanner &lt;DriverType: DeviceName&gt; and click "Continue".</a></p>';
for(var l=0;l<a;l++){var c=b.getAscllString(41,!0);c=tc(l,c);d.appendChild(c)}d.innerHTML+="<br>";b=new hi5.ui.LightboxWithBtn(d);b.onclose=function(){var p=0,g=document.querySelector('input[name="ds_name"]:checked');g&&(p=g.value);g=new Uint8Array(3);g[0]=4;g[1]=5;g[2]=p;if(n.onagentmessage)n.onagentmessage(g)};b.show()}break;case 3:case 8:case 10:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));Qa.send(b);break;case 4:b=a.slice?new hi5.DataBuffer(a.slice(2,
a.length)):new hi5.DataBuffer(a.subarray(2,a.length));Qa.send(b);hi5.notifications.notify({msg:__svi18n.info.TwainNotSupported,type:2});break;case 6:b=a.slice?new hi5.DataBuffer(a.slice(2,a.length)):new hi5.DataBuffer(a.subarray(2,a.length));b.getLittleEndian16();n.run();break;default:svGlobal.logger.warn("Warning: Unknown response header: [4 / "+a[1]+"], ignored.")}break;default:svGlobal.logger.warn("Invalid channel data received: unknown type ["+a[0]+"].")}};var Fb={type:6,data:null};this.run=function(){Sb();
pa.supportWebAudio&&pa.iOSFix()};this.getDesktop=function(){return P};this.mouseDown=function(a,b,d){Ga&&V("80"+a+"\t"+b+"\t"+d)};this.mouseMove=function(a,b){Ga&&V("82"+a+"\t"+b)};this.mouseUp=function(a,b,d){Ga&&V("81"+a+"\t"+b+"\t"+d)};this.writeKeyCode=function(a,b){Ga&&V("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){Ga&&("number"==typeof a?(V("840\t"+a),V("8449152\t"+a)):V("84"+(a?0:49152)+"\t"+b))};this.resetSize=function(a,b){Fa?(Va&&(clearTimeout(Va),Va=0),a&=-4,b&=-4,sa&&sa.enabled&&
sa.applyResolution(a,b),Va=setTimeout(function(){n.writeRawInput("8C661441\t"+a+"\t"+b);jc();svGlobal.logger.info("-- displayChange, h:"+b)},150)):n.reconnectOnResize&&n.running()&&(Va&&(clearTimeout(Va),Va=0),Va=setTimeout(function(){n.reconnect(a,b)},555))};var Aa=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!n.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=vb,b[4]=vb>>8,b[5]=ub,b[6]=ub>>8,b[7]=wb,b[8]=wb>>8,b[9]=
xb,b[10]=xb>>8);V(b.buffer);return!0};this.refreshOutput=function(a,b,d,l){var c=new Uint8Array(d?11:3);c[0]=146;c[1]=3;c[2]=2;d&&(c[3]=a,c[4]=a>>8,c[5]=b,c[6]=b>>8,c[7]=d,c[8]=d>>8,c[9]=l,c[10]=l>>8);V(c.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);V(b.buffer)};this.startPing=function(a,b){b=b||0;ra||(ra=new hi5.tool.ResponseMonitor(function(){Ga&&n.sendPing()},function(){if(Ga&&n.onnoresponse)return n.onnoresponse()}));ra.setInterval(a,b);
var d=new Uint8Array(4);d[0]=146;d[1]=2;d[2]=a;d[3]=b;V(d.buffer);setTimeout(function(){ra&&ra.check()},1E3*(a+b));na?na.postMessage({type:0,cmd:6,start:1}):(Z.onSlowPath=Z.onFastPath=Zb,Z.onReqHistory=function(){Zb(15555)})};this.stopPing=function(){ra&&ra.stop();na?na.postMessage({type:0,cmd:6,start:0}):Z.onSlowPath=Z.onFastPath=Z.onReqHistory=null};var Ia=null,fc=0;this.play=function(){V("F3")};this.pause=function(){V("F2")};this.scan=function(a){V("F4"+(a?"1":"0"))};this.seek=function(a){var b=
J.getFocused();b&&fa&&(V("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),P.pause(!0))};var Ta=za=aa=0;var Na=22050;var ec=!1;this.showMessage=function(a,b,d){n&&n.displayMsg&&a&&((b=b||J.getFocused())?b.showMessage(a,d):("string"==typeof a&&(a={msg:a,timeout:d||0}),hi5.notifications.notify(a)))};this._unload=fb;this.close=function(){svGlobal.logger.info("closing...");fa&&Fa&&J&&L.closeRemoteApp&&J.tryCloseRemoteApps();P&&P.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),
setTimeout(ic,2222)):ic()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(n.close):window.addEventListener("unload",n.close,!1)}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var D=navigator&&(navigator.language||navigator.userLanguage||""),N=Rdp.languageToKeyboard[D];if(!N){var T=D.indexOf("-");T&&(N=Rdp.languageToKeyboard[D.substring(0,T)])}N||(console.log("No valid layout for "+D),N=1033);return N}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
