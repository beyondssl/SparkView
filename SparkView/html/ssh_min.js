var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(g,m,n){if(null==g)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(m instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return g+""};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(g,m,n){g!=Array.prototype&&g!=Object.prototype&&(g[m]=n.value)};
$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(g,m,n,v){if(m){n=$jscomp.global;g=g.split(".");for(v=0;v<g.length-1;v++){var N=g[v];N in n||(n[N]={});n=n[N]}g=g[g.length-1];v=n[g];m=m(v);m!=v&&null!=m&&$jscomp.defineProperty(n,g,{configurable:!0,writable:!0,value:m})}};
$jscomp.polyfill("String.prototype.startsWith",function(g){return g?g:function(g,n){var m=$jscomp.checkStringArgs(this,g,"startsWith");g+="";for(var N=m.length,ha=g.length,ta=Math.max(0,Math.min(n|0,m.length)),da=0;da<ha&&ta<N;)if(m[ta++]!=g[da++])return!1;return da>=ha}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(g){return g?g:function(g,n,v){var m=this.length||0;0>n&&(n=Math.max(0,m+n));if(null==v||v>m)v=m;v=Number(v);0>v&&(v=Math.max(0,m+v));for(n=Number(n||0);n<v;n++)this[n]=g;return this}},"es6-impl","es3");var svManager={getInstance:function(){var g=window.$ssh;return g&&g.running&&g.running()?g:null}};
function connvertServer(g){var m={};m.id=g.id;m.server=g.id;m.displayName=g.displayName||g.id;if(g=g.ssh){for(var n in g)m[n]=g[n];m.user=g.username||"";m.pwd=g.password||""}return m}
svGlobal.SSH=function(g,m,n,v){function N(a){return"on"==a||"true"==a||1==a}function ha(){var a=g.indexOf("://"),b=g.substring(a+3),a=b.indexOf("/");0<a&&(b=b.substring(0,a));return location.protocol+"//"+b}function ta(a){if(!ua)return"";var b=ha(),c=va.clipboard,f=c.indexOf("://"),b=(0<f&&11>f?c:b+c)+"s="+ua+"&t="+Date.now()+"&type="+a;return hi5.browser.httpGet(d.modifyURL(b),!1)}function da(a,b){b&&(I=b);a&&(P=a,wa=(P-1)*h);Ka=1==I&&P==Math.floor(n/h)}function xa(a,b,c,f){var e=a,g=b;f=f||Math.floor(g/
h);b=c||Math.floor(e/t);a=null;c&&(e=G*t,g=J*h);y&&(a=k.getImageData(0,0,Math.min(b*t,F),Math.min(f*h,J*h)));m=e;n=g;c=m;e=n;u.setSize(c,e);R.width=c;R.height=e;k.textBaseline="top";c=l.fontFamily||l.fontName||"Courier New";0<c.indexOf(" ")&&(c="'"+c+"'");k.font=l.fontSize+"px "+c;ya();a&&(k.putImageData(a,0,0),V());J=f;G=b;F=G*t;da(Math.floor(n/h));w?w.resize(G,J):w=new La(G,J);if(d.onresolutionchange)d.onresolutionchange(m,n)}function Ea(a){q.send(a)}function Ma(a,b,c){this.need=a;this.handler=
b;this.repeat=c||1}function hb(a){S=new RecordingManager;S.setHeader({name:"rec",width:a.width,height:a.height,color:a.fontSize,namesuffix:".sshv",filetag:"SSHV",duration:0})}function ib(a,b){var c=0,f=!1;this.width=a;this.interval=b;var e=0;this.start=function(){f||(f=!0,c=setInterval(function(){if(u&&y){var b=u.getThumbnail(a);b&&b.length!=e&&(q.send("8E7"+b),e=b.length)}},b))};this.stop=function(){clearInterval(c)}}function jb(a,b){!Q||Q.width==a&&Q.interval==b||(Q.stop(),Q=null);Q||(Q=new ib(a,
b));Q.start()}function kb(a){y&&q.send("5D"+a.join("\t"));z=null}function Na(){if(z){var a=z.answer.length;a<z.prompt.length?(W(z.prompt[a]),V(),ia()):(q.send("5D"+z.answer.join("\t")),z=null)}}function lb(a){y&&q.send("5B"+a)}function mb(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var f=d.sessionInfo.appInfo;switch(b){case 1:var e=JSON.parse(c);d.onsessionjoin&&(a=d.onsessionjoin(e));if(a)break;d.showMessage(__svi18n.info.joinsession.applyArgs([e.numericId,e.__ip,e.name]));break;
case 2:e=JSON.parse(c);d.onsessionexit&&(a=d.onsessionexit(e));if(a)break;d.showMessage(__svi18n.info.exitsession.applyArgs([e.numericId,e.__ip,e.name]));break;case 3:e=JSON.parse(c);f.joinMode!=e.mode&&(f.joinMode=e.mode,b=hi5.$("joinSelect"))&&(b.value=e.mode);if(f.hasControl)break;u.setReadOnly(!1);if(b=hi5.$("requestControl"))b.disabled=!0;d.ongivecontrol&&(a=d.ongivecontrol());if(a)break;d.showMessage(__svi18n.info.givecontrol);break;case 4:u.setReadOnly(!0);f.hasControl=!1;if(b=hi5.$("requestControl"))b.disabled=
!1;d.ontakebackcontrol&&(a=d.ontakebackcontrol());if(a)break;d.showMessage(__svi18n.info.nocontrol);break;case 5:e=JSON.parse(c);d.onrequirecontrol&&(a=d.onrequirecontrol(e));if(a)break;a=__svi18n.info.title.applyArgs([e.name,e.numericId,e.__ip]);d.showMessage({title:a,msg:__svi18n.info.recontrol,cbYes:function(){d.giveControl(e.numericId);this.destroy()},cbNo:function(){d.refuseControl(e.numericId);this.destroy()}});break;case 6:u.setTouchRemoting(!0);break;case 7:e=JSON.parse(c);e.width&&e.height&&
xa(0,0,e.cols,e.rows);break;case 8:e=JSON.parse(c);if(d.onrequestcredential&&d.onrequestcredential(e))break;u.requestCredential(e);break;case 9:e=JSON.parse(c);0<e.interval&&0<e.width?jb(e.width,e.interval):Q&&(Q.stop(),Q=null);break;case 11:e=JSON.parse(c);d.onrequirejoin&&(a=d.onrequirejoin(e));if(a)break;a=__svi18n.info.title.applyArgs([e.name,e.numericId,e.__ip]);d.showMessage({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){d.allowJoin(e.numericId,!0);this.destroy()},cbNo:function(){d.allowJoin(e.numericId,
!1);this.destroy()}});break;case 12:Oa=!0}}function nb(a){var b=x.page&&x.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,f=c.lastIndexOf("/");if(b)return c.substring(0,f+1)+b;b=ha();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,f));return b+"/"+a}function ja(a){na.style.display=a?"none":"block"}function ob(a){svGlobal.logger.info("opened...");y=!0;q.send("87"+navigator.userAgent);if(d.onopen)d.onopen()}
function pb(a){svGlobal.logger.warn(a)}function za(a){svGlobal.logger.warn("closed ...");ja(!0);if(!y&&((a=__svi18n.errorCode.connection)||(a="error connection"),d)){if(d.onerror)d.onerror({name:"connection",message:a});d.showMessage(a);0<svGlobal.log&&console.error(a)}oa=y=!1;if(d&&d.onclose)d.onclose(Oa);try{null!=S&&(S.exit(),S=null),u&&u.close()}catch(b){}ea&&(ea.release(),ea=null);R=k=null;q&&(q.onopen=null,q.onmessage=null,q.onclose=null,q=q.onerror=null);u=K=null;d&&(d=null);window&&window.$ssh&&
(window.$ssh=null);null!=S&&(S.exit(),S=null)}function Pa(){10>l.fontSize&&(l.fontSize=10);13>l.fontSize?h=l.fontSize+6:12<l.fontSize&&19>l.fontSize?h=l.fontSize+8:18<l.fontSize&&25>l.fontSize?h=l.fontSize+12:24<l.fontSize&&(h=l.fontSize+16);l.lineHeight&&(h=parseInt(l.lineHeight));Qa=(h-l.fontSize)/2|0;k.textBaseline="top";var a=l.fontFamily||"Courier New";0<a.indexOf(" ")&&(a="'"+a+"'");k.font=l.fontSize+"px "+a;t=k.measureText("X").width;J=parseInt(n/h);G=parseInt(m/t);F=G*t;da(parseInt(n/h));
w?w.resize(G,J):w=new La(G,J)}function Fa(){ya();r=p=0;Pa();na.style.width=t+"px";na.style.height=h+"px";oa=!0}function V(){Ra||Sa.drawImage(R,0,0)}function Ta(a){switch(a){case 0:break;case 5:break;case 7:break;case 8:Ga();break;case 9:a=p/t/8;a=parseInt(a)+1;p=8*a*t;ka();break;case 10:r+=h;ka(!0);break;case 11:r+=h;ka(void 0);break;case 12:break;case 13:Ua();break;case 14:break;case 15:break;default:console.log("Unknown C0 control:"+a)}}function qb(a){var b=a.getPosition();if(!T.parse(a))return a.setPosition(b-
2),!1;a=T.count;b=T.parameters;switch(T.command){case 64:0==a&&(b[0]=1);a=b[0];for(var b="",c=a*t,f=k.getImageData(p,r,F-p-c,h),e=0;e<a;e++)b+=" ";W(b);p-=c;k.putImageData(f,p+c,r);w.insertSpace(a,L(),H());break;case 65:0==a&&(b[0]=1);r-=(b[0]||1)*h;break;case 66:0==a&&(b[0]=1);r+=(b[0]||1)*h;break;case 67:0==a&&(b[0]=1);p+=(b[0]||1)*t;break;case 68:0==a&&(b[0]=1);p-=(b[0]||1)*t;break;case 69:0==a&&(b[0]=1);r+=b[0]*h;p=0;break;case 70:0==a&&(b[0]=1);r-=b[0]*h;p=0;break;case 71:0==a&&(b[0]=1);Aa(0,
b[0]);break;case 72:case 102:0==a&&(b[0]=b[1]=1);Aa(b[0]||1,b[1]||1);break;case 74:a||(b[0]=0);switch(b[0]){case 0:k.fillStyle=E;k.fillRect(p,r,F-p,J*h-r);k.fillStyle=C;w.clearEOS(L(),H());break;case 1:k.fillStyle=E;k.fillRect(0,0,p,r);k.fillStyle=C;w.clearBOS(L(),H());break;case 2:ya();r=p=0;w.cleanScreen();break;case 3:ya();r=p=0;w.cleanScreen();break;default:console.log("invalid CSI J:"+b[0])}break;case 75:a||(b[0]=0);switch(b[0]){case 0:Va();break;case 1:k.fillStyle=E;k.fillRect(0,r,p,h);k.fillStyle=
C;w.clearBOL(L(),H());break;case 2:k.fillStyle=E;k.fillRect(0,r,F,h);k.fillStyle=C;w.clearLine(H());break;default:console.log("invalid CSI K:"+b[0])}break;case 76:case 84:a||(b[0]=1);Wa(b[0]);break;case 77:case 83:a||(b[0]=1);Xa(b[0]);break;case 80:a||(b[0]=1);a=b[0];b=p+a*t;b=k.getImageData(b,r,F-b,h);Va();k.putImageData(b,p,r);w.deleteChars(L(),H(),a);break;case 88:a||(b[0]=1);a=b[0];k.fillStyle=E;k.fillRect(p,r,a*t,h);k.fillStyle=C;w.eraseChars(L(),H(),a);break;case 90:a||(b[0]=1);p=8*((p/t/8|
0)-b[0]+1)*t;ka();break;case 100:a||(b[0]=1);Aa(b[0]);break;case 101:a||(b[0]=1);Aa(H()+b[0]);break;case 104:if(63==T.mode)switch(b[0]){case 1:fa.setEscMode(1);break;case 5:console.log("Reversal screen mode");break;case 6:console.log("Relative origion mode");break;case 7:console.log("wraparound mode on");pa=!0;break;case 25:ja(!1);break;case 45:console.log("reverse-wraparound mode on");break;case 1E3:case 1001:case 1002:case 1003:case 1005:case 1006:O=b[0];console.log("mouse tracking on:"+O);break;
default:console.log("TODO: CSI ? Pm h, Ps:"+b[0])}break;case 108:if(63==T.mode)switch(b[0]){case 1:fa.setEscMode(0);break;case 2:fa.setEscMode(2);case 5:console.log("Normal screen mode");break;case 6:console.log("Absolute origion mode");break;case 7:pa=!1;break;case 12:break;case 25:ja(!0);break;case 45:console.log("reverse-wraparound mode off");break;case 1E3:case 1001:case 1002:case 1003:case 1005:case 1006:O=0;break;default:console.log("TODO: CSI ? Pm l, Ps:"+b[0])}break;case 109:0==a&&(a=1,b[0]=
0);for(c=0;c<a;c++)switch(b[c]){case 0:qa(7);ra(0);Ha(!1);break;case 1:Ha(!0);break;case 2:break;case 4:break;case 5:case 8:break;case 7:qa(0);ra(7);break;case 27:qa(7);ra(0);break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:qa(b[c]-30);break;case 38:return 2==b[c+1]&&(C="rgb("+b[c+2]+","+b[c+3]+","+b[c+4]+")",k.fillStyle=C),!0;case 39:qa(7);break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:ra(b[c]-40);break;case 48:return 2==b[c+1]&&(E="rgb("+b[c+2]+","+b[c+
3]+","+b[c+4]+")"),!0;case 49:ra(0);1==c&&39==b[0]&&Ha(!1);break;default:return console.log("TODO: SGR="+T.toString()),!0}break;case 110:6==b[0]?63==T.mode?D("\u001b[?"+H()+";"+L()+"R"):D("\u001b["+H()+";"+L()+"R"):5==b[0]&&D("\u001b[0n");break;case 114:T.mode||da(b[1],b[0]);break;default:console.log("TODO: CSI="+T.toString())}return!0}function Wa(a){a||(a=1);var b=(I-1)*h,c=k.getImageData(0,b,F,(P-I-a+1)*h);k.fillStyle=E;k.fillRect(0,b,F,h*a);k.putImageData(c,0,(I+a-1)*h);k.fillStyle=C;w.scrollUp(a,
I,P)}function Xa(a){a||(a=1);var b=(I-1)*h,c=P*h,f=a*h,e=b+f,e=k.getImageData(0,e,F,c-e);k.fillStyle=E;k.fillRect(0,c-f,F,f);k.fillStyle=C;k.putImageData(e,0,b);w.scrollDown(a,I,P)}function ka(a){pa&&p>=F&&(p=0,r+=h);if((pa||a)&&r>wa){for(;r>wa;)r-=h;Ka?(k.drawImage(R,0,-h),k.fillStyle=E,k.fillRect(0,wa,m,h),w.appendLines(1)):(a=k.getImageData(0,0+(I-0)*h,F,(P-I)*h),k.fillStyle=E,k.fillRect(0,(I-1)*h,F,(P-I+1)*h),k.putImageData(a,0,0+(I-1)*h));k.fillStyle=C}}function Ga(){p-=t;0>p&&(p=0)}function H(){return parseInt(r/
h)+1}function L(){return parseInt(p/t)+1}function Aa(a,b){b&&(p=(b-1)*t,0>p&&(p=0));a&&(r=(a-1)*h)}function ra(a){E=Ba[a];E||(E=l.bgColor||"black",console.log("xx colorIndex:"+a))}function qa(a){Ya=a;C=sa[a];C||(C=l.fgColor||"white",console.log("xx colorIndex:"+a));k.fillStyle=C}function Ha(a){sa=a?Za:Ba;C=sa[Ya]}function Va(){k.fillStyle=E;k.fillRect(p,r,F-p,h);k.fillStyle=C;w.clearEOL(L(),H())}function ya(){k.fillStyle=E;k.fillRect(0,0,R.width,R.height);k.fillStyle=C}function ia(){na.style.top=
r+"px";na.style.left=p+"px"}function W(a){M.on&&(a.startsWith(M.prompt)?(M.on=!1,setTimeout(M.process,30)):M.text+=a);var b=a.length,c=(p/t|0)+b-G;0<c?(b-=c,$a(a.substring(0,b),b),ka(),W(a.substring(b))):$a(a,b)}function $a(a,b){if(a){w.writeText(L(),H(),a);var c=b*t;k.fillStyle=E;k.fillRect(Math.floor(p),r,Math.ceil(c),h);k.fillStyle=C;k.fillText(a,p,r+Qa);p+=c}}function rb(a,b){for(var c=a.getPosition(),f,e="",d=a.getEnd(),A=a.getData();c<d;)if(f=A[c++],f!=b)switch(f>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=
String.fromCharCode(f);break;case 12:case 13:e+=String.fromCharCode((f&31)<<6|A[c++]&63);break;case 14:e+=String.fromCharCode((f&15)<<12|(A[c++]&63)<<6|(A[c++]&63)<<0)}else break;a.setPosition(c);return e}function ab(a){X+=a;aa?(W(a),V(),ia()):z&&z.echo[z.answer.length]&&(W(a),V(),ia())}function Ua(){p=0;r>(P-1)*h&&(r=(P-1)*h)}function sb(a){if(y)return(a=a.getData("text/plain"))?(a=a.replace(/\r\n/g,"\n"),aa||z?ab(a):D(a),!0):!1}function bb(){if(U){var a=!!U.value;U.value=w.toString();a||(a=new hi5.ui.Lightbox(document.getElementById("copydialog")),
a.show(),u&&u.setIgnorePaste(!1),a.onclose=function(){U.value=""});setTimeout(function(){U.scrollTop=U.scrollHeight},10)}}function cb(a){N(l.mapDisk)&&(B||(B=new hi5.file.UploadManager(new hi5.file.WsFileService(Ea),!1),B.enabled=!0,B.canCopyFile=!1,B.addEvent("beforeupload",function(a,c,f){d.beforeupload&&d.beforeupload(a,c,f)}),B.addEvent("fileuploaded",function(a,c,f){if(d.onfileuploaded)d.onfileuploaded(a,c,f)}),B.addEvent("uploaded",function(a,c){if(d.onuploaded)d.onuploaded(a,c)}),B.addEvent("uploadingCancelled",
function(){if(d.onuploadingCancelled)d.onuploadingCancelled()})),a.setFileHandler(B))}function D(a){if(a){a=unescape(encodeURIComponent(a));var b=a.length+1,c=new Uint8Array(b);c[0]=147;for(var f=1;f<b;f++)c[f]=a.charCodeAt(f-1);q.send(c.buffer)}}function La(a,b){function c(){var b=Array(a);hi5.Arrays.fill(b,0,a," ");return b}var f=0,e=[],d=10*b;this.resize=function(f,c,g){g=0;for(var A=e.length;g<A;g++)if(e[g]&&(e[g].length=f,f>a))for(var ga=a;ga<f;ga++)e[g][ga]=" ";a=f;b=c;d=10*b};this.writeText=
function(a,b,d){b--;a--;var A=e[f+b];A||(A=c(),e[f+b]=A);b=0;for(var g=d.length;b<g;b++)A[b+a]=d[b]};this.appendLines=function(a){f+=a};this.scrollDown=function(a,b,d){d=f+d-1-a;for(b=f+b-1;b<=d;b++)e[b]=e[b+a];d++;for(b=0;b<a;b++)e[d+b]=c()};this.scrollUp=function(a,b,d){b=f+b-1+a;for(d=f+d-1;d>=b;d--)e[d]=e[d-a];b--;for(d=0;d<a;d++)e[b-d]=c()};this.cleanScreen=function(){f=e.length;if(f>=d){var a=2*b;e.splice(0,a);f-=a}};this.clearEOS=function(c,d){d--;c--;for(var A=f+d,g,h,ga=0,k=b-d;ga<k;ga++)if(h=
e[A+ga])for(g=c;g<a;g++)h[g]=" "};this.clearBOS=function(a,b){b--;a--;for(var c=f,d,A,g=0;g<b;g++)if(A=e[c+g])for(d=0;d<a;d++)A[d]=" "};this.clearLine=function(b){b--;(b=e[f+b])&&hi5.Arrays.fill(b,0,a," ")};this.clearBOL=function(a,b){b--;a--;var c=e[f+b];if(c)for(var d=0;d<a;d++)c[d]=" "};this.clearEOL=function(b,c){c--;b--;var d=e[f+c];if(d)for(var g=b;g<a;g++)d[g]=" "};this.eraseChars=function(a,b,c){b--;a--;if(b=e[f+b]){var d=a;for(a+=c;d<a;d++)b[d]=" "}};this.deleteChars=function(a,b,c){b--;
a--;(b=e[f+b])&&b.splice(a,c)};this.insertSpace=function(a,b,c){c--;b--;if(c=e[f+c]){for(var d=c.length-1;d>=b;d--)c[d+a]=c[d];for(d=0;d<a;d++)c[b+d]=" "}};this.getSingleLine=function(a,b,c){a--;b--;c--;var d="";if(a=e[f+a])for(;b<c;b++)d+=a[b];return d.trimRight()};this.getMultiLines=function(b,c,d,g){if(g<c)return this.getMultiLines(d,g,b,c);var h=g-c+1;if(1>h)return null;if(1==h)return this.getSingleLine(c,b,d);b=this.getSingleLine(c,b,a);d=this.getSingleLine(g,1,d);h-=2;c+=f;for(var A=0;A<h;A++)b=
(g=e[A+c])?b+("\r\n"+g.join("").trimRight()):b+"\r\n\r\n";return b+"\r\n"+d};this.toString=function(){for(var a="",b=0,f=e.length;b<f;b++)e[b]&&(a+=e[b].join("").trimRight()),a+="\r\n";return a}}var Y=0,Z=null,Oa=!1;this.displayMsg=!0;this.reconnectTimes=0;this.setTitle=this.openLink=!0;this.mode=0;this.reconnectOnResize=!0;var d=this;this.getHistory=function(){return w.toString()};hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var x=hi5.appcfg,M={on:!1,text:"",prompt:"",cmd:"",
process:function(){var a=M.cmd.indexOf(" "),b=M.cmd.substring(a+1),a=b.lastIndexOf("."),c="";if(-1!=a)switch(b.substring(a+1).toLowerCase()){case "jpe":case "jpg":case "jpeg":c="image/jpeg";break;case "gif":c="image/gif";break;case "bmp":c="image/bmp";break;case "svg":c="image/svg+xml";break;case "png":c="image/png";break;case "webp":c="image/webp";break;case "ico":c="image/x-icon"}a="data:"+(c||"application/octet-stream")+";base64,"+M.text;M.text="";d.showMessage(c?{msg:'<img src="'+a+'" style="max-width:100%"/>'}:
{msg:'<a download="'+b+'" href="'+a+'" target="_blank">'+b+"</a>"})}};void 0!=x.reconnectOnResize&&(this.reconnectOnResize=x.reconnectOnResize);var Ia="object"==typeof g?g:null,db="object"==typeof g||0<g.indexOf("/PLAY?");db?(this.mode=1,Ia&&(g=""),g+="&touchpad=on"):0<g.indexOf("/JOIN?")&&(this.mode=2,this.reconnectOnResize=!1);var l=hi5.tool.queryToObj(g.substring(g.indexOf("?")+1));l.color||(l.color=32);var U=N(l.mapClipboard)?document.getElementById("copytextarea"):null,w=null;U&&(U.value="");
var va={download:"/DOWNLOAD?",clipboard:"/CLIP?"};this.setLinks=function(a){a.download&&(va.download=a.download);a.clipboard&&(va.clipboard=a.clipboard)};this.server=l.server;this.port=parseInt(l.port,10);this.sessionInfo={major:0,minor:0,width:0,height:0,bpp:0,bigEndian:!0,trueColor:!0};var u=null,y=!1,oa=!1,Ja=0,ua="",O=0,B=null;x.copyDialog=!0;var p=0,r=0,t=0,h=18,Qa=0,Ba="#000 #cd0000 #00cd00 #cdcd00 #0000ee #cd00cd #00cdcd #e5e5e5".split(" "),Za="#7f7f7f #ff0000 #00ff00 #ffff00 #5c5cff #ff00ff #00ffff #ffffff".split(" "),
sa=Ba,C=l.fgColor||sa[7],E=l.bgColor||sa[0],Ya=0,pa=!0;l.wraparoundMode&&(pa=N(l.wraparoundMode));var I=1,P=24,wa=0,Ka=!0,na=document.getElementById("cursorID"),J=0,G=0,F=0,S=null;window.$ssh=this;var ea=new function(a){var b=0,c=0,f=new Uint8Array(a),e=this,d=new Ma(0,null,0);this.needMore=!1;this.release=function(){e=f=d=null};this.getHandler=function(){return d};this.getData=function(){return f};this.getPosition=function(){return b};this.setPosition=function(a){b=a};this.getEnd=function(){return c};
this.has=function(a){return c-b>=a};this.set=function(a){var e=a.length,d=c-b;if(1>d)c=e,f=a;else{var g=f.subarray(b,c);c=d+e;e=new Uint8Array(c);e.set(g);e.set(a,d);f=e}b=0};this.handle=function(){d.handler(e,d)};this.setHandler=function(a){a&&1>a.need&&svGlobal.logger.warn("need < 1");(d=a)&&c-b>=a.need&&a.handler(e,a)};this.getByte=function(){return f[b++]};this.peekByte=function(){return f[b]};this.getBE32=function(){return f[b++]<<24|f[b++]<<16|f[b++]<<8|f[b++]};this.getBE16=function(){return f[b++]<<
8|f[b++]};this.skip=function(a){b+=a};this.skipBack=function(a){b-=a};this.getBytes=function(a,e){if(e)for(var c=0;c<a;c++)e[c]=f[b++];else return c=b,b+=a,f.subarray(c,b)};this.copyToByteArray=function(a,b,e,c){hi5.Arrays.arraycopy(f,e,a,b,c)}}(4194304);this.__que=ea;this.running=function(){return y};this.setColorTable=function(a){Ba=a};this.setColorTableBright=function(a){Za=a};this.loadbalanceToken=x.loadbalanceTokenName?x.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.mapCmdToCtrl=!0;var q=
null;m||(m=window.innerWidth);l.width=m;g+="&width="+m;n||(n=window.innerHeight);l.height=n;g+="&height="+n;v=(v=v||l.fontSize)?parseInt(v):13;l.fontSize?(v=parseInt(l.fontSize,10),l.fontSize=v):(l.fontSize=v,g+="&fontSize="+v);var Sa,R=window.OffscreenCanvas?new OffscreenCanvas(m,n):document.createElement("canvas"),k;this.modifyURL=function(a){d.loadbalanceToken&&(a+="&"+d.loadbalanceToken);return a};this.__write=Ea;this.getFileUrl=function(a){var b=ha(),c=va.download,f=c.indexOf("://"),b=(0<f&&
11>f?c:b+c)+"s="+ua+"&f="+a;return d.modifyURL(b)};this.listFiles=function(a,b){B&&B.list(a,b)};this.reconnect=function(a,b){xa(a,b);q.send("ED"+G+"\t"+J+"\t"+m+"\t"+n)};var K=new function(a){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.localLockFlags=0;this.checkLockFlags=!0;this.getAppMode=function(){return a.mode};this.send=function(b){"891"!=b&&y&&a.__write(b)};this.sendInput=function(b){a.writeRawInput(b);if(a.onactivity)a.onactivity(b)};
var b=null;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.onresize=function(c){if(c=c.target.svSurface){c=c.getFreeSpace();var f=c.width,e=c.height;hi5.browser.isTouch||Math.abs(m-f)<t&&Math.abs(n-e)<h||!a.reconnectOnResize||!y||(b&&(clearTimeout(b),b=null),b=setTimeout(function(){xa(f,e);q.send("ED"+G+"\t"+J+"\t"+m+"\t"+n)},333))}};this.onorientationchange=function(a){};this.getClipData=ta;this.onfocus=function(a){};this.getShareFiles=a.listFiles;this.getFile=function(b){var f=a.getFileUrl(b);
a.ondownload&&a.ondownload({fileName:b,url:f})||window.open(f)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return g};this.reconnect=function(a,b,e){};this.sendKeyboardSyncFlags=function(a){return y?(this.remoteLockFlags=this.localLockFlags=a,!0):!1};this.setWorkDir=function(b,f){f&&a.writeText("cd "+f+"\n")}}(this);void 0!=x.displayMsg?this.displayMsg=x.displayMsg:x.displayMsg=this.displayMsg;void 0!=x.reconnectTimes&&(this.reconnectTimes=x.reconnectTimes);void 0!=x.openLink&&(this.openLink=
x.openLink);void 0!=x.setTitle&&(this.setTitle=x.setTitle);"boolean"==typeof x.useWSS&&(g=(x.useWSS?"wss":"ws")+g.substring(g.indexOf("://")));this.getURL=function(){return g};var tb=parseInt(l.server_bpp||l.color||24);this.getColor=function(){return tb};this.run=function(){if(!y){if(Ia)q=Ia,Fa();else{Pa();var a=g+="&cols="+G+"&rows="+J;hi5.browser.binaryWS()&&(a+="&binary=on");var b=window.opener;if(b){var c=null;try{c=b.__sparkUser}catch(f){}c&&(b=c.account,c=c.session,b&&(a+="&account="+b),c&&
(a+="&session="+c))}g=a+("&pasteCap="+(hi5.browser.isChrome&&hi5.browser.isDesktop?3:0));a=0==d.mode&&x.wsPost?g.substring(0,g.indexOf("?"))+"?_METHOD=post":g;a=d.modifyURL(a);(c=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(c));q=new WebSocket(a,"ssh");q.binaryType="arraybuffer"}q.onopen=ob;void 0!=l.recording&&"on"==l.recording&&hb(l);q.onmessage=function(a){a=a.data;if("string"!=typeof a){var b=new Uint8Array(a);null!=S&&S.add(new RecordingObj(b,0,a.byteLength));
ea.set(b);ea.handle()}else{var c=parseInt(a.substring(0,2),16),b=a.substring(2);switch(c){case 0:a=g.substring(g.indexOf("?")+1);q.send("00"+a);q.send("87"+navigator.userAgent);break;case 15:a=JSON.parse(b);q.send("8D");if(d){d.sessionInfo.protocolVersion=a.protocolVersion;if(d.onready)d.onready();if(d.onloggedin)d.onloggedin();x.pingInterval&&d.startPing(x.pingInterval);B&&(B.enabled=!0)}ja(!1);break;case 26:a=JSON.parse(b);if(a.name){svGlobal.logger.info("msg="+b);if(d.onerror)d.onerror(a);b=__svi18n.errorCode["S"+
a.name]||"";b+=a.message||a.msg;d.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+b);break;case 27:0!=x.drawLicense&&u.drawLicense(b);break;case 56:a=JSON.parse(b);ua=a.session;a.server=d.server;if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;var b=nb("joinssh.html")+"?id="+a.numericId,b=d.modifyURL(b),f=a.webAddress;f&&0<f.length&&(c=f.indexOf("://"),f=f.substring(c+3),c=f.indexOf("/"),0<c&&(f=f.substring(0,c)),f.toLowerCase()!=
location.host.toLowerCase()&&(b+="&gateway="+f));a.joinLink=b;d.sessionInfo.appInfo=a;a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);Fa();if(d&&d.onsessionstart)d.onsessionstart(d.sessionInfo);break;case 58:if(B)if(a=parseInt(b.charAt(0),10),b=b.substring(1),5==a)B.notifyFiles(JSON.parse(b));else switch(b=b.split("\t"),a){case 1:B.confirmId(b[0],b[1],b[2]);break;case 2:B.read(b[0],parseInt(b[1],10),parseInt(b[2],10));break;case 4:B.close(b[0]);break;
case 9:a='<a href="'+b[0]+'" download="'+b[1]+'" target="_blank">'+__svi18n.info.fileReady+"</a>",surfaces.getFocused().showMessage({msg:a,title:__svi18n.info.download})}break;case 59:a=hi5.Base64.dec(b,0);Ja=a[3]<<24|a[2]<<16|a[1]<<8|a[0];Ja&64&&d.showMessage(__svi18n.info.recording);u.setFeature(Ja);break;case 61:a=JSON.parse(b);switch(a.type){case 0:l.fontSize=parseInt(a.fontSize);m=a.width;n=a.height;Fa();u.setAutoScale(!0);xa(0,0,G,J);if(b=a.server)d.server=a.server,d.setTitle&&(document.title=
l.displayName||d.server);(b=a.mapDisk)&&cb(u);ja(!1);eb=a.length;if(d.onopened)d.onopened(a);break;case 1:a=a.duration;if(d.onprogress)d.onprogress(a,eb);break;case 2:2==a.status?y=!0:((Ra=b=0==a.status)||V(),a.warn&&d.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed))}break;case 62:mb(b);break;case 91:oa=!0;if(d.onusername)d.onusername(lb);else W(__svi18n.info.user||b),aa=!0,V(),ia();break;case 93:z=JSON.parse(b);if(d.onauthprompt)d.onauthprompt(z,kb);else a=z.name||"",z.instruction&&
(a+=z.instruction),a&&(r+=h,p=0,W(a),ia()),z.answer=[],Na();break;default:svGlobal.logger.warn("@TODO:"+a+"\n")}}};q.onclose=za;q.onerror=pb;d.setTitle&&(document.title=l.displayName||d.server)}};this.setJoinMode=function(a){y&&q.send("8E1"+a)};this.refuseControl=function(a){y&&q.send("8E3"+a)};this.giveControl=function(a){y&&q.send("8E4"+a)};this.requestControl=function(){y&&q.send("8E2")};this.play=function(){q.send("F3")};this.pause=function(){q.send("F2")};this.scan=function(a){q.send("F4"+(a?
"1":"0"))};this.seek=function(a){u&&y&&q.send("F4"+(a?"1":"0")+"\t"+(a/u.getScale().x|0))};this.allowJoin=function(a,b){q.send("8EA"+a+"\t"+(b?1:0))};var Q=null,aa=!1,z=null,X="",eb=0;this.hide=function(){u&&(ja(!0),u.hide())};this.showMessage=function(a,b){d.displayMsg&&a&&(u?u.showMessage(a,b):("string"==typeof a&&(a={msg:a,timeout:b||0}),hi5.notifications.notify(a)))};this.close=function(){if(q&&y)try{q.send("85"),q.close()}catch(a){}else za()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(za):
window.addEventListener("unload",za,!1);var ub=new Ma(1024,function(a){var b=p,c=r;for(a.needMore=!1;a.has(1);){var f=a.getByte();if(31>=f)if(27==f){a:if(f=a,f.has(1)){var e=f.getByte();switch(e){case 40:f.getByte();break;case 41:f.getByte();break;case 55:break;case 61:break;case 62:break;case 68:Xa();break;case 69:Ua();r+=h;ka(!0);break;case 77:Wa();break;case 92:console.log("ST");break;case 93:console.log("OSC:"+rb(f,7));break;case 91:f=qb(f);break a;default:console.log("unkown cmd for ESC:"+e)}f=
!0}else f.skipBack(1),f=!1;if(!f)return}else Ta(f);else if(128<=f&&159>=f)switch(f){case 146:a.skip(2);break;default:console.log("C1:"+f)}else{a.skipBack(1);f=W;a:{for(var e=a,d=e.getPosition(),g,k="",l=e.getEnd(),m=e.getData();d<l;)if(g=m[d++],31<g&&(128>g||159<g)){if(177!=g)switch(g>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:k+=String.fromCharCode(g);break;case 12:case 13:if(d<l)k+=String.fromCharCode((g&31)<<6|m[d++]&63);else{e.needMore=!0;e=k;break a}break;case 14:if(1<l-d)k+=
String.fromCharCode((g&15)<<12|(m[d++]&63)<<6|(m[d++]&63)<<0);else{e.needMore=!0;e=k;break a}}}else{d--;break}e.setPosition(d);e=k}f(e);if(a.needMore)return}}b==p&&c==r||ia();V();Z&&Z.check()});ea.setHandler(ub);var Ra=!1;this.refreshOutput=V;var T={mode:0,parameters:[0],count:0,trailing:0,command:0,toString:function(){var a="CSI, ";this.mode&&(a+="mode:"+String.fromCharCode(this.mode));0<this.count&&(a+=" parameters:"+this.parameters.slice(0,this.count).join(";"));this.trailing&&(a+=" trailing:"+
String.fromCharCode(this.trailing));return a+=" cmd:"+String.fromCharCode(this.command)},parse:function(a){var b=0,c=!1,f=a.getByte();if(!f)return!1;if(60<=f&&63>=f)this.mode=f,f=a.getByte();else if(this.mode=0,31>=f||128<=f&&159>=f)Ta(f),f=a.getByte();if(!f)return!1;for(this.count=0;48<=f&&57>=f||59==f;)if(59==f?(this.parameters[this.count]=c?b:null,this.count++,b=0,c=!1):(b=10*b+(f-48),c=!0),f=a.getByte(),!f)return!1;c?(this.parameters[this.count]=b,this.count++):0<this.count&&(this.parameters[this.count]=
1,this.count++);if(32<=f&&47>=f){if(this.trailing=f,f=a.getByte(),!f)return!1}else this.trailing=0;64<=f&&127>=f?this.command=f:(this.command="",console.log("Invalid CSI final char:"+String.fromCharCode(f)));return!0}};this.showHistory=bb;this.getUploadManager=function(){return B};this.addSurface=function(a){u=a;db&&a.setPlayerMode();Sa=u.context;R.width=m;R.height=n;k=R.getContext("2d",{alpha:!1});a.forceTextArea=!0;a.alwaysPaste=!0;a.setAutoScale(0<d.mode);a.setSize(m,n);a.setController(K);a.setTouchpad(N(l.touchpad));
a.setClipboard(N(l.mapClipboard));cb(u);var b=void 0!=l.cmdToCtrl?N(l.cmdToCtrl):void 0!=x.cmdToCtrl?x.cmdToCtrl:d.mapCmdToCtrl;a.run(99997,!1,!0,b);a.onclipdata=sb};this.sendPing=function(a){a=new Uint8Array(2);a[0]=146;Ea(a.buffer)};this.startPing=function(a){Z||(Z=new hi5.tool.ResponseMonitor(function(){oa&&d.sendPing()},function(){oa&&Z.check(1)}));Z.setInterval(a,a);setTimeout(function(){Z.check()},1E3*a)};this.stopPing=function(){Z&&Z.stop()};this.writeText=D;this.writeScancode=function(a,b){D(fa.process(a,
b,0))};var vb={" ":57,space:57,pageup:201,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.writeKeyComb=function(a){a=a.split("+");var b=a.length;if(0!=b)for(var c=null,f=0;f<b;f++){var e=
a[f];""==e&&""==c&&(e="Add");if(""!=e){var c=e,g=vb[c.toLowerCase()];g?d.writeScancode(!0,g):console.log("Invalid key:"+c)}c=e}};var Ca=!1,ba=0,ca=0,Da=0,la=!1,fb=0,gb=0,ma=null;this.writeRawInput=function(a){if(y){var b=parseInt(a.substring(0,2),16);a=a.substring(2).split("\t");switch(b){case 128:ba=parseInt(a[0]);ca=parseInt(a[1]);Da=parseInt(a[2]);la=!1;Ca=!0;fb=Math.floor(ba/t)*t;gb=Math.floor(ca/h)*h;1015==O?D("\u001b["+(parseInt(a[2])+32)+";"+(Math.floor(ba/t)+1)+";"+(Math.floor(ca/h)+1)+"M"):
1006==O?D("\u001b[<"+a[2]+";"+(Math.floor(ba/t)+1)+";"+(Math.floor(ca/h)+1)+"M"):O&&D("\u001b[M"+a[2]+String.fromCharCode(Math.floor(ba/t)+33)+String.fromCharCode(Math.floor(ca/h)+33));return;case 129:O&&(1015==O?D("\u001b["+(parseInt(a[2])+32)+";"+(Math.floor(ba/t)+1)+";"+(Math.floor(ca/h)+1)+"M"):1006==O?D("\u001b[<"+a[2]+";"+(Math.floor(parseInt(a[0])/t)+1)+";"+(Math.floor(parseInt(a[1])/h)+1)+"m"):O&&D("\u001b[M3"+String.fromCharCode(Math.floor(parseInt(a[0])/t)+33)+String.fromCharCode(Math.floor(parseInt(a[1])/
h)+33)));Da=parseInt(a[2]);2==Da&&Ca&&!la?(U&&(U.value=""),setTimeout(bb,50)):la&&(a=w.getMultiLines(Math.floor(ba/t)+1,Math.floor(ca/h+.1)+1,Math.floor(parseInt(a[0])/t+.4)+1,Math.floor(parseInt(a[1])/h-.4)+1))&&u&&u.copyToClip("text/plain;"+a);ma&&(setTimeout(u.removeWhiteboard,333),ma=null);la=Ca=!1;return;case 130:if(Ca){b=parseInt(a[0]);a=parseInt(a[1]);if(!la){if(3>Math.abs(b-ba)&&3>Math.abs(a-ca))return;la=!0}if(0==Da){if(!ma){var c=u.initWhiteboard();c.style.opacity=.6;c=c.getContext("2d");
ma=new hi5.canvas.TextSelect(c,h,x.selectionColor,"1px",m)}ma.clear();ma.draw(fb,gb,b,a)}}return;case 131:1006==O?D("\u001b[<"+("1"==a[2]?65:64)+";"+(Math.floor(parseInt(a[0])/t)+1)+";"+(Math.floor(parseInt(a[1])/h)+1)+"M"):O&&D("\u001b[M"+("1"==a[2]?5:4)+String.fromCharCode(Math.floor(parseInt(a[0])/t)+64)+String.fromCharCode(Math.floor(parseInt(a[1])/h)+64));return;case 132:c=0==a[0];b=parseInt(a[1]);if(aa||z)c&&(a=b,28==a?(r+=h,p=0,aa?(aa=!1,q.send("5B"+X),X=""):z&&(z.answer.push(X),X="",Na())):
14==a&&0<X.length&&(X=X.substring(0,X.length-1),aa&&(Ga(),W(" "),V(),Ga())));else if(D(fa.process(c,b,0)),28!=b)Y||(Y=L());else if(Y){if(Y&&(a=w.getSingleLine(H(),Y,L()))){b=w.getSingleLine(H(),1,Y);if(d.oncommand)d.oncommand(a,b);a.startsWith("cd /")?u.setDirectory(a.substring(3)):a.startsWith("base64 ")&&(M.on=!0,M.cmd=a,M.prompt=b)}Y=0}return;case 139:b=parseInt(a[1]);c=0==a[0];D(fa.process(c,b,1));return;case 134:aa||z?ab(a[0]):(Y||(Y=L()),D(fa.process(!0,a[0],3)));return}svGlobal.logger.warn("Unknowncode: "+
a[1]+" type:"+b)}};var fa=new function(){var a=!1,b=!1,c=!1,f=0;this.setEscMode=function(a){f=a;console.log("Esc mode:"+a)};this.process=function(e,d,g){if(3==g)return d;if(0==g){switch(d){case 29:case 157:return a=e,"";case 56:case 184:return b=e,"";case 42:case 54:return c=e,""}if(e){switch(d){case 28:e="\r";break;case 200:e=0==f?"\u001b[A":"\u001bOA";break;case 208:e=0==f?"\u001b[B":"\u001bOB";break;case 205:e=0==f?"\u001b[C":"\u001bOC";break;case 203:e=0==f?"\u001b[D":"\u001bOD";break;case 59:e=
"\u001bOP";break;case 60:e="\u001bOQ";break;case 61:e="\u001bOR";break;case 62:e="\u001bOS";break;case 63:e="\u001b[15~";break;case 64:e="\u001b[17~";break;case 65:e="\u001b[18~";break;case 66:e="\u001b[19~";break;case 67:e="\u001b[20~";break;case 68:e="\u001b[21~";break;case 87:e="\u001b[23~";break;case 88:e="\u001b[24~";break;case 15:e="\t";break;case 209:e="\u001b[6~";break;case 201:e="\u001b[5~";break;case 199:e=0==f?"\u001b[H":"\u001bOH";break;case 207:e=0==f?"\u001b[F":"\u001bOF";break;case 14:e=
c?"\b":"\u007f";break;case 211:e="\u001b[3~";break;case 197:e="\u00ff\u00f3";break;case 210:e="\u001b[2~";break;case 1:e="\u001b";break;case 55:e="*";break;case 71:e=K.localLockFlags&2?"7":0==f?"\u001b[H":"\u001bOH";break;case 72:e=K.localLockFlags&2?"8":0==f?"\u001b[A":"\u001bOA";break;case 73:e=K.localLockFlags&2?"9":"\u001b[5~";break;case 74:e="-";break;case 75:e=K.localLockFlags&2?"4":0==f?"\u001b[D":"\u001bOD";break;case 76:e=K.localLockFlags&2?"5":"\u001bOu";break;case 77:e=K.localLockFlags&
2?"6":0==f?"\u001b[C":"\u001bOC";break;case 78:e="+";break;case 79:e=K.localLockFlags&2?"1":0==f?"\u001b[F":"\u001bOF";break;case 80:e=K.localLockFlags&2?"2":0==f?"\u001b[B":"\u001bOB";break;case 81:e=K.localLockFlags&2?"3":"\u001b[6~";break;case 82:e=K.localLockFlags&2?"0":"\u001b[2~";break;case 83:e=K.localLockFlags&2?".":"\u001b[3~";break;case 156:e="\r";break;case 181:e="/";break;default:return console.log("Invalid code:"+d),""}b&&(e="\u001b"+e);return e}return""}if(1==g&&e&&a){if(64<d&&91>d)return String.fromCharCode(d-
64);switch(d){case 54:return"\u001e";case 219:return"\u001b";case 220:return"\u001c";case 221:return"\u001d";case 32:return"\x00";case 192:return"\u001e";case 191:return"\u001f";default:return console.log("Invalid key code:"+d),""}}if(b)return"\u001b"+String.fromCharCode(d).toLowerCase()}}};
