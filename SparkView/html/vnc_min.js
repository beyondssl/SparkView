var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(k,v,z){if(null==k)throw new TypeError("The 'this' value for String.prototype."+z+" must not be null or undefined");if(v instanceof RegExp)throw new TypeError("First argument to String.prototype."+z+" must not be a regular expression");return k+""};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(k,v,z){k!=Array.prototype&&k!=Object.prototype&&(k[v]=z.value)};
$jscomp.getGlobal=function(k){return"undefined"!=typeof window&&window===k?k:"undefined"!=typeof global&&null!=global?global:k};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(k,v,z,J){if(v){z=$jscomp.global;k=k.split(".");for(J=0;J<k.length-1;J++){var K=k[J];K in z||(z[K]={});z=z[K]}k=k[k.length-1];J=z[k];v=v(J);v!=J&&null!=v&&$jscomp.defineProperty(z,k,{configurable:!0,writable:!0,value:v})}};
$jscomp.polyfill("String.prototype.startsWith",function(k){return k?k:function(k,z){var v=$jscomp.checkStringArgs(this,k,"startsWith");k+="";for(var K=v.length,ia=k.length,fa=Math.max(0,Math.min(z|0,v.length)),q=0;q<ia&&fa<K;)if(v[fa++]!=k[q++])return!1;return q>=ia}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;
$jscomp.Symbol=function(k){return $jscomp.SYMBOL_PREFIX+(k||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var k=$jscomp.global.Symbol.iterator;k||(k=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[k]&&$jscomp.defineProperty(Array.prototype,k,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(k){var v=0;return $jscomp.iteratorPrototype(function(){return v<k.length?{done:!1,value:k[v++]}:{done:!0}})};$jscomp.iteratorPrototype=function(k){$jscomp.initSymbolIterator();k={next:k};k[$jscomp.global.Symbol.iterator]=function(){return this};return k};
$jscomp.iteratorFromArray=function(k,v){$jscomp.initSymbolIterator();k instanceof String&&(k+="");var z=0,J={next:function(){if(z<k.length){var K=z++;return{value:v(K,k[K]),done:!1}}J.next=function(){return{done:!0,value:void 0}};return J.next()}};J[Symbol.iterator]=function(){return J};return J};$jscomp.polyfill("Array.prototype.keys",function(k){return k?k:function(){return $jscomp.iteratorFromArray(this,function(k){return k})}},"es6-impl","es3");
var svManager={getInstance:function(){var k=window.$vnc;return k&&k.running&&k.running()?k:null}};function connvertServer(k){var v={};v.id=k.id;v.server=k.id;v.displayName=k.displayName||k.id;if(k=k.vnc){for(var z in k)v[z]=k[z];v.pwd=k.password||""}return v}
svGlobal.Vnc=function(k,v,z,J){function K(a){return"on"==a||"true"==a||1==a}function ia(a,b){function c(a){!u&&a-q>O&&0<g.width&&(l.repaint(g.x,g.y,g.width,g.height),g.width=0,q=a);r=requestAnimationFrame(c)}var f=[],h=null,e=null,g=new hi5.graphic.Rectangle(0,0,0,0),d="Uint8ClampedArray"in window;this.width=a;this.height=b;var O=B.animation||62,k=null,u=!1,l=this,F=null,q=0,r=0;this.pause=function(c){(u=c)?(window.OffscreenCanvas?k=new OffscreenCanvas(a,b):(k=document.createElement("canvas"),k.width=
a,k.height=b),e=h,c=k.getContext("2d",{alpha:!1}),c.drawImage(h.canvas,0,0),l.setContext(c)):e&&(e.drawImage(h.canvas,0,0),l.setContext(e))};this.release=function(){cancelAnimationFrame(r);F=f=h=l=null};this.isPaused=function(){return u};this.setContext=function(c){c!=h&&(h||!c||c.createImageData(1,1).data.buffer||(d=!1),h=c,null!=h&&(F=h.createImageData(a,b)))};this.getContext=function(){return h};this.resize=function(c,e){for(var p=0;p<e;p++)f[p]=new Uint32Array(c);l.width=a=c;l.height=b=e;null!=
h&&(F=h.createImageData(a,b))};l.resize(a,b);this.getBuffer=function(){return f};this.setRGB=function(a,b,c){f[b][a]=c|4278190080};this.getRGB=function(a,b){return f[b][a]};this.setRGBs=function(a,b,c,h,e,g,d){var p=a+c;h=b+h;if(e.subarray)for(;b<h;b++,g+=d)f[b].set(e.subarray(g,g+c),a);else for(var m;b<h;b++,g+=d){var w=g;m=f[b];for(c=a;c<p;c++)m[c]=e[w++]}};this.moveArea=function(a,b,c,h,e,g){if(0<g)for(e=a+e,g=b+g,--h;0<=h;h--)f[g+h].set(f[b+h].subarray(a,a+c),e);else if(0>g){e=a+e;g=b+g;for(var p=
0;p<h;p++)f[g+p].set(f[b+p].subarray(a,a+c),e)}else if(0<e){e=a+e;g=b+g;var p=f,d;for(--c;0<=c;c--){var m=e+c;var k=a+c;for(d=0;d<h;d++)p[g+d][m]=p[b+d][k]}}else{e=a+e;g=b+g;var p=f;for(d=0;d<c;d++){k=e+d;var w=a+d;for(m=0;m<h;m++)p[g+m][k]=p[b+m][w]}}};this.getRGBs=function(a,b,c,h){var e=_Uint32Array(c*h);e[0]=0;var g=f;c=a+c;h=b+h;for(var p=0,d=b;d<h;d++)for(b=a;b<c;b++)e[p++]=g[d][b];return e};this.repaint=function(c,e,g,m){var p=F.data,k=0,O,E;0>c&&(g+=c,c=0);0>e&&(m+=e,e=0);c+g>a&&(g=a-c);e+
m>b&&(m=b-e);var u=c+g;var w=e+m;if(d)for(p=new Uint32Array(p.buffer),E=e;E<w;E++)p.set(f[E].subarray(c,u),k),k+=a;else{var Q=4*(a-g)|0;for(E=e;E<w;E++){for(O=c;O<u;O++){var l=f[E][O];p[k++]=l&255;p[k++]=l>>8&255;p[k++]=l>>16&255;p[k++]=255}k+=Q}}h.putImageData(F,c,e,0,0,g,m)};this.postPaint=function(a,b,c,h){0<g.width?g.union(a,b,c,h):(g.x=a,g.y=b,g.width=c,g.height=h)};this.commitPaint=function(){0<g.width&&(this.repaint(g.x,g.y,g.width,g.height),g.width=0)};this.startAnimation=function(){r=requestAnimationFrame(c)};
this.fillRect=function(a,b,c,h,e){c=a+c;h=b+h;for(var g=b;g<h;g++)if(f[g].fill)f[g].fill(e,a,c);else{var d=f[g];for(b=a;b<c;b++)d[b]=e}}}function fa(){var a=k.indexOf("://"),b=k.substring(a+3),a=b.indexOf("/");0<a&&(b=b.substring(0,a));return location.protocol+"//"+b}function q(a){L&&x.send(a)}function Na(a){if(!ja)return"";a=hi5.browser.httpGet(fa()+"/CLIP?s="+ja+"&t="+Date.now(),!1);setTimeout(function(){x.send("883")},999);return a}function M(a,b,c){this.need=a;this.handler=b;this.repeat=c||1}
function Aa(a){var b=0,c=0,f=new Uint8Array(a),h=this,e=new M(0,null,0);this.release=function(){h=f=e=null};this.getHandler=function(){return e};this.getData=function(){return f};this.getPosition=function(){return b};this.setPosition=function(a){b=a};this.getEnd=function(){return c};this.set=function(a,h,e){f=a;b=h;c=e};this.handle=function(){e.handler(h,e)};this.setHandler=function(a){a&&1>a.need&&svGlobal.logger.warn("need < 1");(e=a)&&c-b>=a.need&&a.handler(h,a)};this.getByte=function(){return f[b++]};
this.peekByte=function(){return f[b]};this.getBE32=function(){return f[b++]<<24|f[b++]<<16|f[b++]<<8|f[b++]};this.getBE16=function(){return f[b++]<<8|f[b++]};this.skip=function(a){b+=a};this.skipBack=function(a){b-=a};this.getBytes=function(a,c){if(c)for(var h=0;h<a;h++)c[h]=f[b++];else return h=b,b+=a,f.subarray(h,b)};this.copyToByteArray=function(a,b,c,h){hi5.Arrays.arraycopy(f,c,a,b,h)};this.getString16LE=function(a,b){for(var c="",h=a;h<b;)var e=f[h++]|f[h++]<<8,c=c+String.fromCharCode(e);return c}}
function Ba(){var a="";l&&K(l.connectif)&&l.symlink&&"sessionStorage"in window&&(a="SV_"+l.symlink,l.user&&(a+=l.user));return a}function Oa(){var a=Ba(),b="";a&&(b=sessionStorage[a]||"")&&(b="&preSymJoin="+b);return b}function Pa(){if(!L){if(ka)x=ka,ha(l.width,l.height);else{var a=hi5.tool.replaceQuery(k,"pwd","x")+Oa();hi5.browser.binaryWS()&&(a+="&binary=on");var b=window.opener;if(b){var c=null;try{c=b.__sparkUser}catch(h){}c&&(b=c.account,c=c.session,b&&(a+="&account="+b),c&&(a+="&session="+
c))}a=d.modifyURL(a+("&pasteCap="+(hi5.browser.isChrome&&hi5.browser.isDesktop?3:0)));(c=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(c));x=new WebSocket(a,"vnc");x.binaryType="arraybuffer"}Z.ws=x;x.onopen=Qa;var f=new hi5.DataBuffer([],0,0);x.onmessage=function(a){a=a.data;if("string"!=typeof a){var b=new Uint8Array(a);null!=V&&V.add(new RecordingObj(b,0,a.byteLength));switch(b[0]){case 48:n.set(b,2,b-2);n.handle();break;case 56:f.attach(b,2,b.length-2);Ca(f.getUnicodeString(f.getEnd()-
f.getPosition(),!1));break;case 60:if(la||ma)switch(f.attach(b,2,b.length-2),f.getByte()){case 32:if(y&&!y.isPaused()){a=f.getLittleEndian16();b=f.getLittleEndian16();var c=f.getLittleEndian16();var h=f.getLittleEndian32(),k=d.sessionInfo.appInfo.sessions[h];r&&r.moveCursor(b,c,!0,k,h,a)}}break;case 62:f.attach(b,2,b.length-2);oa(f.getUnicodeString(f.getEnd()-f.getPosition(),!1));break;case 146:f.attach(b,2,b.length-2);switch(f.getByte()){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;q(a.buffer);break;
case 1:S&&S.check();break;case 6:Z.remoteLockFlags=f.getLittleEndian32(),Z.checkLockFlags=!0}break;default:svGlobal.logger.warn("invalid type:"+b[0])}}else switch(c=parseInt(a.substring(0,2),16),b=a.substring(2),c){case 26:a=JSON.parse(b);if(a.name){svGlobal.logger.info("msg="+b);if(d.onerror)d.onerror(a);b=__svi18n.errorCode["S"+a.name]||"";b+=a.message||a.msg;d.showMessage(b)}else 0<svGlobal.log&&console.erro("No error code for message:"+b);break;case 27:0!=B.drawLicense&&r.drawLicense(b);break;
case 56:Ca(b);break;case 59:a=hi5.Base64.dec(b,0);pa=a[3]<<24|a[2]<<16|a[1]<<8|a[0];pa&64&&d.showMessage(__svi18n.info.recording);r.setFeature(pa);break;case 61:a=JSON.parse(b);switch(a.type){case 0:ha(a.width,a.height);I=a.color/8|0;"ignoreCursor"in a&&(qa=a.ignoreCursor);"trackCursorLocally"in a&&(la=a.trackCursorLocally,Da(r));a.server&&(d.server=a.server,d.setTitle&&(document.title=l.displayName||d.server));Ea=a.length;r&&r.setAutoScale(!0);if(d.onopened)d.onopened(a);break;case 1:a=a.duration;
if(d.onprogress)d.onprogress(a,Ea);break;case 2:2==a.status?(ra(),L=!0):(b=0==a.status,y.pause(b),R=y.getContext(),a.warn&&d.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed))}break;case 62:oa(b);break;default:svGlobal.logger.warn("@TODO:"+a+"\n")}};x.onclose=da;x.onerror=Ra}}function Sa(a,b){var c=0,f=!1;this.width=a;this.interval=b;var h=0;this.start=function(){f||(f=!0,c=setInterval(function(){if(r&&L){var b=r.getThumbnail(a);b&&b.length!=h&&(q("8E7"+b),h=b.length)}},b))};
this.stop=function(){clearInterval(c)}}function Ta(a,b){!P||P.width==a&&P.interval==b||(P.stop(),P=null);P||(P=new Sa(a,b));P.start()}function Ua(a){var b=B.page&&B.page.join||"";if(b.startsWith("http://")||b.startsWith("https://"))return b;if(b.startsWith("/"))return location.origin+b;var c=location.href,f=c.lastIndexOf("/");if(b)return c.substring(0,f+1)+b;b=fa();c.toLowerCase().startsWith(b.toLowerCase())&&(b=c.substring(0,f));return b+"/"+a}function Ca(a){var b=a.indexOf('"sessions":{,');0<b&&
(b+=13,a=a.substring(0,b-1)+a.substring(b));a=JSON.parse(a);ja=a.session;a.server=d.server;if(b=hi5.$("joinSelect"))b.value=a.joinMode;if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined||ma||(d.mode=0,n.setHandler(sa),aa=new ta);var b=Ua("joinvnc.html")+"?id="+a.numericId,b=d.modifyURL(b),c=a.webAddress;if(c&&0<c.length){var f=c.indexOf("://"),c=c.substring(f+3),f=c.indexOf("/");0<f&&(c=c.substring(0,f));c.toLowerCase()!=location.host.toLowerCase()&&(b+="&gateway="+c)}a.joinLink=b;d.sessionInfo.appInfo=
a;a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.info("Client:"+svGlobal.version+" server:"+a.ver);if(d.onsessionstart)d.onsessionstart(d.sessionInfo)}function Da(a){la?qa&&a.setCursor({system:"default",none:!1,result:"default"}):hi5.browser.isIE?a.setCursor({system:"none",none:!0,result:"none"}):a.setCursor({result:"url(data:image/x-icon;base64,AAACAAEAICACAAAAAAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAgAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAABQUFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAOAAAADgAAAA//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8f////H////x////8=) 0 0, none"})}
function Qa(a){svGlobal.logger.info("opened...");L=!0;q("87"+navigator.userAgent);if(d.onopen)d.onopen()}function Ra(a){svGlobal.logger.warn(a)}function da(a){if(d){svGlobal.logger.warn("closed ...");(a=Ba())&&d.sessionInfo.appInfo&&0==d.mode&&(sessionStorage[a]=d.sessionInfo.appInfo.session);n&&n.getHandler()&&n.getHandler().handler==ga&&d.onautherror&&d.onautherror();ea=L=!1;S&&(S.stop(),S=null);if(d&&d.onclose)d.onclose(Fa);try{null!=V&&(V.exit(),V=null),r&&(r.onclipdata=null,r.close(),r=null)}catch(b){}Ga=
Ha=l=ua=Ia=N=G=k=null;P&&(P.stop(),P=null);W=ka=null;hi5.browser.isChromeApp?chrome.runtime.onSuspend.remvoeListener(da):window.removeEventListener("unload",da,!1);x&&(x.onopen=null,x.onmessage=null,x.onclose=null,x=x.onerror=null);n&&(n.release(),n=null);T&&(T.release(),T=null);aa&&(aa.release(),aa=null);r=Z=va=sa=H=N=null;y&&(y.release(),y=null);R=null;d&&(d=null);window&&window.$vnc&&(window.$vnc=null);null!=V&&(V.exit(),V=null)}}function wa(){var a=new Uint8Array(2);a[0]=147;a[1]=K(l.share)?1:
0;q(a.buffer);n.setHandler(new M(24,function(a){if(d.onloggedin)d.onloggedin();q("8D");if(L){var b=d.sessionInfo;b.width=ba=a.getBE16();b.height=ca=a.getBE16();b.bpp=a.getByte();b.depth=a.getByte();b.bigEndian=0!=a.getByte();b.trueColor=0!=a.getByte();b.redMax=a.getBE16();b.greenMax=a.getBE16();b.blueMax=a.getBE16();b.redShift=a.getByte();b.greenShift=a.getByte();b.blueShift=a.getByte();a.skip(3);for(var f=a.getBE32(),h="",e=0;e<f;e++)h+=String.fromCharCode(a.getByte());b.name=h;svGlobal.logger.info("server name:"+
h);d.setTitle&&(document.title=h);ha(ba,ca);a=[];if(l){b=l.encoding;8==l.color&&"Tight"==b&&(b="ZRLE");switch(b){case "Tight":a.push(7);a.push(16);a.push(5);a.push(0);break;case "Raw":a.push(0);a.push(16);a.push(7);a.push(5);a.push(0);16==l.color&&(l.color=32);break;case "Hextile":a.push(5);a.push(16);a.push(7);a.push(0);16==l.color&&(l.color=32);break;default:a.push(16),a.push(7),a.push(5),a.push(0),16==l.color&&(l.color=32)}a.push(1);la&&(a.push(4294967057),a.push(4294967064));B.vnc&&!1===B.vnc.qemuExtKey||
a.push(4294967038);a.push(4294967035);"0"!=l.compression&&a.push(4294967040+parseInt(l.compression||6));"0"!=l.quality&&a.push(4294967264+parseInt(l.quality||5));a.push(4294967073);b=a.length;f=new Uint8Array(5+4*b);f[0]=147;f[1]=2;f[3]=b>>8&255;f[4]=b&255;for(h=0;h<b;h++)f[5+4*h]=a[h]>>24&255,f[6+4*h]=a[h]>>16&255,f[7+4*h]=a[h]>>8&255,f[8+4*h]=a[h]&255;q(f.buffer);a=parseInt(l.color);switch(a){case 32:xa(32,24,!1,!0,255,255,255,0,8,16);break;case 16:xa(16,16,!1,!0,31,63,31,11,5,0);break;case 8:xa(8,
8,!1,!0,7,7,3,0,3,6);break;default:svGlobal.logger.warn("invliad color depath:"+a)}I=a/8|0;T&&T.setBytesPerPixel(I);ya(0,0,ba,ca,!1);n&&n.setHandler(va);ea=!0;void 0!=l.recording&&"on"==l.recording&&(a=l,V=new RecordingManager,V.setHeader({name:a.server,width:a.width,height:a.height,color:a.server_bpp,namesuffix:".vncv",filetag:"VNCV",duration:0}));if(d&&(B.pingInterval&&d.startPing(B.pingInterval),d.onready))d.onready()}}}))}function ga(a){a=a.getBE32();svGlobal.logger.info("sec rst: "+a);var b=
{code:a,message:""};switch(a){case 0:wa();return;case 1:b.message=__svi18n.vnc.authError;break;case 2:b.message="Too many failed authentication";break;default:b.message="Unknown auth error"+a}n.setHandler(null);d.onautherror&&d.onautherror(b)||(d.showMessage(b.message),d.close())}function xa(a,b,c,f,h,e,g,d,k,l){var u=new Uint8Array(21);u[0]=147;u[1]=0;u[5]=a;u[6]=b;u[7]=c?1:0;u[8]=f?1:0;u[9]=h>>8&255;u[10]=h&255;u[11]=e>>8&255;u[12]=e&255;u[13]=g>>8&255;u[14]=g&255;u[15]=d;u[16]=k;u[17]=l;q(u.buffer)}
function ya(a,b,c,f,h){var e=new Uint8Array(11);e[0]=147;e[1]=3;e[2]=h?1:0;e[3]=a>>8&255;e[4]=a&255;e[5]=b>>8&255;e[6]=b&255;e[7]=c>>8&255;e[8]=c&255;e[9]=f>>8&255;e[10]=f&255;q(e.buffer)}function ta(){var a=new TINF;a.init(2==d.mode?120:0);var b=new Aa(0),c=new Uint32Array(4096),f=new Uint32Array(128);this.release=function(){f=c=null;a.release();a=null;b.release();b=null};this.getHistory=function(){var b=[90],c=a.getHistory().length,f=c&255;b.push(c>>8&255);b.push(f);return b=b.concat(a.getHistory())};
this.setHistory=function(b){a.setHistory(b)};this.decode=function(h,e,d,k,O,l){var g,E=h.getBE32();h=h.getBytes(E);h=a.uncompress(h,0);b.set(h.dest,0,h.destIndex);var Q=f,q,r=b.getByte,A=c;2==I&&(I=4);for(h=d;h<d+O;h+=64){var p=Math.min(d+O-h,64);for(E=e;E<e+k;E+=64){var w=Math.min(e+k-E,64);var m=r();var t=0!=(m&128);m&=127;if(1==I)for(g=0;g<m;g++)Q[g]=W[r()];else for(g=0;g<m;g++)Q[g]=r()|r()<<8|r()<<16|4278190080;if(1!=m||l){if(t)if(0==m)for(m=0,q=m+w*p;m<q;){var U=1==I?W[r()]:r()|r()<<8|r()<<16|
4278190080;g=1;do t=r(),g+=t;while(255==t);if(A.fill)A.fill(U,m,m+g),m+=g;else for(;0<g--;)A[m++]=U}else for(m=0,q=m+w*p;m<q;){U=r();g=1;if(0!=(U&128)){do t=r(),g+=t;while(255==t)}U&=127;U=Q[U];if(A.fill)A.fill(U,m,m+g),m+=g;else for(;0<g--;)A[m++]=U}else if(t=w*p,0==m)if(1==I)for(g=0;g<t;g++)A[g]=W[r()];else for(g=0;g<t;g++)A[g]=r()|r()<<8|r()<<16|4278190080;else for(q=16<m?8:4<m?4:2<m?2:1,g=m=0;g<p;g++){U=m+w;for(var v=t=0;m<U;)0==v&&(t=r(),v=8),v-=q,A[m++]=Q[t>>v&(1<<q)-1&127]}l||y.setRGBs(E,h,
w,p,A,0,w)}else y.fillRect(E,h,w,p,Q[0])}}l||y.postPaint(e,d,k,O)}}function Ja(){function a(a,b,c,f,g){this.draw=function(){R.fillStyle=g;R.fillRect(a,b,c,f)};this.type=0;this.ready=function(){return!0}}function b(a,b,c){this.draw=function(){R.putImageData(c,a,b)};this.type=1;this.ready=function(){return!0}}function c(a,b,c){this.draw=function(){R.drawImage(c,a,b);URL.revokeObjectURL(c.src)};this.type=2;this.ready=function(){return!!c.src&&c.complete};this.image=c}function f(a,b,c,f){var g=null;c=
new Blob([c],{type:"image/jpeg"});var h=!1;this.draw=function(){g&&(R.drawImage(g,a,b),g.close())};this.type=3;this.ready=function(){return h};createImageBitmap(c).then(function(a){g=a;h=!0;f()})["catch"](function(a){h=!0;svGlobal.logger.warn("Failed to load JPEG:"+a)})}function h(){var a=u[O];a||(a=new TINF,a.init(2==d.mode?120:0),u[O]=a);return a}function e(a){var b=a.getByte(),c=b&127;b&128&&(b=a.getByte(),c|=(b&127)<<7,b&128&&(c|=a.getByte()<<14));return c}function g(a){if(3==l)return"rgb("+a.getByte()+
","+a.getByte()+","+a.getByte()+")";var b=a.getByte()|a.getByte()<<8;a=b>>8&248;var c=b>>3&252,b=b<<3&255;return"rgb("+(a|a>>5)+","+(c|c>>6)+","+(b|b>>5)+")"}function k(a){var b=a>>8&248,c=a>>3&252;a=a<<3&255;return b|b>>5|(c|c>>6)<<8|(a|a>>5)<<16|4278190080}var O=0,l=3,u={},r={data:[0],length:0},F=Array(256);F[0]=0;this.inUse=!1;var q=this,v=!!window.createImageBitmap;this.setBytesPerPixel=function(a){l=3<a?3:a};var A=new function(){function a(){for(;0<b.length;){var a=b[0];if(!a.ready())break;a.draw();
b.shift()}}var b=[];this.check=a;this.push=function(c){b.push(c);2==c.type?c.image.onload=a:a()};this.release=function(){b=[]}};this.release=function(){A.release();u=r=F=q=A=null};this.getHistory=function(){var a=[84],b=Object.keys(u).length;a.push(b);for(var c in u)if(u.hasOwnProperty(c)){a.push(parseInt(c));var b=u[c].getHistory(),g=b.length,f=g&255;a.push(g>>8&255);a.push(f);a=a.concat(b)}return a};this.setHistory=function(a){for(var b=0,c=a[b++],g=0;g<c;g++){var f=a[b++],h=a[b++],e=a[b++],e=(h&
255)<<8|e&255,h=a.slice(b,b+e),b=b+e,e=u[f];e||(e=new TINF,e.init(2==d.mode?120:0),u[f]=e);e.setHistory(h)}};this.drawImageData=function(a,c,g){A.push(new b(c,g,a))};this.decode=function(d,E,Q,t,u,y){q.inUse||(q.inUse=!0);var m=d.getByte();switch(m>>4){case 8:y?d.skip(l):A.push(new a(E,Q,t,u,g(d)));break;case 9:var p=e(d);y?d.skip(p):v?A.push(new f(E,Q,d.getBytes(p),A.check)):(y=d.getBytes(p),y=new Blob([y],{type:"image/jpeg"}),y=URL.createObjectURL(y),t=new Image,A.push(new c(E,Q,t)),t.src=y);break;
default:if(O=(m&48)>>4,m=m&64?d.getByte():0,1==m){m=d.getByte;var w=m()+1;var Y=2!=w?t*u:u*((t+7)/8|0);var C=0;var n;if(3==l)for(;C<w;C++)F[C]=m()|m()<<8|m()<<16|4278190080;else for(;C<w;C++)F[C]=k(m()|m()<<8);12>Y?(r.data=d.getBytes(Y),r.length=Y):(m=e(d),d=h().uncompress(d.getBytes(m),0),r.data=d.dest,r.length=d.destIndex);p=r.data;m=R.createImageData(t,u);if("Uint8ClampedArray"in window){var D=new Uint32Array(m.data.buffer);if(2!=w)for(C=0;C<Y;C++)D[C]=F[p[C]];else{d=0;Y=(t+7)/8|0;for(var z=0;z<
u;z++){C=z*Y;for(var x=0;x<(t/8|0);x++)for(w=p[C+x],n=7;0<=n;n--)D[d++]=F[w>>n&1];w=8-t%8;for(n=7;n>=w;n--)D[d++]=F[p[C+x]>>n&1]}}}else if(D=m.data,d=0,2!=w)for(C=0;C<Y;C++)w=F[p[C]],D[d++]=w&255,D[d++]=w>>8&255,D[d++]=w>>16&255,D[d++]=255;else{d=0;Y=(t+7)/8|0;for(var B,z=0;z<u;z++){C=z*Y;for(x=0;x<(t/8|0);x++)for(w=p[C+x],n=7;0<=n;n--)B=F[w>>n&1],D[d++]=B&255,D[d++]=B>>8&255,D[d++]=B>>16&255,D[d++]=255;w=8-t%8;for(n=7;n>=w;n--)B=F[p[C+x]>>n&1],D[d++]=B&255,D[d++]=B>>8&255,D[d++]=B>>16&255,D[d++]=
255}}y||A.push(new b(E,Q,m))}else if(0==m){p=t*u*l;11<p&&(p=e(d));w=t*u;m=w*l;p=11<m?h().uncompress(d.getBytes(p),0).dest:d.getBytes(m);m=R.createImageData(t,u);D=m.data;t=d=0;if(3==l)for(C=0;C<w;C++)D[d++]=p[t++],D[d++]=p[t++],D[d++]=p[t++],D[d++]=255;else for(C=0;C<w;C++)u=k(p[t++]|p[t++]<<8),D[d++]=u&255,D[d++]=u>>8&255,D[d++]=u>>16&255,D[d++]=255;y||A.push(new b(E,Q,m))}else svGlobal.logger.info("xx filter:"+m)}}}function oa(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1),f=!1;var h=d.sessionInfo.appInfo;
switch(b){case 0:var e=JSON.parse(c);ra();L=!0;f=e.width;h=e.height;if(f==ba&&h==ca)break;ha(f,h);break;case 1:d.reconnectOnResize=!1;e=JSON.parse(c);h.sessions[e.numericId]=e.name||e.__ip;d.onsessionjoin&&(f=d.onsessionjoin(e));if(f)break;d.showMessage(__svi18n.info.joinsession.applyArgs([e.numericId,e.__ip,e.name]));break;case 2:e=JSON.parse(c);delete h.sessions[e.numericId];d.onsessionexit&&(f=d.onsessionexit(e));if(f)break;d.showMessage(__svi18n.info.exitsession.applyArgs([e.numericId,e.__ip,
e.name]));break;case 3:e=JSON.parse(c);h.joinMode!=e.mode&&(h.joinMode=e.mode,a=hi5.$("joinSelect"))&&(a.value=e.mode);if(h.hasControl)break;r.setReadOnly(!1,2==e.mode);if(h=hi5.$("requestControl"))h.disabled=!0;d.ongivecontrol&&(f=d.ongivecontrol());if(f)break;d.showMessage(__svi18n.info.givecontrol);break;case 4:e=JSON.parse(c);r.setReadOnly(!0,2==e.mode);h.hasControl=!1;if(h=hi5.$("requestControl"))h.disabled=!1;d.ontakebackcontrol&&(f=d.ontakebackcontrol());if(f)break;d.showMessage(__svi18n.info.nocontrol);
break;case 5:e=JSON.parse(c);d.onrequirecontrol&&(f=d.onrequirecontrol(e));if(f)break;f=__svi18n.info.title.applyArgs([e.name,e.numericId,e.__ip]);d.showMessage({title:f,msg:__svi18n.info.recontrol,cbYes:function(){d.giveControl(e.numericId);this.destroy()},cbNo:function(){d.refuseControl(e.numericId);this.destroy()}});break;case 9:e=JSON.parse(c);0<e.interval&&0<e.width?Ta(e.width,e.interval):P&&(P.stop(),P=null);break;case 10:if(1==a.length)q("8E8"+hi5.Base64.enc(Va()));else if(Wa(hi5.Base64.dec(a.substring(1),
0)),d.refreshOutput(),ea=!0,d.onloggedin)d.onloggedin();S&&S.check(15555);break;case 11:e=JSON.parse(c),d.onrequirejoin&&(f=d.onrequirejoin(e)),f||(f=__svi18n.info.title.applyArgs([e.name,e.numericId,e.__ip]),d.showMessage({title:f,msg:__svi18n.info.reqjoin,cbYes:function(){d.allowJoin(e.numericId,!0);this.destroy()},cbNo:function(){d.allowJoin(e.numericId,!1);this.destroy()}}))}}function Va(){var a=aa.getHistory(),b=T.getHistory();return a.concat(b)}function Wa(a){var b=0,c=a[b++];if(90==c){var c=
a[b++],d=a[b++];if(c=(c&255)<<8|d&255)aa.setHistory(a.slice(b,b+c)),b+=c}c=a[b++];84==c&&T.setHistory(a.slice(b))}function Xa(a){if(!d.openLink)return!1;var b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));if(c){if(0<a.indexOf("\r")||0<a.indexOf("\n"))return!1;if(d.onurlredirection&&d.onurlredirection(c))return!0;
r.processLink(b);return!0}return!1}function Ya(a,b,c,d,h,e,g,k,l){this.cache_idx=a;this.rawData=b;this.none=!b;this.hotX=c;this.hotY=d;this.width=h;this.height=e;this.xorSize=k;this.andSize=l;this.result="";this.distance=0;this.bpp=g;this.system="";this.init=function(){if(this.distance){var a=0;if(b)for(var c=0,d=b.length;c<d;c++)0!=b[c]&&(a+=c%h+(c/h|0));this.distance=a}this.system||(a=507==this.distance?"text":"",this.system=a)};a="";if(!this.system&&b){var f=h*e*4;g=62+f+k+l;var E=new Uint8Array(g);
g=new hi5.DataBuffer(E,0,g);g.setLittleEndian16(0);g.setLittleEndian16(2);g.setLittleEndian16(1);g.setByte(h);g.setByte(e);g.setByte(0);g.setByte(0);g.setLittleEndian16(c);g.setLittleEndian16(d);g.setLittleEndian32(40+f+k+l);g.setLittleEndian32(22);g.setLittleEndian32(40);g.setLittleEndian32(h);g.setLittleEndian32(2*e);g.setLittleEndian16(1);g.setLittleEndian16(32);g.setLittleEndian32(0);g.setLittleEndian32(k+l);g.setLittleEndian32(0);g.setLittleEndian32(0);g.setLittleEndian32(0);g.setLittleEndian32(0);
for(c=e-1;0<=c;c--)for(d=0;d<h;d++)e=b[h*c+d],g.setByte(e&255),g.setByte(e>>8&255),g.setByte(e>>16&255),g.setByte(e>>24&255);hi5.browser.isIE||(a="data:image/x-icon;base64,"+hi5.Base64.enc(g.getData()))}this.url=a}function Ka(a,b,c,d,h){var e=null,g=d*h,f=0,k=a.getPosition(),l=a.getData();if(T.inUse){e=R.createImageData(d,h);if(4==I){if("Uint8ClampedArray"in window)for(h=new Uint32Array(e.data.buffer),f=0;f<g;f++)h[f]=l[k++]<<16|l[k++]<<8|l[k++]|4278190080,k++;else for(h=e.data,d=4*g;f<d;)h[f++]=
l[k+2],h[f++]=l[k+1],h[f++]=l[k],h[f++]=255,k+=4;a.skip(4*g)}else if(1==I){if("Uint8ClampedArray"in window)for(h=new Uint32Array(e.data.buffer),f=0;f<g;f++)h[f]=W[l[k++]];else{h=e.data;d=4*g;for(var u;f<d;)u=W[l[k++]],h[f++]=u&255,h[f++]=u>>8&255,h[f++]=u>>16&255,h[f++]=255}a.skip(g)}T.drawImageData(e,b,c)}else{switch(I){case 4:if(0==k%4){k+=3;for(f=0;f<g;f++)l[k]=255,k+=4;e=new Uint32Array(a.getData().buffer,a.getPosition(),g)}else for(e=new Uint32Array(g),f=0;f<g;f++)e[f]=l[k++]|l[k++]<<8|l[k++]<<
16|4278190080,k++;a.skip(4*g);break;case 1:e=new Uint32Array(g);for(f=0;f<g;f++)e[f]=W[l[k++]];a.skip(g)}y.setRGBs(b,c,d,h,e,0,d);y.postPaint(b,c,d,h)}}function ha(a,b){if(a&&b){if(ba=a,ca=b,l.width=a,l.height=b,y.resize(a,b),r&&r.setSize(a,b),d.onresolutionchange)d.onresolutionchange(a,b)}else{var c="Invalid monitor size, width:"+a+" h:"+b,f=__svi18n.errorCode.C_1;f||(f="Error C_1",c&&(f+=", "+c));if(d.onerror)d.onerror({name:"C_1",message:f});d.displayMsg&&d.showMessage(f);0<svGlobal.log&&console.error(f)}}
function Za(a){if(ea&&a&&(a=a.getData("text/plain"))){var b=a.length,c=new Int8Array(9+b);c[0]=147;c[1]=6;c[5]=b>>24&255;c[6]=b>>16&255;c[7]=b>>8&255;c[8]=b&255;for(var d=0;d<b;d++)c[9+d]=a.charCodeAt(d);q(c.buffer)}}function ra(){L=!1;T=new Ja;aa=new ta}function za(a,b,c,d){ea&&(La=a,(a?1<<b:0)!=N[1]||c!=(N[2]<<8|N[3])||d!=(N[4]<<8|N[5]))&&(N[2]=a?1<<b:0,N[3]=c>>8&255,N[4]=c&255,N[5]=d>>8&255,N[6]=d&255,q(N.buffer))}function X(a,b,c){if(na){if(1>c||170==c)return}else if(1>b)return;G[2]=a?1:0;G[5]=
b>>24;G[6]=b>>16;G[7]=b>>8;G[8]=b;183==c?c=84:197==c&&(c=198);na&&(G[2]=0,G[3]=0,G[4]=a?1:0,G[9]=c>>24,G[10]=c>>16,G[11]=c>>8,G[12]=c);q(G.buffer);if(d.onkey)d.onkey(a,b,c)}function Ma(a,b){var c=Ia[b.toLowerCase()];c?d.writeScancode(a,c):(c=b.length,0!=c&&(1==c?d.writeKeyCode(a,b.toUpperCase().charCodeAt(0)):a&&d.writeText(b)))}this.displayMsg=!0;this.reconnectTimes=0;this.setTitle=this.openLink=!0;this.mode=0;this.CAP_QEMU_KEY=1;var ka="object"==typeof k?k:null,ma="object"==typeof k||0<k.indexOf("/PLAY?");
ma?(this.mode=1,ka&&(k=""),k+="&touchpad=on"):0<k.indexOf("/JOIN?")&&(this.mode=2,this.reconnectOnResize=!1);hi5.appcfg||(hi5.appcfg={img:{},toolbar:{fadable:!0},displayMsg:!0});var B=hi5.appcfg,l=hi5.tool.queryToObj(k.substring(k.indexOf("?")+1)),S=null,Fa=!1,ja="",na=!1;!l.width&&v&&(l.width=v,k+="&width="+v);!l.wHeight&&z&&(l.height=z,k+="&height="+z);!l.color&&J&&(l.color=J,k+="&color="+J);l.color||(l.color=32);var qa=void 0==l.ignoreCursor||K(l.ignoreCursor),la=void 0==l.trackCursorLocally||
K(l.trackCursorLocally),d=this;this.server=l.server;this.port=parseInt(l.port,10);this.loadbalanceToken=B.loadbalanceTokenName?B.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.sessionInfo={major:0,minor:0,width:0,height:0,bpp:0,bigEndian:!0,trueColor:!0};this.modifyURL=function(a){d.loadbalanceToken&&(a+="&"+d.loadbalanceToken);return a};var r=null,L=!1,ea=!1,pa=0,V=null;window.$vnc=this;var n=new Aa(4194304);this.running=function(){return L};var x=null,I=4,ba=1024,ca=768,W=[-16777216,-16777180,
-16777143,-16777107,-16777070,-16777034,-16776997,-16776961,-16768E3,-16767964,-16767927,-16767891,-16767854,-16767818,-16767781,-16767745,-16758528,-16758492,-16758455,-16758419,-16758382,-16758346,-16758309,-16758273,-16749312,-16749276,-16749239,-16749203,-16749166,-16749130,-16749093,-16749057,-16739840,-16739804,-16739767,-16739731,-16739694,-16739658,-16739621,-16739585,-16730624,-16730588,-16730551,-16730515,-16730478,-16730442,-16730405,-16730369,-16721152,-16721116,-16721079,-16721043,-16721006,
-16720970,-16720933,-16720897,-16711936,-16711900,-16711863,-16711827,-16711790,-16711754,-16711717,-16711681,-11206656,-11206620,-11206583,-11206547,-11206510,-11206474,-11206437,-11206401,-11197440,-11197404,-11197367,-11197331,-11197294,-11197258,-11197221,-11197185,-11187968,-11187932,-11187895,-11187859,-11187822,-11187786,-11187749,-11187713,-11178752,-11178716,-11178679,-11178643,-11178606,-11178570,-11178533,-11178497,-11169280,-11169244,-11169207,-11169171,-11169134,-11169098,-11169061,-11169025,
-11160064,-11160028,-11159991,-11159955,-11159918,-11159882,-11159845,-11159809,-11150592,-11150556,-11150519,-11150483,-11150446,-11150410,-11150373,-11150337,-11141376,-11141340,-11141303,-11141267,-11141230,-11141194,-11141157,-11141121,-5636096,-5636060,-5636023,-5635987,-5635950,-5635914,-5635877,-5635841,-5626880,-5626844,-5626807,-5626771,-5626734,-5626698,-5626661,-5626625,-5617408,-5617372,-5617335,-5617299,-5617262,-5617226,-5617189,-5617153,-5608192,-5608156,-5608119,-5608083,-5608046,
-5608010,-5607973,-5607937,-5598720,-5598684,-5598647,-5598611,-5598574,-5598538,-5598501,-5598465,-5589504,-5589468,-5589431,-5589395,-5589358,-5589322,-5589285,-5589249,-5580032,-5579996,-5579959,-5579923,-5579886,-5579850,-5579813,-5579777,-5570816,-5570780,-5570743,-5570707,-5570670,-5570634,-5570597,-5570561,-65536,-65500,-65463,-65427,-65390,-65354,-65317,-65281,-56320,-56284,-56247,-56211,-56174,-56138,-56101,-56065,-46848,-46812,-46775,-46739,-46702,-46666,-46629,-46593,-37632,-37596,-37559,
-37523,-37486,-37450,-37413,-37377,-28160,-28124,-28087,-28051,-28014,-27978,-27941,-27905,-18944,-18908,-18871,-18835,-18798,-18762,-18725,-18689,-9472,-9436,-9399,-9363,-9326,-9290,-9253,-9217,-256,-220,-183,-147,-110,-74,-37,-1],y;y?y.resize(1024,768):y=new ia(1024,768);var R=y.getContext();this.getDesktop=function(){return y};this.writeKeyComb=function(a){var b=a.split("+"),c=b.length;if(0!=c){for(var d=null,h=0;h<c;h++)a=b[h],""==a&&""==d&&(a="Add"),""!=a&&Ma(!0,a),d=a;for(h=c-1;0<=h;h--)a=b[h],
""==a&&""==d&&(a="Add"),""!=a&&Ma(!1,a),d=a}};var Z=new function(){this.ws=null;this.capsLock=this.numLock=!1;this.setJoinMode=d.setJoinMode;this.requestControl=d.requestControl;this.writeKeyComb=d.writeKeyComb;this.remoteLockFlags=this.localLockFlags=0;this.checkLockFlags=!0;this.getAppMode=function(){return d.mode};this.send=function(a){L&&this.ws.send(a)};this.sendInput=function(a){d.writeRawInput(a);if(d.onactivity)d.onactivity(a)};this.getAppInfo=function(){return d.sessionInfo.appInfo};this.onresize=
function(a){};this.onorientationchange=function(a){};this.getClipData=Na;this.onfocus=function(a){};this.fileCallback=[];this.getShareFiles=function(a,b){this.ws.send("3A5"+a);this.fileCallback.push(b)};this.notifyFiles=function(a){for(var b=this.fileCallback,c=0,d=b.length;c<d;c++)b[c](a)};this.getFile=function(a){window.open(d.getFileUrl(a))};this.removeFile=function(a){uploadMgr&&uploadMgr.fileService.remove(a)};this.getFileLink=function(a){return fa()+"/DOWNLOAD?s="+ja+"&f="+a};this.getGateway=
function(){return k};this.reconnect=function(a,b,c){};this.sendKeyboardSyncFlags=function(a){if(L){var b=this.remoteLockFlags;(b&7)!=a&&((b&4)!=(a&4)&&(X(!0,65549,58),X(!1,65549,58)),(b&2)!=(a&2)&&(X(!0,65407,69),X(!1,65407,69)),(b&1)!=(a&1)&&(X(!0,65300,70),X(!1,65300,70)));this.remoteLockFlags=this.localLockFlags=a;return!0}return!1}};void 0!=B.displayMsg?this.displayMsg=B.displayMsg:B.displayMsg=this.displayMsg;void 0!=B.reconnectTimes&&(this.reconnectTimes=B.reconnectTimes);void 0!=B.openLink&&
(this.openLink=B.openLink);void 0!=B.setTitle&&(this.setTitle=B.setTitle);"boolean"==typeof B.useWSS&&(k=(B.useWSS?"wss":"ws")+k.substring(k.indexOf("://")));this.getURL=function(){return k};var $a=parseInt(l.server_bpp||l.color||24);this.getColor=function(){return $a};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);q(b.buffer)};this.startPing=function(a,b){b=b||0;S||(S=new hi5.tool.ResponseMonitor(function(){d.sendPing()},function(){if(L&&d.onnoresponse)return d.onnoresponse()}));
S.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;q(c.buffer);d.sendPing()};this.stopPing=function(){S&&S.stop()};var P=null;this.setJoinMode=function(a){q("8E1"+a)};this.refuseControl=function(a){q("8E3"+a)};this.giveControl=function(a){q("8E4"+a)};this.requestControl=function(){q("8E2")};this.allowJoin=function(a,b){q("8EA"+a+"\t"+(b?1:0))};this.play=function(){q("F3")};this.pause=function(){q("F2")};this.scan=function(a){q("F4"+(a?"1":"0"))};this.seek=function(a){r&&L&&(q("F4"+
(a?"1":"0")+"\t"+(a/r.getScale().x|0)),y.pause(!0))};var Ea=0;this.run=function(){Pa();y.startAnimation()};this.hide=function(){r&&r.hide()};this.showMessage=function(a,b){d.displayMsg&&a&&(r?r.showMessage(a,b):("string"==typeof a&&(a={msg:a,timeout:b||0}),hi5.notifications.notify(a)))};this.close=function(){Fa=!0;if(x&&L)try{for(;x&&x.readyState!=WebSocket.CLOSING&&x.readyState!=WebSocket.CLOSED;)q("85"),x.close()}finally{da()}else da()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(da):
window.addEventListener("unload",da,!1);var sa=new M(12,function(a){if(82!=a.getByte()||70!=a.getByte()||66!=a.getByte())d.showMessage(__svi18n.vnc.notvnc),d.close();else if(a.skip(1),d.sessionInfo.major=100*(a.getByte()-48)+10*(a.getByte()-48)+(a.getByte()-48),a.skip(1),d.sessionInfo.minor=100*(a.getByte()-48)+10*(a.getByte()-48)+(a.getByte()-48),svGlobal.logger.info("RFB major: "+d.sessionInfo.major+" minor: "+d.sessionInfo.minor),a.skip(1),3==d.sessionInfo.major&&7<=d.sessionInfo.minor){var b=
"\u0093RFB 003.007\n";a=new Uint8Array(13);for(var c=0;13>c;c++)a[c]=b.charCodeAt(c);q(a.buffer);n.setHandler(new M(1,function(a){a=a.getByte();console.log("==== secType received = "+a);switch(a){case 1:wa();break;case 2:n.setHandler(new M(16,function(a){svGlobal.logger.info("vnc auth");var b=new Uint8Array(17);b[0]=32;a.copyToByteArray(b,1,a.getPosition(),16);a.skip(16);a=l.pwd||"";8<a.length&&(a=a.substring(0,8));var d=[0,0,0,0,0,0,0,0],g=a.length;for(c=0;c<g;c++)d[c]=a.charCodeAt(c);a=new DesCipher(d);
a.encrypt(b,1,b,1);a.encrypt(b,9,b,9);x.send(b.buffer);n.setHandler(new M(4,ga))}));break;case 113:n.setHandler(new M(24,function(a){svGlobal.logger.info("NTLM auth");var b=new Uint8Array(345);b[0]=33;a.copyToByteArray(b,1,a.getPosition(),24);a.skip(24);a=l.user;var g=25,e=a.length;if(a)for(c=0;c<e;c++){var f=a.charCodeAt(c);b[g++]=f&255;b[g++]=f>>8&255}if(178<e)d.showMessage("User name is too long: > 178"),d.close();else{g=281;if(a=l.pwd){e=a.length;if(32<e){d.showMessage("Password is too long: > 32");
d.close();return}for(c=0;c<e;c++)f=a.charCodeAt(c),b[g++]=f&255,b[g++]=f>>8&255}x.send(b.buffer);n.setHandler(new M(4,ga))}}));break;case 19:break;case 30:svGlobal.logger.info("Apple auth");a=new Uint8Array(321);a[0]=34;var b=l.user,e=0,g=1,f=b.length;if(b){if(178<f){d.showMessage("User name is too long: > 178");d.close();break}for(c=0;c<f;c++)e=b.charCodeAt(c),a[g++]=e&255,a[g++]=e>>8&255}g=257;if(b=l.pwd){f=b.length;if(32<f){d.showMessage("Password is too long: > 32");d.close();break}for(c=0;c<
f;c++)e=b.charCodeAt(c),a[g++]=e&255,a[g++]=e>>8&255}x.send(a.buffer);n.setHandler(new M(4,ga));break;default:d.showMessage(__svi18n.vnc.securityError),d.close()}}))}else{b="\u0093RFB 003.003\n";a=new Uint8Array(13);for(c=0;13>c;c++)a[c]=b.charCodeAt(c);q(a.buffer);n.setHandler(new M(4,function(a){a=a.getBE32();var b=0,c=0;svGlobal.logger.info("sec type:"+a);switch(a){case 1:wa();break;case 2:n.setHandler(new M(12,function(a){svGlobal.logger.info("vnc auth");var d=new Uint8Array(17);d[0]=32;a.copyToByteArray(d,
1,a.getPosition(),16);a.skip(16);a=l.pwd||"";8<a.length&&(a=a.substring(0,8));var g=[0,0,0,0,0,0,0,0];b=0;for(c=a.length;b<c;b++)g[b]=a.charCodeAt(b);a=new DesCipher(g);a.encrypt(d,1,d,1);a.encrypt(d,9,d,9);q(d.buffer);n.setHandler(new M(4,ga))}));break;case -6:n.setHandler(new M(24,function(a){svGlobal.logger.info("NTLM auth");var d=new Uint8Array(345);d[0]=33;a.copyToByteArray(d,1,a.getPosition(),24);a.skip(24);a=l.user;var e=25;if(a)for(b=0,c=a.length;b<c;b++){var f=a.charCodeAt(b);d[e++]=f&255;
d[e++]=f>>8&255}e=281;if(a=l.pwd)for(b=0,c=a.length;b<c;b++)f=a.charCodeAt(b),d[e++]=f&255,d[e++]=f>>8&255;q(d.buffer);n.setHandler(new M(4,ga))}));break;default:d.showMessage(__svi18n.vnc.securityError),d.close()}}))}});n.setHandler(sa);this.refreshOutput=function(a,b,c,d){a=a||0;b=b||0;ya(a,b,c?c-a+1:ba,d?d-b+1:ca,!1)};var va=new M(1,function(a){var b=a.getByte();switch(b){case 0:a.skip(1);b=a.getBE16();for(var c=0;c<b;c++){var f=a.getBE16();var h=a.getBE16();var e=a.getBE16();var g=a.getBE16();
var k=a.getBE32()>>>0;switch(k){case 4294967073:ha(e,g);break;case 240:case 4294967056:0!=e*g&&a.skip(((e+7)/8|0)*g*2+6);break;case 4294967057:if(0!=e*g)if(qa)a.skip(e*g*I+((e+7)/8|0)*g);else{var l;var q=a;k=(e+7)/8|0;var u=k*g;var n=e*g,F=new Uint32Array(n),v=q.getBytes(n*I),x=q.getBytes(u),A=0,p=0;for(u=0;u<g;u++){for(l=0;l<e/8;l++){var w=x[u*k+l];for(q=7;0<=q;q--)0!=(w>>q&1)?1!=I&&(A=4278190080|(v[4*p+2]&255)<<16|(v[4*p+1]&255)<<8|v[4*p]&255):A=0,F[p++]=A}for(q=7;q>=8-e%8;q--)A=0!=(x[u*k+l]>>q&
1)?1==I?0:4278190080|(v[4*p+2]&255)<<16|(v[4*p+1]&255)<<8|v[4*p]&255:0,F[p++]=A}f=new Ya(0,F,f,h,e,g,4,4*n,n/8|0);r.setCursor(f)}break;case 4294967064:break;case 0:0<e*g&&Ka(a,f,h,e,g);break;case 1:k=a.getBE16();n=a.getBE16();T.inUse?R.putImageData(R.getImageData(k,n,e,g),f,h):(y.moveArea(k,n,e,g,f-k,h-n),y.postPaint(f,h,e,g));break;case 5:Ga.decode(a,f,h,e,g);break;case 7:T.decode(a,f,h,e,g,!1);break;case 16:aa.decode(a,f,h,e,g,!1);break;case 4294967035:f=a.getByte();h=0!=(f&4);e=0!=(f&2);g=0!=(f&
1);Z.remoteLockFlags=f;Z.checkLockFlags=!0;if(d.onLockKeyState)d.onLockKeyState({capsLock:h,numLock:e,scrollLock:g});svGlobal.logger.info("LED state, capsLock:"+h+" numLock:"+e+" scrollLock:"+g);break;case 4294967038:G=new Uint8Array(13);G[0]=147;G[1]=255;G[2]=0;na=!0;r.setUnicode(!1);if(d.oncapability)d.oncapability(d.CAP_QEMU_KEY);svGlobal.logger.warn("QEMU Ext Key enabled");break;default:svGlobal.logger.warn("Encoding "+k+" is not supported")}}ya(0,0,ba,ca,!0);break;case 1:svGlobal.logger.warn("xxx color map");
break;case 2:break;case 3:a.skip(3);b=a.getBE32();0<b&&(a=a.getBytes(b),b=String.fromCharCode.apply(null,a),d.onservercopy&&d.onservercopy(b)||Xa(b)||r.copyToClip("text/plain;"+b));break;case 48:b=a.getString16LE(0,a.getEnd());oa(b);a.skip(a.getEnd()-a.getPosition());break;default:svGlobal.logger.warn("XX PDU:"+b)}});2!=d.mode&&1!=d.mode||n.setHandler(va);var T=new Ja,aa=new ta,Ga=new function(){var a=0,b=0;this.decode=function(c,d,h,e,g){var f=d+e,k=h+g;b=a=0;for(var l=h;l<k;l+=16)for(var r=Math.min(16,
k-l),q=d;q<f;q+=16){var n=c,v=q,x=l,A=Math.min(16,f-q),p=r,w=n.getByte();if(0!=(w&1))Ka(n,v,x,A,p,!1);else if(0!=(w&2)&&(1==I?a=W[n.getByte()]:(a=n.getByte()|n.getByte()<<8|n.getByte()<<16|4278190080,n.skip(1))),y.fillRect(v,x,A,p,a),0!=(w&4)&&(1==I?b=W[n.getByte()]:(b=n.getByte()|n.getByte()<<8|n.getByte()<<16|4278190080,n.skip(1))),0!=(w&8)){var A=n.getByte(),m;if(0!=(w&16))if(1==I)for(m=0;m<A;m++){b=W[n.getByte()];var t=n.getByte();w=t>>4;p=t&15;t=n.getByte();var z=1+(t>>4);t=1+(t&15);y.fillRect(v+
w,x+p,z,t,b)}else for(m=0;m<A;m++)b=n.getByte()|n.getByte()<<8|n.getByte()<<16|4278190080,n.skip(1),t=n.getByte(),w=t>>4,p=t&15,t=n.getByte(),z=1+(t>>4),t=1+(t&15),y.fillRect(v+w,x+p,z,t,b);else for(m=0;m<A;m++)t=n.getByte(),w=t>>4,p=t&15,t=n.getByte(),z=1+(t>>4),t=1+(t&15),y.fillRect(v+w,x+p,z,t,b)}}y.postPaint(d,h,e,g)}};this.resetStatus=ra;this.addSurface=function(a){r=a;ma&&a.setPlayerMode();y.setContext(r.context);R=y.getContext();a.setAutoScale(0<d.mode);a.setSize(ba,ca);a.setController(Z);
a.setFastCopy(K(l.fastCopy));a.setTouchpad(K(l.touchpad));a.setClipboard(K(l.mapClipboard));var b=void 0!=l.ctrlToWin?K(l.ctrlToWin):void 0!=B.ctrlToWin?B.ctrlToWin:!0;a.run(99997,b);r.setImageCursor(!1);Da(r);a.onclipdata=Za};var N=new Uint8Array(7);N[0]=147;N[1]=5;var La=!1,H=new Uint8Array(13);H[0]=147;H[1]=5;H[7]=5;H[8]=0;this.mouseDown=function(a,b,c){za(!0,c,a,b)};this.mouseMove=function(a,b){za(La,0,a,b)};this.mouseUp=function(a,b,c){za(!1,c,a,b)};this.writeKeyCode=function(a,b){d.writeRawInput("8B"+
(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){L&&("number"==typeof a?(d.writeRawInput("840\t"+a),d.writeRawInput("8449152\t"+a)):d.writeRawInput("84"+(a?0:49152)+"\t"+b))};this.writeText=function(a){d.writeRawInput("86"+a)};var ua={57:32,201:65365,209:65366,207:65367,199:65360,203:65361,200:65362,205:65363,208:65364,183:65377,84:65377,197:65299,198:65299,210:65379,211:65535,184:65514,219:65515,220:65516,1:65307,14:65288,15:65289,28:65293,29:65507,42:65505,54:65506,56:65513,59:65470,60:65471,
61:65472,62:65473,63:65474,64:65475,65:65476,66:65477,67:65478,68:65479,87:65480,88:65481,55:65450,69:65407,70:65300,71:65429,72:65431,73:65434,74:65453,75:65430,76:65437,77:65432,78:65451,79:65436,80:65433,81:65435,82:65438,83:65439,156:65421,157:65508,181:65455,toKeySym:function(a){a=ua[a];if(Z.localLockFlags&2)switch(a){case 65429:a=55;break;case 65431:a=56;break;case 65434:a=57;break;case 65430:a=52;break;case 65437:a=53;break;case 65432:a=54;break;case 65436:a=49;break;case 65433:a=50;break;
case 65435:a=51;break;case 65438:a=48;break;case 65439:a=46}return a||0}},Ha={260:417,728:418,321:419,317:421,346:422,352:425,350:426,356:427,377:428,381:430,379:431,261:433,731:434,322:435,318:437,347:438,711:439,353:441,351:442,357:443,378:444,733:445,382:446,380:447,340:448,258:451,313:453,262:454,268:456,280:458,282:460,270:463,272:464,323:465,327:466,336:469,344:472,366:473,368:475,354:478,341:480,259:483,314:485,263:486,269:488,281:490,283:492,271:495,273:496,324:497,328:498,337:501,345:504,
367:505,369:507,355:510,729:511,294:673,292:678,304:681,286:683,308:684,295:689,293:694,305:697,287:699,309:700,266:709,264:710,288:725,284:728,364:733,348:734,267:741,265:742,289:757,285:760,365:765,349:766,312:930,342:931,296:933,315:934,274:938,290:939,358:940,343:947,297:949,316:950,275:954,291:955,359:956,330:957,331:959,256:960,302:967,278:972,298:975,325:977,332:978,310:979,370:985,360:989,362:990,257:992,303:999,279:1004,299:1007,326:1009,333:1010,311:1011,371:1017,361:1021,363:1022,8254:1150,
12290:1185,12300:1186,12301:1187,12289:1188,12539:1189,12530:1190,12449:1191,12451:1192,12453:1193,12455:1194,12457:1195,12515:1196,12517:1197,12519:1198,12483:1199,12540:1200,12450:1201,12452:1202,12454:1203,12456:1204,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,
12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12516:1236,12518:1237,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12531:1245,12443:1246,12444:1247,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,
1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,1106:1697,1107:1698,1105:1699,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,8470:1712,1026:1713,1027:1714,1025:1715,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1102:1728,1072:1729,1073:1730,1094:1731,1076:1732,1077:1733,
1092:1734,1075:1735,1093:1736,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1103:1745,1088:1746,1089:1747,1090:1748,1091:1749,1078:1750,1074:1751,1100:1752,1099:1753,1079:1754,1096:1755,1101:1756,1097:1757,1095:1758,1098:1759,1070:1760,1040:1761,1041:1762,1062:1763,1044:1764,1045:1765,1060:1766,1043:1767,1061:1768,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1071:1777,1056:1778,1057:1779,1058:1780,1059:1781,1046:1782,1042:1783,1068:1784,
1067:1785,1047:1786,1064:1787,1069:1788,1065:1789,1063:1790,1066:1791,902:1953,904:1954,905:1955,906:1956,938:1957,908:1959,910:1960,939:1961,911:1963,901:1966,8213:1967,940:1969,941:1970,942:1971,943:1972,970:1973,912:1974,972:1975,973:1976,971:1977,944:1978,974:1979,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2E3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,945:2017,946:2018,
947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,963:2034,962:2035,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,9143:2209,9484:2210,9472:2211,8992:2212,8993:2213,9474:2214,9121:2215,9123:2216,9124:2217,9126:2218,9115:2219,9117:2220,9118:2221,9120:2222,9128:2223,9132:2224,8804:2236,8800:2237,8805:2238,8747:2239,8756:2240,8733:2241,8734:2242,8711:2245,8764:2248,8771:2249,8660:2253,8658:2254,8801:2255,8730:2262,
8834:2266,8835:2267,8745:2268,8746:2269,8743:2270,8744:2271,8706:2287,402:2294,8592:2299,8593:2300,8594:2301,8595:2302,9670:2528,9618:2529,9225:2530,9228:2531,9229:2532,9226:2533,9252:2536,9227:2537,9496:2538,9488:2539,9492:2541,9532:2542,9146:2543,9147:2544,9148:2546,9149:2547,9500:2548,9508:2549,9524:2550,9516:2551,8195:2721,8194:2722,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8212:2729,8211:2730,8230:2734,8229:2735,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,
8538:2743,8453:2744,8210:2747,9001:2748,9002:2750,8539:2755,8540:2756,8541:2757,8542:2758,8482:2761,9747:2762,9665:2764,9655:2765,9675:2766,9647:2767,8216:2768,8217:2769,8220:2770,8221:2771,8478:2772,8242:2774,8243:2775,10013:2777,9644:2779,9664:2780,9654:2781,9679:2782,9646:2783,9702:2784,9643:2785,9645:2786,9651:2787,9661:2788,9734:2789,8226:2790,9642:2791,9650:2792,9660:2793,9756:2794,9758:2795,9827:2796,9830:2797,9829:2798,10016:2800,8224:2801,8225:2802,10003:2803,10007:2804,9839:2805,9837:2806,
9794:2807,9792:2808,9742:2809,8981:2810,8471:2811,8248:2812,8218:2813,8222:2814,60:2979,62:2982,175:3008,8869:3010,8970:3012,95:3014,8728:3018,9109:3020,8868:3022,8968:3027,8866:3036,8867:3068,8215:3295,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,3585:3489,3586:3490,3587:3491,
3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,
3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,12593:3745,12594:3746,12595:3747,12596:3748,12597:3749,12598:3750,12599:3751,12600:3752,12601:3753,12602:3754,12603:3755,12604:3756,12605:3757,12606:3758,12607:3759,12608:3760,12609:3761,12610:3762,12611:3763,12612:3764,
12613:3765,12614:3766,12615:3767,12616:3768,12617:3769,12618:3770,12619:3771,12620:3772,12621:3773,12622:3774,12623:3775,12624:3776,12625:3777,12626:3778,12627:3779,12628:3780,12629:3781,12630:3782,12631:3783,12632:3784,12633:3785,12634:3786,12635:3787,12636:3788,12637:3789,12638:3790,12639:3791,12640:3792,12641:3793,12642:3794,12643:3795,4520:3796,4521:3797,4522:3798,4523:3799,4524:3800,4525:3801,4526:3802,4527:3803,4528:3804,4529:3805,4530:3806,4531:3807,4532:3808,4533:3809,4534:3810,4535:3811,
4536:3812,4537:3813,4538:3814,4539:3815,4540:3816,4541:3817,4542:3818,4543:3819,4544:3820,4545:3821,4546:3822,12653:3823,12657:3824,12664:3825,12671:3826,12673:3827,12676:3828,12678:3829,12685:3830,12686:3831,4587:3832,4592:3833,4601:3834,8361:3839,8364:5028,338:5052,339:5053,376:5054},G=new Uint8Array(9);G[0]=147;G[1]=4;this.writeRawInput=function(a){if(ea){var b=parseInt(a.substring(0,2),16);a=a.substring(2).split("\t");switch(b){case 128:d.mouseDown(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));
break;case 129:d.mouseUp(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]));break;case 130:d.mouseMove(parseInt(a[0]),parseInt(a[1]));break;case 131:b=0!=parseInt(a[2]);var c=parseInt(a[0]);a=parseInt(a[1]);ea&&(H[2]=b?16:8,H[3]=c>>8&255,H[4]=c&255,H[5]=a>>8&255,H[6]=a&255,H[9]=H[3],H[10]=H[4],H[11]=H[5],H[12]=H[6],q(H.buffer));break;case 132:b=ua.toKeySym(a[1]);c=0==a[0];X(c,b,parseInt(a[1],10));break;case 139:c=0==a[0];b=parseInt(a[1]);b=String.fromCharCode(b).toLocaleLowerCase().charCodeAt(0);X(c,b,
parseInt(a[2]));break;case 134:if(!na){c=0;for(var f=a[0].length;c<f;c++){b=a[0].charCodeAt(c);if(255<b)var h=Ha[b],b=h?h:b|16777216;X(!0,b,0);X(!1,b,0)}}}}};var Ia={" ":57,space:57,pageup:201,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,
f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78}};
